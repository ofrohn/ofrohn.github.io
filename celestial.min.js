// Copyright 2015-2020 Olaf Frohn https://github.com/ofrohn, see LICENSE
!function(){function t(t,e){function a(a,r){var i=t([a*=180/Math.PI,r*=180/Math.PI]),s=e([a,r]);return[(1-n)*i[0]+n*s[0],(n-1)*i[1]-n*s[1]]}var n,r=d3.geo.projection(a).scale(1),i=r.center,s=r.translate;return r.alpha=function(a){if(!arguments.length)return n;n=+a;var o=t.center(),l=e.center(),c=t.translate(),h=e.translate();return i([(1-n)*o[0]+n*l[0],(1-n)*o[1]+n*l[1]]),s([(1-n)*c[0]+n*h[0],(1-n)*c[1]+n*h[1]]),r},delete r.translate,delete r.center,r.alpha(0)}function e(t,e){return a(t.map(function(t){return t*ut}),e).map(function(t){return t/ut})}function a(t,e){var a,n,r,i,s,o,l,c,h,p;return e?(o=t[0],o<0&&(o+=pt),l=t[1],o-=e[0],i=e[1],s=e[2],a=Math.sin(l)*Math.sin(i)-Math.cos(l)*Math.cos(i)*Math.cos(o),Math.abs(a)<1e-5&&(a=-Math.cos(l+i)+Math.cos(l)*Math.cos(i)*(1-Math.cos(o))),n=-Math.cos(l)*Math.sin(o),c=0!==a||0!==n?Math.atan2(n,a):o-Math.PI,h=s+c,h>Math.PI&&(h-=pt),o%Math.PI==0?(p=l+Math.cos(o)*i,p>dt&&(p=Math.PI-p),p<-dt&&(p=-Math.PI-p)):(r=Math.sin(l)*Math.cos(i)+Math.cos(l)*Math.sin(i)*Math.cos(o),Math.abs(r)>.99?(p=Math.abs(Math.acos(Math.sqrt(a*a+n*n))),r<0&&(p*=-1)):p=Math.asin(r)),[h,p]):t}function n(t){if(null===t||t.length<=0)return[0,0,0];var e=ct.equatorial;return t[2]||(t[2]=0),[e[0]-t[0],e[1]-t[1],e[2]+t[2]]}function r(t,e){var a=t.getUTCFullYear(),n=t.getUTCMonth()+1,r=t.getUTCDate(),i=t.getUTCHours(),s=t.getUTCMinutes(),o=t.getUTCSeconds();1!=n&&2!=n||(a-=1,n+=12);var l=Math.floor(a/100),c=2-l+Math.floor(l/4),h=Math.floor(365.25*a),p=Math.floor(30.6001*(n+1)),d=c+h+p-730550.5+r+(i+s/60+o/3600)/24,u=d/36525,f=280.46061837+360.98564736629*d+387933e-9*u*u-u*u*u/3871e4+e;if(f>0)for(;f>360;)f-=360;else for(;f<0;)f+=360;return f}function i(t,a){return e(t,ft[a])}function s(t,e){if("equatorial"===e)return t;for(var a=ft[e],n=t.features,r=0;r<n.length;r++)n[r].geometry.coordinates=p(n[r],a);return t}function o(t){var e=[];for(var a in t)if(k(t,a)&&-1!==R.planets.which.indexOf(a)){var n=_t().id(a);k(t[a],"parent")&&n.parentBody(t[a].parent),n.elements(t[a].elements[0]).params(t[a]),"ter"===a?Z.origin=n:e.push(n)}return e}function l(t,e){if(e=e||Z.date(),Z.origin){var a,n=Z.origin(e).spherical();return Z.container.selectAll(".planet").each(function(r){t===r.id()&&(a=r(e).equatorial(n))}),a}}function c(t){for(var e={},a=t.features,n=0;n<a.length;n++)e[a[n].id]={center:a[n].properties.display.slice(0,2),scale:a[n].properties.display[2]};return e}function h(t){var e={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[]}}]},a=t.features[0].geometry.coordinates[0];e.features[0].geometry.coordinates[0]=[];for(var n=0;n<a.length;n++)e.features[0].geometry.coordinates[0][n]=a[n].slice().reverse();return e}function p(t,a){var n=[];switch(t.geometry.type){case"Point":n=e(t.geometry.coordinates,a);break;case"LineString":n.push(m(t.geometry.coordinates,a));break;case"MultiLineString":n=g(t.geometry.coordinates,a);break;case"Polygon":n.push(m(t.geometry.coordinates[0],a));break;case"MultiPolygon":n.push(g(t.geometry.coordinates[0],a))}return n}function d(t,e){var a=[];if(!e)return[];z(e)||(e=[e]);for(var n=0;n<e.length;n++)switch(e[n]){case"center":a="lat"===t?a.concat(f(t,R.center[0],"N")):a.concat(f(t,R.center[1],"S"));break;case"outline":"lon"===t?(a=a.concat(f(t,R.center[1]-89.99,"S")),a=a.concat(f(t,R.center[1]+89.99,"N"))):(a=a.concat(f(t,R.center[0]-179.99,"E")),a=a.concat(f(t,R.center[0]+179.99,"W")));break;default:if(x(e[n])){a="lat"===t?a.concat(f(t,e[n],"N")):a.concat(f(t,e[n],"S"));break}}return u(a)}function u(t){for(var e=[],a=0;a<t.length;a++){var n={type:"Feature",id:a,properties:{},geometry:{type:"Point"}};n.properties.value=t[a].value,n.properties.orientation=t[a].orientation,n.geometry.coordinates=t[a].coordinates,e.push(n)}return e}function f(t,e,a){var n,r,i,s,o,l=t,c=[],h=e;"equatorial"===R.transform&&"lon"===l&&(l="ra"),"ra"===l?(n=0,r=23,i=1):"lon"===l?(n=0,r=350,i=10):(n=-80,r=80,i=10);for(var p=n;p<=r;p+=i){var d=a;"lat"===l?(o=[h,p],s=p.toString()+"°",d+=p<0?"S":"N"):"ra"===l?(o=[15*p,h],s=p.toString()+"ʰ"):(o=[p,h],s=p.toString()+"°"),c.push({coordinates:o,value:s,orientation:d})}return c}function m(t,a){for(var n=[],r=0;r<t.length;r++)n.push(e(t[r],a));return n}function g(t,e){for(var a=[],n=0;n<t.length;n++)a.push(m(t[n],e));return a}function y(t){return z(t)?1===t.length?[t[0],t[0],t[0]]:2===t.length?[t[0],t[1],t[1]]:t.length>=3?t:void 0:[t,t,t]}function M(t){return document.getElementById(t)}function v(t){return t+"px"}function b(t,e){return Math.round(Math.pow(10,e)*t)/Math.pow(10,e)}function w(t){return t<10?"0"+t:t}function k(t,e){return null!==t&&hasOwnProperty.call(t,e)}function x(t){return!isNaN(parseFloat(t))&&isFinite(t)}function z(t){return null!==t&&"[object Array]"===Object.prototype.toString.call(t)}function T(t){var e=typeof t;return"function"===e||"object"===e&&!!t}function S(t){return t instanceof Date&&!isNaN(t)}function P(t){var e=0,a=0;if(t.offsetParent)do{e+=t.offsetLeft,a+=t.offsetTop}while(null!==(t=t.offsetParent));return[e,a]}function j(t,e){for(;t.parentNode;){if(t.id===e)return!0;t=t.parentNode}return!1}function I(t,e,a){var n=e.valueOf()-t.valueOf();switch(a||"d"){case"y":case"yr":n/=31556926080;break;case"m":case"mo":n/=26298e5;break;case"d":case"dy":n/=864e5;break;case"h":case"hr":n/=36e5;break;case"n":case"mn":n/=6e4;break;case"s":case"sec":n/=1e3}return Math.floor(n)}function q(t){if(t){var e=t.split(".");if(!(e.length<1)&&(e=e[0].split("-"),e[0]=e[0].replace(/\D/g,""),e[0]))return e[1]=e[1]?e[1].replace(/\D/g,""):"1",e[2]=e[2]?e[2].replace(/\D/g,""):"1",new Date(Date.UTC(e[0],e[1]-1,e[2]))}}function A(t,e,a){return t=(t*ut+pt)%pt,e=(e*ut+pt)%pt,Math.abs(t-e)>Math.PI&&(t>e?t-=pt:e>t&&(e-=pt)),d3.interpolateNumber(t/ut,e/ut)}function _(t){function a(){var t=this,e=t.value;!1!==F(t)&&(f.width=e,Z.resize({width:e}))}function n(){var t=this,e=t.value,a=C(e,f.transform);null!==a&&(f.center[0]=a),f.transform=e,Z.reload(f)}function r(){var t=this;t&&(f.projection=t.value,Z.reproject(f))}function i(){!1!==F(this)&&!1!==s()&&Z.rotate(f)}function s(){var t=M("centerx"),e=M("centery"),a=M("centerz");if(t&&e){if("equatorial"!==f.transform)f.center[0]=parseFloat(t.value);else{var n=parseFloat(t.value);f.center[0]=n>12?15*n-360:15*n}f.center[1]=parseFloat(e.value);var r=parseFloat(a.value);return f.center[2]=isNaN(r)?0:r,""!==t.value&&""!==e.value}}function o(){var t=this.value;t&&l(t)}function l(t){var a,n=[],r=yt;if("---"===t)return Z.constellation=null,a=Z.zoomBy(),1!==a&&n.push({param:"zoom",value:1/a,duration:0}),void Z.animate(n,!1);if(T(Z.constellations)&&k(Z.constellations,t)){var i=Z.constellations[t],s=e(i.center,ft[r.transform]);r.center=s,N(r.center,r.transform),a=Z.zoomBy(),1!==a&&n.push({param:"zoom",value:1/a,duration:0}),n.push({param:"center",value:s,duration:0});var o=1+360/i.scale;n.push({param:"zoom",value:o,duration:0}),Z.constellation=t,Z.animate(n,!1)}}function c(){var t,e=this;switch(Object.assign(f,Mt.set()),e.type){case"checkbox":t=e.checked,L(e);break;case"number":if(!1===F(e))return;t=parseFloat(e.value);break;case"color":if(!1===E(e))return;t=e.value;break;case"text":if(-1===e.id.search(/fill$/))return;if(!1===E(e))return;t=e.value;break;case"select-one":t=e.value}null!==t&&(h(e.id,t),"dsos-style-fill"===e.id?(h("dsos-style-stroke",t),h("dsos-nameStyle-fill",t)):"constellations-namesType"===e.id?B():"lang"===e.id?p(t):"advanced"===e.id&&G(t),s(),Z.apply(f))}function h(t,e){var a=t.split("-");switch(a.length){case 1:f[a[0]]=e;break;case 2:f[a[0]][a[1]]=e;break;case 3:f[a[0]][a[1]][a[2]]=e;break;default:return}}function p(t){for(var e=["dsos","constellations","planets"],a=0;a<e.length;a++)k(wt[e[a]][f.culture].names,t)?f[e[a]].namesType=t:k(wt[e[a]][f.culture].names,"desig")?f[e[a]].namesType="desig":f[e[a]].namesType="name";return k(wt.starnames[f.culture].propername,t)?f.stars.propernameType=t:f.stars.propernameType="desig",d(),B(),f}function d(){d3.selectAll("#celestial-form input, #celestial-form select").each(function(t,e){if(void 0!==this){var a=this.id;if("lat"===a||"lon"===a)z(f.geopos)&&(this.value="lat"===a?f.geopos[0]:f.geopos[1]);else if(-1!==a.search(/center/)){if(z(f.center))switch(a){case"centerx":this.value=f.center[0];break;case"centery":this.value=f.center[1];break;case"centerz":this.value=f.center[2]}}else{if("datetime"===a||"hr"===a||"min"===a||"sec"===a||"tz"===a)return;if("button"!==this.type){var n=u(a);switch(this.type){case"checkbox":this.checked=n,L(a);break;case"number":if(!1===F(this))break;this.value=parseFloat(u(a));break;case"color":if(!1===E(this))break;this.value=n;break;case"text":if(-1===a.search(/fill$/))break;if(!1===E(this))break;this.value=n;break;case"select-one":this.value=n}}}}})}function u(t){var e=t.split("-");switch(e.length){case 1:return f[e[0]];case 2:return f[e[0]][e[1]];case 3:return f[e[0]][e[1]][e[2]];default:return}}var f=Mt.set(t),m=Z.projections(),g=Z.eulerAngles(),y=d3.select("#celestial-form");if(y.size()<1){var v=f.container||"celestial-map";y=d3.select("#"+v).select(function(){return this.parentNode}).append("div").attr("id","celestial-form")}var b=y.append("div").attr("class","ctrl"),w=b.append("form").attr("id","params").attr("name","params").attr("method","get").attr("action","#"),x=w.append("div").attr("class","col").attr("id","general");x.append("label").attr("title","Map width in pixel, 0 indicates full width").attr("for","width").html("Width "),x.append("input").attr("type","number").attr("maxlength","4").attr("max","20000").attr("min","0").attr("title","Map width").attr("id","width").attr("value",f.width).on("change",a),x.append("span").html("px"),x.append("label").attr("title","Map projection, (hemi) indicates hemispherical projection").attr("for","projection").html("Projection");var S=x.append("select").attr("id","projection").on("change",r),P=0,j=Object.keys(m).map(function(t,e){var a=m[t].clip&&!0===m[t].clip?m[t].n+" (hemi)":m[t].n;return t===f.projection&&(P=e),{o:t,n:a}});S.selectAll("option").data(j).enter().append("option").attr("value",function(t){return t.o}).text(function(t){return t.n}),S.property("selectedIndex",P),P=0,x.append("label").attr("title","Coordinate space in which the map is displayed").attr("for","transform").html("Coordinates"),S=x.append("select").attr("id","transform").on("change",n),j=Object.keys(g).map(function(t,e){return t===f.transform&&(P=e),{o:t,n:t.replace(/^([a-z])/,function(t,e){return e.toUpperCase()})}}),S.selectAll("option").data(j).enter().append("option").attr("value",function(t){return t.o}).text(function(t){return t.n}),S.property("selectedIndex",P),x.append("br"),x.append("label").attr("title","Center coordinates long/lat in selected coordinate space").attr("for","centerx").html("Center"),x.append("input").attr("type","number").attr("id","centerx").attr("title","Center right ascension/longitude").attr("max","24").attr("min","0").attr("step","0.1").on("change",i),x.append("span").attr("id","cxunit").html("h"),x.append("input").attr("type","number").attr("id","centery").attr("title","Center declination/latitude").attr("max","90").attr("min","-90").attr("step","0.1").on("change",i),x.append("span").html("°"),x.append("label").attr("title","Orientation").attr("for","centerz").html("Orientation"),x.append("input").attr("type","number").attr("id","centerz").attr("title","Center orientation").attr("max","180").attr("min","-180").attr("step","0.1").on("change",i),x.append("span").html("°"),x.append("label").attr("for","orientationfixed").attr("class","advanced").html("Fixed"),x.append("input").attr("type","checkbox").attr("id","orientationfixed").attr("class","advanced").property("checked",f.orientationfixed).on("change",c),x.append("label").attr("title","Center and zoom in on this constellation").attr("for","constellation").html("Show"),x.append("select").attr("id","constellation").on("change",o),N(f.center,f.transform),x=w.append("div").attr("class","col").attr("id","stars"),x.append("label").attr("class","header").attr("for","stars-show").html("Stars"),x.append("input").attr("type","checkbox").attr("id","stars-show").property("checked",f.stars.show).on("change",c),x.append("label").attr("for","stars-limit").html("down to magnitude"),x.append("input").attr("type","number").attr("id","stars-limit").attr("title","Star display limit (magnitude)").attr("value",f.stars.limit).attr("max","6").attr("min","-1").attr("step","0.1").on("change",c),x.append("label").attr("for","stars-colors").html("with spectral colors"),x.append("input").attr("type","checkbox").attr("id","stars-colors").property("checked",f.stars.colors).on("change",c),x.append("label").attr("for","stars-color").html("or default color "),x.append("input").attr("type","color").attr("autocomplete","off").attr("id","stars-style-fill").attr("title","Star color").property("value",f.stars.style.fill).on("change",c),x.append("br");var I=wt.starnames[f.culture];for(var q in I)if(k(I,q)){var A=Object.keys(I[q]);A.length>1?(x.append("label").attr("for","stars-"+q).html("Show"),P=0,x.append("label").attr("title","Type of star name").attr("for","stars-"+q+"Type").html(""),S=x.append("select").attr("id","stars-"+q+"Type").on("change",c),j=A.map(function(t,e){return t===f.stars[q+"Type"]&&(P=e),{o:t,n:I[q][t]}}),S.selectAll("option").data(j).enter().append("option").attr("value",function(t){return t.o}).text(function(t){return t.n}),S.property("selectedIndex",P),x.append("input").attr("type","checkbox").attr("id","stars-"+q).property("checked",f.stars[q]).on("change",c)):1===A.length&&(x.append("label").attr("for","stars-"+q).html(" "+I[q][A[0]]),x.append("input").attr("type","checkbox").attr("id","stars-"+q).property("checked",f.stars[q]).on("change",c)),x.append("label").attr("for","stars-"+q+"Limit").html("down to mag"),x.append("input").attr("type","number").attr("id","stars-"+q+"Limit").attr("title","Star name display limit (magnitude)").attr("value",f.stars[q+"Limit"]).attr("max","6").attr("min","-1").attr("step","0.1").on("change",c)}x.append("br"),x.append("label").attr("for","stars-size").attr("class","advanced").html("Stellar disk size: base"),x.append("input").attr("type","number").attr("id","stars-size").attr("class","advanced").attr("title","Size of the displayed star disk; base").attr("value",f.stars.size).attr("max","100").attr("min","0").attr("step","0.1").on("change",c),x.append("label").attr("for","stars-exponent").attr("class","advanced").html(" * e ^ (exponent"),x.append("input").attr("type","number").attr("id","stars-exponent").attr("class","advanced").attr("title","Size of the displayed star disk; exponent").attr("value",f.stars.exponent).attr("max","3").attr("min","-1").attr("step","0.01").on("change",c),x.append("span").attr("class","advanced").text(" * (magnitude + 2))  [* adaptation]"),L(M("stars-show")),x=w.append("div").attr("class","col").attr("id","dsos"),x.append("label").attr("class","header").attr("title","Deep Space Objects").attr("for","dsos-show").html("DSOs"),x.append("input").attr("type","checkbox").attr("id","dsos-show").property("checked",f.dsos.show).on("change",c),x.append("label").attr("for","dsos-limit").html("down to mag"),x.append("input").attr("type","number").attr("id","dsos-limit").attr("title","DSO display limit (magnitude)").attr("value",f.dsos.limit).attr("max","6").attr("min","0").attr("step","0.1").on("change",c),x.append("label").attr("for","dsos-colors").html("with symbol colors"),x.append("input").attr("type","checkbox").attr("id","dsos-colors").property("checked",f.dsos.colors).on("change",c),x.append("label").attr("for","dsos-color").html("or default color "),x.append("input").attr("type","color").attr("autocomplete","off").attr("id","dsos-style-fill").attr("title","DSO color").property("value",f.dsos.style.fill).on("change",c),x.append("br"),I=wt.dsos[f.culture];for(q in I)if(k(I,q)){var _=Object.keys(I[q]);x.append("label").attr("for","dsos-"+q).html("Show"),P=0,x.append("label").attr("title","Type of DSO name").attr("for","dsos-"+q+"Type").attr("class","advanced").html(""),S=x.append("select").attr("id","dsos-"+q+"Type").attr("class","advanced").on("change",c),j=_.map(function(t,e){return t===f.stars[q+"Type"]&&(P=e),{o:t,n:I[q][t]}}),S.selectAll("option").data(j).enter().append("option").attr("value",function(t){return t.o}).text(function(t){return t.n}),S.property("selectedIndex",P),x.append("label").attr("for","dsos-"+q).html("names"),x.append("input").attr("type","checkbox").attr("id","dsos-"+q).property("checked",f.dsos[q]).on("change",c)}x.append("label").attr("for","dsos-nameLimit").html("down to mag"),x.append("input").attr("type","number").attr("id","dsos-nameLimit").attr("title","DSO name display limit (magnitude)").attr("value",f.dsos.nameLimit).attr("max","6").attr("min","0").attr("step","0.1").on("change",c),x.append("br"),x.append("label").attr("for","dsos-size").attr("class","advanced").html("DSO symbol size: (base"),x.append("input").attr("type","number").attr("id","dsos-size").attr("class","advanced").attr("title","Size of the displayed symbol: base").attr("value",f.dsos.size).attr("max","100").attr("min","0").attr("step","0.1").on("change",c),x.append("label").attr("for","dsos-exponent").attr("class","advanced").html(" * 2 [* adaptation] - magnitude) ^ exponent"),x.append("input").attr("type","number").attr("id","dsos-exponent").attr("class","advanced").attr("title","Size of the displayed symbol; exponent").attr("value",f.dsos.exponent).attr("max","3").attr("min","-1").attr("step","0.01").on("change",c),L(M("dsos-show")),x=w.append("div").attr("class","col").attr("id","constellations"),x.append("label").attr("class","header").html("Constellations"),I=wt.constellations[f.culture];for(q in I)if(k(I,q)){var O=Object.keys(I[q]);O.length>1?(x.append("label").attr("for","constellations-"+q).html("Show"),P=0,x.append("label").attr("title","Language of constellation names").attr("for","constellations-"+q+"Type").attr("class","advanced").html(""),S=x.append("select").attr("id","constellations-"+q+"Type").attr("class","advanced").on("change",c),j=O.map(function(t,e){return t===f.constellations[q+"Type"]&&(P=e),{o:t,n:I[q][t]}}),S.selectAll("option").data(j).enter().append("option").attr("value",function(t){return t.o}).text(function(t){return t.n}),S.property("selectedIndex",P),x.append("label").attr("for","constellations-"+q).html("names"),x.append("input").attr("type","checkbox").attr("id","constellations-"+q).property("checked",f.constellations[q]).on("change",c)):1===O.length&&(x.append("label").attr("for","constellations-"+q).attr("class","advanced").html(" "+I[q][O[0]]),x.append("input").attr("type","checkbox").attr("id","constellations-"+q).attr("class","advanced").property("checked",f.constellations[q]).on("change",c))}x.append("label").attr("for","constellations-lines").html(" lines"),x.append("input").attr("type","checkbox").attr("id","constellations-lines").property("checked",f.constellations.lines).on("change",c),x.append("label").attr("for","constellations-bounds").html(" boundaries"),x.append("input").attr("type","checkbox").attr("id","constellations-bounds").property("checked",f.constellations.bounds).on("change",c),L(M("constellations-names")),x=w.append("div").attr("class","col").attr("id","lines"),x.append("label").attr("class","header").html("Lines"),x.append("label").attr("title","Latitude/longitude grid lines").attr("for","lines-graticule").html("Graticule"),x.append("input").attr("type","checkbox").attr("id","lines-graticule-show").property("checked",f.lines.graticule.show).on("change",c),x.append("label").attr("for","lines-equatorial").html("Equator"),x.append("input").attr("type","checkbox").attr("id","lines-equatorial-show").property("checked",f.lines.equatorial.show).on("change",c),x.append("label").attr("for","lines-ecliptic").html("Ecliptic"),x.append("input").attr("type","checkbox").attr("id","lines-ecliptic-show").property("checked",f.lines.ecliptic.show).on("change",c),x.append("label").attr("for","lines-galactic").html("Galactic plane"),x.append("input").attr("type","checkbox").attr("id","lines-galactic-show").property("checked",f.lines.galactic.show).on("change",c),x.append("label").attr("for","lines-supergalactic").html("Supergalactic plane"),x.append("input").attr("type","checkbox").attr("id","lines-supergalactic-show").property("checked",f.lines.supergalactic.show).on("change",c),x=w.append("div").attr("class","col").attr("id","other"),x.append("label").attr("class","header").html("Other"),x.append("label").attr("for","mw-show").html("Milky Way"),x.append("input").attr("type","checkbox").attr("id","mw-show").property("checked",f.mw.show).on("change",c),x.append("label").attr("for","mw-style-fill").attr("class","advanced").html(" color"),x.append("input").attr("type","color").attr("id","mw-style-fill").attr("class","advanced").attr("title","Milky Way color").attr("value",f.mw.style.fill).on("change",c),x.append("label").attr("for","mw-style-opacity").attr("class","advanced").html(" opacity"),x.append("input").attr("type","number").attr("id","mw-style-opacity").attr("class","advanced").attr("title","Transparency of each Milky Way layer").attr("value",f.mw.style.opacity).attr("max","1").attr("min","0").attr("step","0.01").on("change",c),x.append("label").attr("for","advanced").html("Advanced options"),x.append("input").attr("type","checkbox").attr("id","advanced").property("checked",f.advanced).on("change",c),x.append("br"),x.append("label").attr("for","background").html("Background color"),x.append("input").attr("type","color").attr("id","background-fill").attr("title","Background color").attr("value",f.background.fill).on("change",c),x.append("label").attr("title","Star/DSO sizes are increased with higher zoom-levels").attr("for","adaptable").attr("class","advanced").html("Adaptable object sizes"),x.append("input").attr("type","checkbox").attr("id","adaptable").attr("class","advanced").property("checked",f.adaptable).on("change",c);var D=kt[f.culture];P=0,x.append("label").attr("title","General language setting").attr("for","lang").html("Object names "),S=x.append("select").attr("id","lang").on("change",c),j=D.map(function(t,e){return t===f.lang&&(P=e),{o:t,n:wt.constellations[f.culture].names[t]}}),j=[{o:"---",n:"(Select language)"}].concat(j),S.selectAll("option").data(j).enter().append("option").attr("value",function(t){return t.o}).text(function(t){return t.n}),S.property("selectedIndex",P),x=w.append("div").attr("class","col").attr("id","download"),x.append("label").attr("class","header").html("Download"),x.append("a").attr("href","#").attr("id","download-png").html("PNG Image").on("click",function(){this.setAttribute("download","d3-celestial.png");var t=document.querySelector("#"+f.container+" canvas");this.href=t.toDataURL("image/png").replace("image/png","image/octet-stream")}),x.append("a").attr("href","#").attr("id","download-svg").html("SVG File").on("click",function(){this.setAttribute("download","d3-celestial.svg"),this.href=W(f)}),H(),C(f.transform),U(t),G(f.advanced),Z.updateForm=d,Z.showConstellation=l,Z.setLanguage=function(t){var e=Mt.set();return-1!==kt[f.culture].indexOf(t)&&(e=p(t)),e}}function L(t){var e,a=t.id;switch(a){case"stars-show":e=!M(a).checked;for(var n=0;n<Tt[a].length;n++)O(Tt[a][n],e);case"stars-designation":for(e=!M("stars-designation").checked||!M("stars-show").checked,n=0;n<Tt["stars-designation"].length;n++)O(Tt["stars-designation"][n],e);case"stars-propername":for(e=!M("stars-propername").checked||!M("stars-show").checked,n=0;n<Tt["stars-propername"].length;n++)O(Tt["stars-propername"][n],e);break;case"dsos-show":for(e=!M(a).checked,n=0;n<Tt[a].length;n++)O(Tt[a][n],e);case"dsos-names":for(e=!M("dsos-names").checked||!M("dsos-show").checked,n=0;n<Tt["dsos-names"].length;n++)O(Tt["dsos-names"][n],e);break;case"planets-show":for(e=!M(a).checked,n=0;n<Tt[a].length;n++)O(Tt[a][n],e);case"planets-names":for(e=!M("planets-names").checked||!M("planets-show").checked,n=0;n<Tt["planets-names"].length;n++)O(Tt["planets-names"][n],e);break;case"constellations-names":case"mw-show":for(e=!M(a).checked,n=0;n<Tt[a].length;n++)O(Tt[a][n],e)}}function O(t,e){var a=M(t);a&&(a.disabled=e,a.style.color=e?"#999":"#000",a.previousSibling.style.color=e?"#999":"#000")}function D(t,e){var a=P(t);d3.select("#error").html(e).style({top:v(a[1]+t.offsetHeight+1),left:v(a[0]),opacity:1}),t.focus()}function F(t){var e,a="hr"===t.id||"min"===t.id||"sec"===t.id?1:0;if(t.validity){if(e=t.validity,e.typeMismatch||e.badInput)return D(t,t.title+": check field value"),!1;if(e.rangeOverflow||e.rangeUnderflow)return D(t,t.title+" must be between "+(parseInt(t.min)+a)+" and "+(parseInt(t.max)-a)),!1}else{if(e=t.value,!x(e))return D(t,t.title+": check field value"),!1;if((e=parseFloat(e))<t.min||e>t.max)return D(t,t.title+" must be between "+(t.min+a)+" and "+(+t.max-a)),!1}return d3.select("#error").style({top:"-9999px",left:"-9999px",opacity:0}),!0}function E(t){var e;if(t.validity){if(e=t.validity,e.typeMismatch||e.badInput)return D(t,t.title+": check field value"),!1;if(-1===t.value.search(/^#[0-9A-F]{6}$/i))return D(t,t.title+": not a color value"),!1}else{if(""===(e=t.value))return!0;if(-1===e.search(/^#[0-9A-F]{6}$/i))return D(t,t.title+": not a color value"),!1}return d3.select("#error").style({top:"-9999px",left:"-9999px",opacity:0}),!0}function C(t,e){var a=M("centerx");return a?(e&&("equatorial"===t&&"equatorial"!==e?(a.value=(a.value/15).toFixed(1),a.value<0&&(a.value+=24)):"equatorial"!==t&&"equatorial"===e&&(a.value=(15*a.value).toFixed(1),a.value>180&&(a.value-=360))),"equatorial"===t?(a.min="0",a.max="24",M("cxunit").innerHTML="h"):(a.min="-180",a.max="180",M("cxunit").innerHTML="°"),a.value):null}function N(t,e){var a=M("centerx"),n=M("centery"),r=M("centerz");a&&n&&((null===t||t.length<1)&&(t=[0,0,0]),(t.length<=2||void 0===t[2])&&(t[2]=0),a.value="equatorial"!==e?t[0].toFixed(1):t[0]<0?(t[0]/15+24).toFixed(1):(t[0]/15).toFixed(1),n.value=t[1].toFixed(1),r.value=null!==t[2]?t[2].toFixed(1):0)}function H(){var t,e,a,n=/\d+(\.\d+)?/g,r={s:6,d:6},i=Z.settings();return a=i.dsos.data,t=a.match(n),null!==t&&(r.d=parseFloat(t[t.length-1])),6!=r.d&&(M("dsos-limit").max=r.d,M("dsos-nameLimit").max=r.d),e=i.stars.data,t=e.match(n),null!==t&&(r.s=parseFloat(t[t.length-1])),6!=r.s&&(M("stars-limit").max=r.s,M("stars-designationLimit").max=r.s,M("stars-propernameLimit").max=r.s),r}function G(t){var e=t?"inline-block":"none";d3.selectAll(".advanced").style("display",e)}function U(t,e){var a,n;if(k(t,"formFields")){if(e&&k(t.formFields,e))return void d3.select("#"+e).style({display:"none"});if(!1!==t.form||!0!==t.location){!1===t.form&&d3.select("#celestial-form").style("display","none");for(n in t.formFields)k(t.formFields,n)&&"location"!==n&&(a=!1===t.formFields[n]?"none":"block",d3.select("#"+n).style({display:a}))}else{d3.select("#celestial-form").style("display","inline-block");for(n in t.formFields)k(t.formFields,n)&&"location"!==n&&d3.select("#"+n).style({display:"none"})}}}function B(){var t,e,a=d3.select("#constellation"),n=[],r=0,i=yt;if(Z.container.selectAll(".constname").each(function(a,s){t=a.id,t===i.constellation&&(r=s),e=a.properties[i.constellations.namesType],e!==t&&(e+=" ("+t+")"),n.push({o:t,n:e})}),n.length<1||a.length<1)return void setTimeout(B,1e3);n=[{o:"---",n:"(Select constellation)"}].concat(n),a.selectAll("option").remove(),a.selectAll("option").data(n).enter().append("option").attr("value",function(t){return t.o}).text(function(t){return t.n}),a.property("selectedIndex",r)}function V(t){function e(){p.setTime(Date.now()),M("datetime").value=r(p,d),o()}function a(){navigator.geolocation.getCurrentPosition(function(t){h=[b(t.coords.latitude,4),b(t.coords.longitude,4)],M("lat").value=h[0],M("lon").value=h[1],o()})}function n(){m.show(p)}function r(t,e){var a;if(e&&"0"!==e){var n=Math.floor(Math.abs(e)/60),r=Math.abs(e)-60*n;a=(e<0?" +":" −")+w(n)+w(r)}else a=" ±0000";return l(t)+a}function i(t){return!(!t||!z(t)||t.length<2)&&(!(!x(t[0])||t[0]<-90||t[0]>90)&&!(!x(t[1])||t[1]<-180||t[1]>180))}function s(){Object.assign(u,Mt.set()),u.horizon.show=!!M("horizon-show").checked,u.daylight.show=!!M("daylight-show").checked,u.planets.show=!!M("planets-show").checked,u.planets.names=!!M("planets-names").checked,u.planets.namesType=M("planets-namesType").value,u.planets.symbolType=M("planets-symbolType").value,L(M("planets-show")),Z.apply(u)}function o(){var t=M("lon").value,e=M("lat").value;Object.assign(u,Mt.set()),p=l.parse(M("datetime").value.slice(0,-6));var a=p.getTimezoneOffset(),n=new Date(p.valueOf()+6e4*(d-a));""!==t&&""!==e&&(h=[parseFloat(e),parseFloat(t)],c=Z.getPoint(mt.inverse(n,[90,0],h),u.transform),c[2]=0,"zenith"===u.follow&&Z.rotate({center:c}))}var l=d3.time.format("%Y-%m-%d %H:%M:%S"),c=[0,0],h=[0,0],p=new Date,d=p.getTimezoneOffset(),u=Mt.set(t),f=d3.select("#celestial-form form").insert("div","div#general").attr("id","loc"),m=new Ot(u,function(t,e){M("datetime").value=r(t,e),d=e,o()});k(u,"geopos")&&null!==u.geopos&&2===u.geopos.length&&(h=u.geopos);var g=f.append("div").attr("class","col").attr("id","location").style("display","none");g.append("label").attr("title","Location coordinates long/lat").attr("for","lat").html("Location"),g.append("input").attr("type","number").attr("id","lat").attr("title","Latitude").attr("placeholder","Latitude").attr("max","90").attr("min","-90").attr("step","0.0001").attr("value",h[0]).on("change",function(){!0===F(this)&&o()}),g.append("span").html("°"),g.append("input").attr("type","number").attr("id","lon").attr("title","Longitude").attr("placeholder","Longitude").attr("max","180").attr("min","-180").attr("step","0.0001").attr("value",h[1]).on("change",function(){!0===F(this)&&o()}),g.append("span").html("°"),"geolocation"in navigator&&g.append("input").attr("type","button").attr("value","Here").attr("id","here").on("click",a),g.append("label").attr("title","Local date/time").attr("for","datetime").html(" Date/time"),g.append("input").attr("type","button").attr("id","day-left").attr("title","One day back").on("click",function(){p.setDate(p.getDate()-1),M("datetime").value=r(p,d),o()}),g.append("input").attr("type","text").attr("id","datetime").attr("title","Date and time").attr("value",r(p,d)).on("click",n,!0).on("input",function(){this.value=r(p,d),m.isVisible()||n()}),g.append("div").attr("id","datepick").on("click",n),g.append("input").attr("type","button").attr("id","day-right").attr("title","One day forward").on("click",function(){p.setDate(p.getDate()+1),M("datetime").value=r(p,d),o()}),g.append("input").attr("type","button").attr("value","Now").attr("id","now").on("click",e),g.append("br"),g.append("label").attr("title","Show horizon marker").attr("for","horizon-show").html(" Horizon marker"),g.append("input").attr("type","checkbox").attr("id","horizon-show").property("checked",u.horizon.show).on("change",s),g.append("label").attr("title","Show daylight").attr("for","daylight-show").html("Daylight sky"),g.append("input").attr("type","checkbox").attr("id","daylight-show").property("checked",u.daylight.show).on("change",s),g.append("br"),g.append("label").attr("title","Show solar system objects").attr("for","planets-show").html(" Planets, Sun & Moon"),g.append("input").attr("type","checkbox").attr("id","planets-show").property("checked",u.planets.show).on("change",s);var y=wt.planets[u.culture];for(var v in y)if(k(y,v)){var T=Object.keys(y[v]);if(T.length>1){var P="symbol"===v?"as":"with";g.append("label").attr("for","planets-"+v+"Type").html(P);var I=0;g.append("label").attr("title","Type of planet name").attr("for","planets-"+v+"Type").attr("class","advanced").html("");var q=g.append("select").attr("id","planets-"+v+"Type").on("change",s),A=T.map(function(t,e){return t===u.planets[v+"Type"]&&(I=e),{o:t,n:y[v][t]}});q.selectAll("option").data(A).enter().append("option").attr("value",function(t){return t.o}).text(function(t){return t.n}),q.property("selectedIndex",I),"names"===v&&(q.attr("class","advanced"),
g.append("label").attr("for","planets-"+v).html("names"),g.append("input").attr("type","checkbox").attr("id","planets-"+v).property("checked",u.planets[v]).on("change",s))}}L(M("planets-show")),G(u.advanced),d3.select(document).on("mousedown",function(){!j(d3.event.target,"celestial-date")&&m.isVisible()&&m.hide()}),Z.getPosition=function(t){},Z.dateFormat=r,Z.date=function(t,e){if(!t)return p;d=e||d,m.isVisible()&&m.hide(),p.setTime(t.valueOf()),M("datetime").value=r(t,d),Z.redraw()},Z.timezone=function(t){if(!t)return d;d=t||d,m.isVisible()&&m.hide(),M("datetime").value=r(p,d),Z.redraw()},Z.position=function(){return h},Z.location=function(t){if(!t||t.length<2)return h;i(u.location)&&(h=u.location.slice(),M("lat").value=h[0],M("lon").value=h[1],o())},Z.skyview=function(t){var e=!1;if(m.isVisible()&&m.hide(),S(t.date)&&(p.setTime(t.date.valueOf()),M("datetime").value=r(t.date,d),e=!0),d=t.timezone||d,i(t.location)&&(h=t.location.slice(),M("lat").value=h[0],M("lon").value=h[1],e=!0),!0!==e)return{date:p,location:h};o()},Z.dtLoc=Z.skyview,Z.zenith=function(){return c},Z.nadir=function(){var t=-c[1],e=c[0]+180;return e>180&&(e-=360),[e,t-.001]},!k(t,"formFields")||!0!==t.location&&!0!==t.formFields.location||d3.select("#location").style({display:"inline-block"}),!0===t.location&&!0===t.formFields.location&&setTimeout(o,1e3)}function W(t){var e=document.createDocumentFragment(),a=d3.select(e).append("svg"),r=Z.metrics(),i=t.datapath,o=bt[t.projection],l=n(t.center),c=(l[0],l[1],Z.projection(t.projection).rotate(l).translate([r.width/2,r.height/2]).scale([r.scale]));if(o.clip){c.clipAngle(90);d3.geo.circle().angle([90])}var h=d3.geo.graticule().minorStep([15,10]),p=d3.geo.path().projection(c);t.lines.graticule&&("equatorial"===t.transform?a.append("path").datum(h).attr("class","gridline").attr("d",p):Z.graticule(a,p,t.transform)),a.attr("width",r.width).attr("height",r.height),a.append("path").datum(h.outline).attr("class","outline").attr("d",p).style("fill",t.background);for(var d in t.lines)k(t.lines,d)&&"graticule"!=d&&!1!==t.lines[d]&&a.append("path").datum(d3.geo.circle().angle([90]).origin(ht[d])).attr("class",d).style({"fill-opacity":t.mw.style.opacity,fill:t.mw.style.fill}).attr("d",p);t.mw.show&&d3.json(i+"mw.json",function(e,n){var r=s(n,t.transform);a.selectAll(".mway").data(r.features).enter().append("path").attr("class","mw").attr("d",p)});var u=d3.map({ellipse:function(t){var e=Math.sqrt(t),a=.666*e,n=e/3;return"M"+-a+","+-n+" m"+-a+",0 a"+a+","+n+" 0 1,0"+2*a+",0 a"+a+","+n+" 0 1,0"+-2*a+",0"},marker:function(t){var e=t>48?t/4:12,a=e/2,n=a-3;return"M "+-a+" 0 h "+n+" M 0 "+-a+" v "+n+" M "+a+" 0 h "+-n+" M 0 "+a+" v "+-n},"cross-circle":function(t){var e=Math.sqrt(t),a=e/2;return"M"+-a+","+-a+" m"+-a+",0 a"+a+","+a+" 0 1,0"+2*a+",0 a"+a+","+a+" 0 1,0"+-2*a+",0 M"+-a+" 0 h "+e+" M 0 "+-a+" v "+e},"stroke-circle":function(t){var e=Math.sqrt(t),a=e/2;return"M"+-a+","+-a+" m"+-a+",0 a"+a+","+a+" 0 1,0"+2*a+",0 a"+a+","+a+" 0 1,0"+-2*a+",0 M"+(-e-2)+","+(-e-2)+" l"+(e+4)+","+(e+4)}});d3.svg.customSymbol=function(){function t(t,n){return u.get(e.call(this,t,n))(a.call(this,t,n))}var e,a=64;return t.type=function(a){return arguments.length?(e=d3.functor(a),t):e},t.size=function(e){return arguments.length?(a=d3.functor(e),t):a},t};var f=d3.select("svg").attr("title","D3-Celestial").attr("version",1.1).attr("xmlns","http://www.w3.org/2000/svg").node().parentNode.innerHTML,m=new Blob([f],{type:"image/svg+xml;charset=utf-8"});return URL.createObjectURL(m)}var R,Y,J,$,K,Q,Z={version:"0.7.10",container:null,data:[]},X=.035,tt=1.4,et=2e3,at=2500,nt=1500,rt=10,it=1,st={};if(Z.display=function(a){function r(){var t=k(wt.constellations,Kt)?"."+Kt:"",a=k(wt.starnames,Kt)?"."+Kt:"";D(Et.clip),jt.append("path").datum(Zt.outline).attr("class","outline"),jt.append("path").datum(K).attr("class","horizon"),jt.append("path").datum(Q).attr("class","daylight");for(var n in R.lines)k(R.lines,n)&&("graticule"===n?(jt.append("path").datum(Zt).attr("class","graticule"),k(R.lines.graticule,"lon")&&R.lines.graticule.lon.pos.length>0&&jt.selectAll(".gridvalues_lon").data(d("lon",R.lines.graticule.lon.pos)).enter().append("path").attr("class","graticule_lon"),k(R.lines.graticule,"lat")&&R.lines.graticule.lat.pos.length>0&&jt.selectAll(".gridvalues_lat").data(d("lat",R.lines.graticule.lat.pos)).enter().append("path").attr("class","graticule_lat")):jt.append("path").datum(d3.geo.circle().angle([90]).origin(e(ht[n],ft[Ct]))).attr("class",n));d3.json(Jt+"mw.json",function(t,e){if(t)return window.alert("Data file could not be loaded or doesn't exist. See readme.md"),console.warn(t);var a=s(e,Ct),n=h(a);jt.selectAll(".mway").data(a.features).enter().append("path").attr("class","mw"),jt.selectAll(".mwaybg").data(n.features).enter().append("path").attr("class","mwbg"),g()});var r="constellations"+t+".json";d3.json(Jt+r,function(t,e){if(t)return console.warn(t);var a=s(e,Ct);jt.selectAll(".constnames").data(a.features).enter().append("text").attr("class","constname"),Z.constellations=c(a),g()}),r="constellations.bounds"+t+".json",d3.json(Jt+r,function(t,e){if(t)return console.warn(t);var a=s(e,Ct);jt.selectAll(".bounds").data(a.features).enter().append("path").attr("class","boundaryline"),g()}),r="constellations.lines"+t+".json",d3.json(Jt+r,function(t,e){if(t)return console.warn(t);var a=s(e,Ct);jt.selectAll(".lines").data(a.features).enter().append("path").attr("class","constline"),B(),g()}),d3.json(Jt+R.stars.data,function(t,e){if(t)return console.warn(t);var a=s(e,Ct);jt.selectAll(".stars").data(a.features).enter().append("path").attr("class","star"),g()}),r="starnames"+a+".json",d3.json(Jt+r,function(t,e){if(t)return console.warn(t);Object.assign(st,e),g()}),d3.json(Jt+R.dsos.data,function(t,e){if(t)return console.warn(t);var a=s(e,Ct);jt.selectAll(".dsos").data(a.features).enter().append("path").attr("class","dso"),g()}),d3.json(Jt+"planets.json",function(t,e){if(t)return console.warn(t);var a=o(e);jt.selectAll(".planets").data(a).enter().append("path").attr("class","planet"),g()}),Z.data.length>0&&Z.data.forEach(function(t){k(t,"file")?d3.json(t.file,t.callback):setTimeout(t.callback,0)},this),R.lang&&""!=R.lang&&p(Z.setLanguage(R.lang))}function i(t){if(t&&1!==t){var e=Y.scale(),a=e*t,n=J.scaleExtent(),r=nt*Math.sqrt(Math.abs(1-t));a<n[0]&&(a=n[0]),a>n[1]&&(a=n[1]);var i=d3.interpolateNumber(e,a);return d3.select({}).transition().duration(r).tween("scale",function(){return function(t){var e=i(t);Y.scale(e),g()}}).transition().duration(0).tween("scale",function(){J.scale(a),g()}),r}}function p(t){R=R.set(t),g()}function u(t){var e,a,r,i=R.center,s=Y.rotate(),o=Y.scale(),l=et,c=!1,h=R.orientationfixed;b(s[1],1)===-b(t.center[1],1)&&(c=!0),R=R.set(t);var p=b(d3.geo.distance(i,R.center),2),d=d3.geo.distance([i[2],0],[R.center[2],0]);return p<X&&d<X?(Yt=n(R.center),Y.rotate(Yt),g()):(a=o>Gt*tt?d3.interpolateNumber(o,Gt):function(){return o},r=0===d?function(){return s[2]}:A(i[2],R.center[2]),p>3.14&&(R.center[0]-=.01),R.orientationfixed=!1,e=0===p?function(){return R.center}:d3.geo.interpolate(i,R.center),l=0!==p?l*p:l*d,d3.select({}).transition().duration(l).tween("center",function(){return function(t){var i=n(e(t));i[2]=r(t);var o=a(t<.5?t:1-t);c&&(i[1]=s[1]),Y.scale(o),Y.rotate(i),g()}}).transition().duration(0).tween("center",function(){R.orientationfixed=h,Yt=n(R.center),Y.rotate(Yt),g()})),l}function f(t){Dt=yt(),(R.width!==Dt||t)&&(Ht=Dt/Nt,Gt=Et.scale*Dt/1024,$t.style("width",v(Dt)).style("height",v(Ht)).attr("width",Dt*Ft).attr("height",Ht*Ft),J.scaleExtent([Gt,Gt*rt]).scale(Gt*it),Y.translate([Dt/2,Ht/2]).scale(Gt*it),_t&&(_t.style.height=v(Ht)),Gt*=it,g())}function m(e){var a=kt(e.projection);if(a){var n=Y.rotate(),r=Y.center(),s=Y.scale(),o=J.scaleExtent(),l=Z.projection(R.projection).center(r).translate([Dt/2,Ht/2]).scale([o[0]]),c=at,h=0,p=d3.interpolateNumber(Nt,a.ratio);Et.clip!=a.clip&&(c=0),D(a.clip);var d=Z.projection(e.projection).center(r).translate([Dt/2,Dt/a.ratio/2]).scale([a.scale*Dt/1024]),u=R.adaptable;return s>o[0]?(h=i(.1),setTimeout(m,h,e),h+c):((R.location||R.formFields.location)&&(O("horizon-show",a.clip),O("daylight-show",!a.clip)),Y=t(l,d),R.adaptable=!1,d3.select({}).transition().duration(c).tween("projection",function(){return function(t){Y.alpha(t).rotate(n),$.projection(Y),D(a.clip),Nt=p(t),Ht=Dt/Nt,$t.style("width",v(Dt)).style("height",v(Ht)).attr("width",Dt*Ft).attr("height",Ht*Ft),_t&&(_t.style.height=v(Ht)),g()}}).transition().duration(0).tween("projection",function(){Et=a,Nt=Et.ratio,Ht=Dt/Et.ratio,Gt=Et.scale*Dt/1024,$t.style("width",v(Dt)).style("height",v(Ht)).attr("width",Dt*Ft).attr("height",Ht*Ft),_t&&(_t.style.height=v(Ht)),R.projection=e.projection,Y=Z.projection(e.projection).rotate(n).translate([Dt/2,Ht/2]).scale(Gt*it),$.projection(Y),D(Et.clip),J.projection(Y).scaleExtent([Gt,Gt*rt]).scale(Gt*it),R.adaptable=u,Gt*=it,g()}),c)}}function g(){var t=Y.rotate();Qt.setTransform(Ft,0,0,Ft,0,0),R.adaptable&&(Rt=Math.sqrt(Y.scale()/Gt)),Rt||(Rt=1),Ut=R.stars.size,Vt=R.stars.exponent,Bt=R.dsos.size||Ut,Wt=R.dsos.exponent,R.orientationfixed&&(t[2]=R.center[2],Y.rotate(t)),R.center=[-t[0],-t[1],t[2]],N(R.center,R.transform),mt(),w(),R.mw.show&&(jt.selectAll(".mw").each(function(t){S(R.mw.style),$(t),Qt.fill()}),"supergalactic"!==R.transform&&jt.selectAll(".mwbg").each(function(t){S(R.background),$(t),Qt.fill()}));for(var a in R.lines)k(R.lines,a)&&!0===R.lines[a].show&&(S(R.lines[a]),jt.selectAll("."+a).attr("d",$),Qt.stroke());if(k(R.lines.graticule,"lon")&&(P(R.lines.graticule.lon),jt.selectAll(".graticule_lon").each(function(t,e){if(T(t.geometry.coordinates)){var a=Y(t.geometry.coordinates);ut(a,t.properties.orientation),Qt.fillText(t.properties.value,a[0],a[1])}})),k(R.lines.graticule,"lat")&&(P(R.lines.graticule.lat),jt.selectAll(".graticule_lat").each(function(t,e){if(T(t.geometry.coordinates)){var a=Y(t.geometry.coordinates);ut(a,t.properties.orientation),Qt.fillText(t.properties.value,a[0],a[1])}})),R.constellations.bounds&&(jt.selectAll(".boundaryline").each(function(t){S(R.constellations.boundStyle),Z.constellation&&Z.constellation===t.id&&(Qt.lineWidth*=1.5,Qt.setLineDash([])),$(t),Qt.stroke()}),Qt.setLineDash([])),R.constellations.lines&&jt.selectAll(".constline").each(function(t){j(t.properties.rank,R.constellations.lineStyle),$(t),Qt.stroke()}),w(!0),R.constellations.names&&jt.selectAll(".constname").each(function(t){if(T(t.geometry.coordinates)){j(t.properties.rank,R.constellations.nameStyle);var e=Y(t.geometry.coordinates);Qt.fillText(ct(t),e[0],e[1])}}),R.stars.show&&(S(R.stars.style),jt.selectAll(".star").each(function(t){if(T(t.geometry.coordinates)&&t.properties.mag<=R.stars.limit){var e=Y(t.geometry.coordinates),a=ot(t);Qt.fillStyle=lt(t),Qt.beginPath(),Qt.arc(e[0],e[1],a,0,2*Math.PI),Qt.closePath(),Qt.fill(),R.stars.designation&&t.properties.mag<=R.stars.designationLimit*Rt&&(P(R.stars.designationStyle),Qt.fillText(U(t.id),e[0]+a,e[1])),R.stars.propername&&t.properties.mag<=R.stars.propernameLimit*Rt&&(P(R.stars.propernameStyle),Qt.fillText(W(t.id),e[0]-a,e[1]))}})),R.dsos.show&&jt.selectAll(".dso").each(function(t){if(T(t.geometry.coordinates)&&F(t.properties,R.dsos.limit)){var e=Y(t.geometry.coordinates),a=t.properties.type;S(!0===R.dsos.colors?R.dsos.symbols[a]:R.dsos.style);var n=E(t,e);k(R.dsos.symbols[a],"stroke")?Qt.stroke():Qt.fill(),R.dsos.names&&F(t.properties,R.dsos.nameLimit)&&(P(R.dsos.nameStyle),!0===R.dsos.colors&&(Qt.fillStyle=R.dsos.symbols[a].fill),Qt.fillText(G(t),e[0]+n,e[1]-n))}}),(R.location||R.formFields.location)&&R.planets.show&&Z.origin){var n=Z.date(),r=Z.origin(n).spherical();jt.selectAll(".planet").each(function(t){var a=t.id(),i=6,s=t(n).equatorial(r),o=e(s.ephemeris.pos,ft[R.transform]);if(T(o)){var l=Y(o),c=R.planets.symbols[a];if("letter"===R.planets.symbolType?(P(R.planets.symbolStyle),Qt.fillStyle=c.fill,Qt.fillText(c.letter,l[0],l[1])):"lun"===a?xt.symbol().type("crescent").size(144).age(s.ephemeris.age).position(l)(Qt):"disk"===R.planets.symbolType?(i=pt(s.ephemeris),Qt.fillStyle=c.fill,Qt.beginPath(),Qt.arc(l[0],l[1],i,0,2*Math.PI),Qt.closePath(),Qt.fill()):"symbol"===R.planets.symbolType&&(P(R.planets.symbolStyle),Qt.fillStyle=c.fill,Qt.fillText(c[R.planets.symbolType],l[0],l[1])),R.planets.names){var h=s[R.planets.namesType];P(R.planets.nameStyle),Qt.fillStyle=c.fill,Qt.fillText(h,l[0]-i,l[1]+i)}}})}if(Z.data.length>0&&Z.data.forEach(function(t){t.redraw()}),(R.location||R.formFields.location)&&R.daylight.show&&Et.clip){var i=l("sol");if(i){var s=Z.zenith(),o=i.ephemeris.pos,c=d3.geo.distance(s,o),h=Y(o);Q.origin(o),I(c,h),jt.selectAll(".daylight").datum(Q).attr("d",$),Qt.fill(),Qt.fillStyle="#fff",T(o)&&(Qt.beginPath(),Qt.arc(h[0],h[1],6,0,2*Math.PI),Qt.closePath(),Qt.fill())}}(R.location||R.formFields.location)&&R.horizon.show&&!Et.clip&&(K.origin(Z.nadir()),S(R.horizon),jt.selectAll(".horizon").datum(K).attr("d",$),Qt.fill(),R.horizon.stroke&&Qt.stroke()),R.controls&&L(Y.scale()),gt&&Z.runCallback()}function w(t){var e=Y.rotate();kt(R.projection);Y.rotate([0,0]),S(R.background),jt.selectAll(".outline").attr("d",$),!0===t?Qt.stroke():Qt.fill(),Y.rotate(e)}function T(t){return Et.clip&&d3.geo.distance(R.center,t)>dt?0:1}function S(t){Qt.fillStyle=t.fill||null,Qt.strokeStyle=t.stroke||null,Qt.lineWidth=t.width||null,Qt.globalAlpha=t.opacity||1,Qt.font=t.font||null,k(t,"dash")?Qt.setLineDash(t.dash):Qt.setLineDash([]),Qt.beginPath()}function P(t){Qt.fillStyle=t.fill,Qt.textAlign=t.align||"left",Qt.textBaseline=t.baseline||"bottom",Qt.globalAlpha=t.opacity||1,Qt.font=t.font}function j(t,e){t=t||1,Qt.fillStyle=z(e.fill)?e.fill[t-1]:null,Qt.strokeStyle=z(e.stroke)?e.stroke[t-1]:null,Qt.lineWidth=z(e.width)?e.width[t-1]:null,Qt.globalAlpha=z(e.opacity)?e.opacity[t-1]:1,Qt.font=z(e.font)?e.font[t-1]:null,Qt.textAlign=e.align||"left",Qt.textBaseline=e.baseline||"bottom",Qt.beginPath()}function I(t,e){var a,n,r,i;if(t>1.885)return Qt.fillStyle="transparent",void(Qt.globalAlpha=0);t<=1.36?(n="#daf1fa",r="#93d7f0",i="#57c0e8",a=-(1.36-t)/10):(a=(t-1.36)/(1.885-1.36),n=d3.interpolateLab("#daf1fa","#e8c866")(a),r=d3.interpolateLab("#93d7d0","#ff854a")(a),i=d3.interpolateLab("#57c0c8","#6caae2")(a));var s=Qt.createRadialGradient(e[0],e[1],0,e[0],e[1],300);s.addColorStop(0,n),s.addColorStop(.2+.4*a,r),s.addColorStop(1,i),Qt.fillStyle=s,Qt.globalAlpha=.9*(1-q(a,1.5))}function q(t,e){return(Math.pow(Math.E,t*e)-1)/(Math.pow(Math.E,e)-1)}function L(t){var e=M("celestial-zoomin"),a=M("celestial-zoomout"),n=Et.scale*Dt/1024;e&&a&&(e.disabled=t>=n*rt*.99,a.disabled=t<=n)}function D(t){t?Y.clipAngle(90):Y.clipAngle(null)}function F(t,e){return 999===t.mag&&Math.sqrt(parseInt(t.dim))>e||999!==t.mag&&t.mag<=e}function E(t,e){var a=t.properties,n=H(a)||9,r=C(a.type);return xt.symbol().type(r).size(n).position(e)(Qt),Math.sqrt(n)/2}function C(t){return t&&k(R.dsos.symbols,t)?R.dsos.symbols[t].shape:"circle"}function H(t){return t.mag&&999!==t.mag?Math.pow(2*Bt*Rt-t.mag,Wt):Math.pow(parseInt(t.dim)*Bt*Rt/7,.5)}function G(t){return t.properties[R.dsos.namesType]}function U(t){return k(st,t)?st[t][R.stars.designationType]:""}function W(t){var e=R.stars.propernameType;return k(st,t)?k(st[t],e)?st[t][e]:st[t].name:""}function ot(t){var e=t.properties.mag;if(null===e)return.1;var a=Ut*Rt*Math.exp(Vt*(e+2));return Math.max(a,.1)}function lt(t){var e=t.properties.bv;return!R.stars.colors||isNaN(e)?R.stars.style.fill:vt(e)}function ct(t){return t.properties[R.constellations.namesType]}function pt(t){var e=t.mag;if(null===e)return 2;var a=4*Rt*Math.exp(-.05*(e+2));return Math.max(a,2)}function ut(t,e){for(var a=e.split(""),n="center",r="middle",i=a.length-1;i>=0;i--)switch(a[i]){case"N":r="bottom";break;case"S":r="top";break;case"E":n="left",t[0]+=2;break;case"W":n="right",t[0]-=2}return Qt.textAlign=n,Qt.textBaseline=r,t}function mt(){Qt.clearRect(0,0,Dt+Ot[0],Ht+Ot[1])}function yt(){return R.width&&R.width>0?R.width:_t?_t.getBoundingClientRect().width-Ot[0]:window.getBoundingClientRect().width-2*Ot[0]}function kt(t){if(k(bt,t)){var e=bt[t];return k(e,"ratio")||(e.ratio=2),e}}function zt(){if(It&&!(It.length<1)){var t,e=It[qt];switch(e.param){case"projection":t=m({projection:e.value});break;case"center":t=u({center:e.value});break;case"zoom":t=i(e.value)}e.callback&&setTimeout(e.callback,t),qt++,!0===At&&qt===It.length&&(qt=0),t=0===e.duration||e.duration<t?t:e.duration,qt<It.length&&(Pt=setTimeout(zt,t))}}function Tt(){clearTimeout(Pt)}var St,Pt,jt=Z.container,It=[],qt=0,At=!1;R=Mt.set(a).applyDefaults(a),x(R.zoomextend)&&(rt=R.zoomextend),x(R.zoomlevel)&&(it=R.zoomlevel);var _t=M(R.container);if(_t){St="#"+R.container;var Lt=window.getComputedStyle(_t,null);parseInt(Lt.width)||R.width||(_t.style.width=v(_t.parentNode.clientWidth))}else St="body",_t=null;var Ot=[16,16],Dt=yt(),Ft=window.devicePixelRatio||1,Et=kt(R.projection);if(R.lines.graticule.lat&&"outline"===R.lines.graticule.lat.pos[0]&&(Et.scale-=2),Et){var Ct=R.transform||"equatorial",Nt=Et.ratio,Ht=Dt/Nt,Gt=Et.scale*Dt/1024,Ut=R.stars.size,Bt=R.dsos.size||Ut,Vt=R.stars.exponent,Wt=R.dsos.exponent||Vt,Rt=1,Yt=n(R.center),Jt=R.datapath;"body"!==St&&(M(R.container).style.height=v(Ht)),Y=Z.projection(R.projection).rotate(Yt).translate([Dt/2,Ht/2]).scale(Gt*it),J=d3.geo.zoom().projection(Y).center([Dt/2,Ht/2]).scaleExtent([Gt,Gt*rt]).on("zoom.redraw",g),Gt*=it;var $t=d3.select(St).selectAll("canvas"),Kt=""!==R.culture&&"iau"!==R.culture?R.culture:"";0===$t[0].length&&($t=d3.select(St).append("canvas")),$t.style("width",v(Dt)).style("height",v(Ht)).attr("width",Dt*Ft).attr("height",Ht*Ft);var Qt=$t.node().getContext("2d");Qt.setTransform(Ft,0,0,Ft,0,0);var Zt=d3.geo.graticule().minorStep([15,10]);$=d3.geo.path().projection(Y).context(Qt),jt?jt.selectAll("*").remove():jt=d3.select(St).append("container"),R.interactive?($t.call(J),d3.select(St).on("dblclick",function(){return i(1.5625),!1})):$t.attr("style","cursor: default!important"),D(Et.clip),d3.select(window).on("resize",f),!0===R.controls&&null===M("celestial-zoomin")&&(d3.select(St).append("input").attr("type","button").attr("id","celestial-zoomin").attr("value","+").on("click",function(){return i(1.25),!1}),d3.select(St).append("input").attr("type","button").attr("id","celestial-zoomout").attr("value","−").on("click",function(){return i(.8),!1})),K=d3.geo.circle().angle([90]),Q=d3.geo.circle().angle([179.9]),_(R),null===M("error")&&d3.select("body").append("div").attr("id","error"),null===M("loc")?V(R):!0===R.location&&"zenith"===R.follow&&u({center:Z.zenith()}),!0!==R.location&&!0!==R.formFields.location||(d3.select("#location").style("display","inline-block"),O("horizon-show",Et.clip),O("daylight-show",!Et.clip)),this.container=jt,this.clip=T,this.map=$,this.mapProjection=Y,this.context=Qt,this.metrics=function(){return{width:Dt,height:Ht,margin:Ot,scale:Gt}},this.setStyle=S,this.setTextStyle=P,this.setStyleA=j,this.setConstStyle=function(t,e){var a=y(e);Qt.font=a[t]},this.symbol=xt.symbol,this.dsoSymbol=E,this.redraw=g,this.resize=function(t){return void 0!==t&&(k(t,"width")?R.width=t.width:x(t)&&(R.width=t)),f(!0),R.width},this.reload=function(t){t&&k(t,"transform")&&(Ct=R.transform=t.transform,"equatorial"===Ct?Zt.minorStep([15,10]):Zt.minorStep([10,10]),jt.selectAll("*").remove(),r())},this.apply=function(t){p(t)},this.reproject=function(t){return m(t)},this.rotate=function(t){return t?u(t):R.center},this.zoomBy=function(t){return t?i(t):Y.scale()/Gt},this.color=function(t){return t&&k(R.dsos.symbols,t)?R.dsos.symbols[t].fill:"#000"},this.starColor=lt,this.animate=function(t,e){t&&(It=t,qt=0,At=!!e,zt())},this.stop=function(t){Tt(),!0===t&&(It=[])},this.go=function(t){It.length<1||(t&&t<It.length&&(qt=t),zt())},r()}},"object"==typeof module&&module.exports){var ot=require("./lib/d3.js"),lt=require("./lib/d3.geo.projection.js");module.exports={Celestial:function(){return Z},d3:function(){return ot},"d3.geo.projection":function(){return lt}}}Z.projection=function(t){var e,a,n;if(!k(bt,t))throw new Error("Projection not supported: "+t);return e=bt[t],a=null!==e.arg?d3.geo[t].raw(e.arg):d3.geo[t].raw,n=function(t,e){return a(-t,e)},n.invert=function(t,e){try{var n=a.invert(t,e);return n[0]=n&&-n[0],n}catch(t){console.log(t)}},d3.geo.projection(n)};var ct={equatorial:[0,0,0],ecliptic:[0,0,23.4393],galactic:[93.5949,28.9362,-58.5988],supergalactic:[137.31,59.5283,57.7303]},ht={equatorial:[0,90],ecliptic:[-90,66.5607],galactic:[-167.1405,27.1283],supergalactic:[-76.2458,15.7089]};Z.eulerAngles=function(){return ct},Z.poles=function(){return ht};var pt=2*Math.PI,dt=Math.PI/2,ut=Math.PI/180,ft={ecliptic:[-90,23.4393,90],"inverse ecliptic":[90,23.4393,-90],galactic:[-167.1405,62.8717,122.9319],"inverse galactic":[122.9319,62.8717,-167.1405],supergalactic:[283.7542,74.2911,26.4504],"inverse supergalactic":[26.4504,74.2911,283.7542],init:function(){for(var t in this)this[t].constructor==Array&&(this[t]=this[t].map(function(t){return t*ut}))},add:function(t,e){if(e&&t&&3===e.length&&!this.hasOwnProperty(t))return this[t]=e.map(function(t){return t*ut}),this[t]}};ft.init(),Z.euler=function(){return ft};var mt=function(t,e,a){var n=r(t,a[1])-e[0];n<0&&(n+=360),n*=ut;var i=e[1]*ut,s=a[0]*ut,o=Math.asin(Math.sin(i)*Math.sin(s)+Math.cos(i)*Math.cos(s)*Math.cos(n)),l=Math.acos((Math.sin(i)-Math.sin(o)*Math.sin(s))/(Math.cos(o)*Math.cos(s)));return Math.sin(n)>0&&(l=2*Math.PI-l),[o/ut,l/ut,0]};mt.inverse=function(t,e,a){var n=e[0]*ut,i=e[1]*ut,s=a[0]*ut,o=Math.asin(Math.sin(n)*Math.sin(s)+Math.cos(n)*Math.cos(s)*Math.cos(i)),l=((Math.sin(n)-Math.sin(o)*Math.sin(s))/(Math.cos(o)*Math.cos(s))).toFixed(6);return l=Math.acos(l),l/=ut,[r(t,a[1])-l,o/ut,0]},Z.horizontal=mt;var gt=!1;Z.add=function(t){var e={};return k(t,"type")?"dso"!==t.type&&"json"!==t.type||k(t,"file")&&k(t,"callback")?"line"!==t.type&&"raw"!==t.type||k(t,"callback")?(k(t,"file")&&(e.file=t.file),e.type=t.type,k(t,"callback")&&(e.callback=t.callback),k(t,"redraw")&&(e.redraw=t.redraw),void Z.data.push(e)):console.log("Can't add data"):console.log("Can't add data file"):console.log("Missing type")},Z.remove=function(t){if(null!==t&&t<Z.data.length)return Z.data.splice(t,1)},Z.clear=function(){Z.data=[]},Z.addCallback=function(t){Z.callback=t,gt=null!==t},Z.runCallback=function(t){gt=!1,Z.callback(),gt=!0},Z.getData=s,Z.getPoint=i,Z.getPlanet=l;var yt={},Mt={width:0,projection:"aitoff",transform:"equatorial",center:null,geopos:null,follow:"zenith",orientationfixed:!0,zoomlevel:null,zoomextend:10,adaptable:!0,interactive:!0,form:!1,location:!1,formFields:{location:!0,general:!0,stars:!0,dsos:!0,constellations:!0,lines:!0,other:!0,download:!1},advanced:!0,daterange:[],controls:!0,lang:"",culture:"",container:"celestial-map",datapath:"data/",stars:{show:!0,limit:6,colors:!0,style:{fill:"#ffffff",opacity:1},designation:!0,designationType:"desig",designationStyle:{fill:"#ddddbb",font:"11px 'Palatino Linotype', Georgia, Times, 'Times Roman', serif",align:"left",baseline:"top"},designationLimit:2.5,propername:!1,propernameType:"name",propernameStyle:{fill:"#ddddbb",font:"13px 'Palatino Linotype', Georgia, Times, 'Times Roman', serif",align:"right",baseline:"bottom"},propernameLimit:1.5,size:7,exponent:-.28,data:"stars.6.json"},dsos:{show:!0,limit:6,colors:!0,style:{fill:"#cccccc",stroke:"#cccccc",width:2,opacity:1},names:!0,desig:!0,namesType:"name",nameStyle:{fill:"#cccccc",font:"11px 'Lucida Sans Unicode', Helvetica, Arial, serif",align:"left",baseline:"top"},nameLimit:4,size:null,exponent:1.4,data:"dsos.bright.json",symbols:{gg:{shape:"circle",fill:"#ff0000"},g:{shape:"ellipse",fill:"#ff0000"},s:{shape:"ellipse",fill:"#ff0000"},s0:{shape:"ellipse",fill:"#ff0000"},sd:{shape:"ellipse",fill:"#ff0000"},e:{shape:"ellipse",fill:"#ff0000"},i:{shape:"ellipse",fill:"#ff0000"},oc:{shape:"circle",fill:"#ff9900",stroke:"#ff9900",width:2},gc:{shape:"circle",fill:"#ff9900"},en:{shape:"square",fill:"#ff00cc"},bn:{shape:"square",fill:"#ff00cc"},sfr:{shape:"square",fill:"#cc00ff"},rn:{shape:"square",fill:"#0000ff"},pn:{shape:"diamond",fill:"#00cccc"},snr:{shape:"diamond",fill:"#ff00cc"},dn:{shape:"square",fill:"#999999",stroke:"#999999",width:2},pos:{shape:"marker",fill:"#cccccc",stroke:"#cccccc",width:1.5}}},constellations:{show:!0,names:!0,namesType:"desig",nameStyle:{fill:"#cccc99",align:"center",baseline:"middle",opacity:.8,font:["14px 'Lucida Sans Unicode', Helvetica, Arial, sans-serif","12px 'Lucida Sans Unicode', Helvetica, Arial, sans-serif","11px 'Lucida Sans Unicode', Helvetica, Arial, sans-serif"]},lines:!0,lineStyle:{stroke:"#cccccc",width:1.5,opacity:.6},bounds:!1,boundStyle:{stroke:"#ccff00",width:1,opacity:.8,dash:[2,6]}},mw:{show:!0,style:{fill:"#ffffff",opacity:"0.15"}},lines:{graticule:{show:!0,stroke:"#cccccc",width:.6,opacity:.8,lon:{pos:[],fill:"#eee",font:"10px 'Lucida Sans Unicode', Helvetica, Arial, sans-serif"},lat:{pos:[],fill:"#eee",font:"10px 'Lucida Sans Unicode', Helvetica, Arial, sans-serif"}},equatorial:{show:!0,stroke:"#aaaaaa",width:1.3,opacity:.7},ecliptic:{show:!0,stroke:"#66cc66",width:1.3,opacity:.7},galactic:{show:!1,stroke:"#cc6666",width:1.3,opacity:.7},supergalactic:{show:!1,stroke:"#cc66cc",width:1.3,opacity:.7}},background:{fill:"#000000",opacity:1,stroke:"#000000",width:1.5},horizon:{show:!1,stroke:"#cccccc",width:1,fill:"#000000",opacity:.5},daylight:{show:!1},planets:{show:!1,which:["sol","mer","ven","ter","lun","mar","jup","sat","ura","nep","cer","plu"],symbols:{sol:{symbol:"☉",letter:"Su",fill:"#ffff00"},mer:{symbol:"☿",letter:"Me",fill:"#cccccc"},ven:{symbol:"♀",letter:"V",fill:"#eeeecc"},ter:{symbol:"⊕",letter:"T",fill:"#00ccff"},lun:{symbol:"●",letter:"L",fill:"#ffffff"},mar:{symbol:"♂",letter:"Ma",fill:"#ff6600"},cer:{symbol:"⚳",letter:"C",fill:"#cccccc"},ves:{symbol:"⚶",letter:"Ma",fill:"#cccccc"},jup:{symbol:"♃",letter:"J",fill:"#ffaa33"},sat:{symbol:"♄",letter:"Sa",fill:"#ffdd66"},ura:{symbol:"♅",letter:"U",fill:"#66ccff"},nep:{symbol:"♆",letter:"N",fill:"#6666ff"},plu:{symbol:"♇",letter:"P",fill:"#aaaaaa"},eri:{symbol:"⚪",letter:"E",fill:"#eeeeee"}},symbolStyle:{fill:"#00ccff",opacity:1,font:"bold 17px 'Lucida Sans Unicode', Consolas, sans-serif",align:"center",baseline:"middle"},symbolType:"symbol",names:!1,nameStyle:{fill:"#00ccff",font:"14px 'Lucida Sans Unicode', Consolas, sans-serif",align:"right",baseline:"top"},namesType:"en"},set:function(t){var e,a,n={},r={};if(0===Object.entries(yt).length?Object.assign(n,this):Object.assign(n,yt),!t)return n;for(e in n)if(k(n,e))if(k(t,e)&&null!==t[e])if(null===n[e]||n[e].constructor!=Object)r[e]=t[e];else{r[e]={};for(a in n[e])k(t[e],a)?r[e][a]=t[e][a]:r[e][a]=n[e][a]}else r[e]=n[e];return Object.assign(yt,r),r},applyDefaults:function(t){var e={};return Object.assign(e,yt),e.stars.size=e.stars.size||7,e.stars.exponent=e.stars.exponent||-.28,(!e.center||e.center.length<=0)&&(e.center=[0,0,0]),e.datapath=e.datapath||"",e.datapath=e.datapath.replace(/([^\/]$)/,"$1/"),e.culture&&-1!==e.culture.search(/^cn$/)||(e.culture="iau"),k(t,"stars")&&(k(t.stars,"names")&&(e.stars.designation=t.stars.names),k(t.stars,"namelimit")&&(e.stars.designationLimit=t.stars.namelimit),k(t.stars,"namestyle")&&Object.assign(e.stars.designationStyle,t.stars.namestyle),k(t.stars,"proper")&&(e.stars.propername=t.stars.proper),k(t.stars,"propernamelimit")&&(e.stars.propernameLimit=t.stars.propernamelimit),k(t.stars,"propernamestyle")&&Object.assign(e.stars.propernameStyle,t.stars.propernamestyle)),k(t,"dsos")&&(k(t.dsos,"names")&&!0===t.dsos.names&&(e.dsos.namesType="name"),k(t.dsos,"desig")&&!0===t.dsos.desig&&(e.dsos.namesType="desig"),k(t.dsos,"namelimit")&&(e.dsos.nameLimit=t.dsos.namelimit),k(t.dsos,"namestyle")&&Object.assign(e.dsos.nameStyle,t.dsos.namestyle)),e.dsos.namesType&&""!==e.dsos.namesType||(e.dsos.namesType="desig"),k(t,"constellations")&&(k(t.constellations,"show")&&!0===t.constellations.show&&(e.constellations.names=!0),k(t.constellations,"desig")&&!0===t.constellations.desig&&(e.constellations.namesType="desig"),"latin"===e.constellations.namesType&&(e.constellations.namesType="la"),"iau"===e.constellations.namesType&&(e.constellations.namesType="name"),k(t.constellations,"namestyle")&&Object.assign(e.constellations.nameStyle,t.constellations.namestyle),k(t.constellations,"linestyle")&&Object.assign(e.constellations.lineStyle,t.constellations.linestyle),k(t.constellations,"boundstyle")&&Object.assign(e.constellations.boundStyle,t.constellations.boundstyle)),e.constellations.namesType&&""!==e.constellations.namesType||(e.constellations.namesType="desig"),k(t,"planets")&&k(t.planets,"style")&&Object.assign(e.planets.style,t.planets.symbolStyle),e.planets.symbolType&&""!==e.planets.symbolType||(e.planets.symbolType="symbol"),e.planets.namesType&&""!==e.planets.namesType||(e.planets.namesType="desig"),e.constellations.nameStyle.font=y(e.constellations.nameStyle.font),e.constellations.nameStyle.opacity=y(e.constellations.nameStyle.opacity),e.constellations.nameStyle.fill=y(e.constellations.nameStyle.fill),e.constellations.lineStyle.width=y(e.constellations.lineStyle.width),e.constellations.lineStyle.opacity=y(e.constellations.lineStyle.opacity),e.constellations.lineStyle.stroke=y(e.constellations.lineStyle.stroke),Object.assign(yt,e),e}};Z.settings=function(){return Mt};var vt=d3.scale.quantize().domain([3.347,-.335]).range(["#ff4700","#ff4b00","#ff4f00","#ff5300","#ff5600","#ff5900","#ff5b00","#ff5d00","#ff6000","#ff6300","#ff6500","#ff6700","#ff6900","#ff6b00","#ff6d00","#ff7000","#ff7300","#ff7500","#ff7800","#ff7a00","#ff7c00","#ff7e00","#ff8100","#ff8300","#ff8506","#ff870a","#ff8912","#ff8b1a","#ff8e21","#ff9127","#ff932c","#ff9631","#ff9836","#ff9a3c","#ff9d3f","#ffa148","#ffa34b","#ffa54f","#ffa753","#ffa957","#ffab5a","#ffad5e","#ffb165","#ffb269","#ffb46b","#ffb872","#ffb975","#ffbb78","#ffbe7e","#ffc184","#ffc489","#ffc78f","#ffc892","#ffc994","#ffcc99","#ffce9f","#ffd1a3","#ffd3a8","#ffd5ad","#ffd7b1","#ffd9b6","#ffdbba","#ffddbe","#ffdfc2","#ffe1c6","#ffe3ca","#ffe4ce","#ffe8d5","#ffe9d9","#ffebdc","#ffece0","#ffefe6","#fff0e9","#fff2ec","#fff4f2","#fff5f5","#fff6f8","#fff9fd","#fef9ff","#f9f6ff","#f6f4ff","#f3f2ff","#eff0ff","#ebeeff","#e9edff","#e6ebff","#e3e9ff","#e0e7ff","#dee6ff","#dce5ff","#d9e3ff","#d7e2ff","#d3e0ff","#c9d9ff","#bfd3ff","#b7ceff","#afc9ff","#a9c5ff","#a4c2ff","#9fbfff","#9bbcff"]),bt={airy:{n:"Airy’s Minimum Error",arg:Math.PI/2,scale:360,ratio:1,clip:!0},aitoff:{n:"Aitoff",arg:null,scale:162},armadillo:{n:"Armadillo",arg:0,scale:250},august:{n:"August",arg:null,scale:94,ratio:1.4},azimuthalEqualArea:{n:"Azimuthal Equal Area",arg:null,scale:340,ratio:1,clip:!0},azimuthalEquidistant:{n:"Azimuthal Equidistant",arg:null,scale:320,ratio:1,clip:!0},baker:{n:"Baker Dinomic",arg:null,scale:160,ratio:1.4},berghaus:{n:"Berghaus Star",arg:0,scale:320,ratio:1,clip:!0},boggs:{n:"Boggs Eumorphic",arg:null,scale:170},bonne:{n:"Bonne",arg:Math.PI/2.5,scale:225,ratio:.88},bromley:{n:"Bromley",arg:null,scale:162},cassini:{n:"Cassini",arg:null,scale:325,ratio:1,clip:!0},collignon:{n:"Collignon",arg:null,scale:100,ratio:2.6},craig:{n:"Craig Retroazimuthal",arg:0,scale:310,ratio:1.5,clip:!0},craster:{n:"Craster Parabolic",arg:null,scale:160},cylindricalEqualArea:{n:"Cylindrical Equal Area",arg:Math.PI/6,scale:190,ratio:2.3},cylindricalStereographic:{n:"Cylindrical Stereographic",arg:Math.PI/4,scale:230,ratio:1.3},eckert1:{n:"Eckert I",arg:null,scale:175},eckert2:{n:"Eckert II",arg:null,scale:175},eckert3:{n:"Eckert III",arg:null,scale:190},eckert4:{n:"Eckert IV",arg:null,scale:190},eckert5:{n:"Eckert V",arg:null,scale:182},eckert6:{n:"Eckert VI",arg:null,scale:182},eisenlohr:{n:"Eisenlohr",arg:null,scale:102},equirectangular:{n:"Equirectangular",arg:null,scale:165},fahey:{n:"Fahey",arg:null,scale:196,ratio:1.4},mtFlatPolarParabolic:{n:"Flat Polar Parabolic",arg:null,scale:175},mtFlatPolarQuartic:{n:"Flat Polar Quartic",arg:null,scale:230,ratio:1.65},mtFlatPolarSinusoidal:{
n:"Flat Polar Sinusoidal",arg:null,scale:175,ratio:1.9},foucaut:{n:"Foucaut",arg:null,scale:142},ginzburg4:{n:"Ginzburg IV",arg:null,scale:180,ratio:1.7},ginzburg5:{n:"Ginzburg V",arg:null,scale:196,ratio:1.55},ginzburg6:{n:"Ginzburg VI",arg:null,scale:190,ratio:1.4},ginzburg8:{n:"Ginzburg VIII",arg:null,scale:205,ratio:1.3},ginzburg9:{n:"Ginzburg IX",arg:null,scale:190,ratio:1.4},homolosine:{n:"Goode Homolosine",arg:null,scale:160,ratio:2.2},hammer:{n:"Hammer",arg:2,scale:180},hatano:{n:"Hatano",arg:null,scale:186},healpix:{n:"HEALPix",arg:1,scale:320,ratio:1.2},hill:{n:"Hill Eucyclic",arg:2,scale:190,ratio:1.1},kavrayskiy7:{n:"Kavrayskiy VII",arg:null,scale:185,ratio:1.75},lagrange:{n:"Lagrange",arg:Math.PI/4,scale:88,ratio:1.6,clip:!1},larrivee:{n:"l'Arrivée",arg:null,scale:160,ratio:1.25},laskowski:{n:"Laskowski Tri-Optimal",arg:null,scale:165,ratio:1.7},loximuthal:{n:"Loximuthal",arg:Math.PI/4,scale:175,ratio:1.8},mercator:{n:"Mercator",arg:null,scale:160,ratio:1.3},miller:{n:"Miller",arg:null,scale:160,ratio:1.5},mollweide:{n:"Mollweide",arg:null,scale:180},naturalEarth:{n:"Natural Earth",arg:null,scale:185,ratio:1.85},nellHammer:{n:"Nell Hammer",arg:null,scale:160,ratio:2.6},orthographic:{n:"Orthographic",arg:null,scale:480,ratio:1,clip:!0},patterson:{n:"Patterson Cylindrical",arg:null,scale:160,ratio:1.75},polyconic:{n:"Polyconic",arg:null,scale:160,ratio:1.3},quincuncial:{n:"Quincuncial",arg:null,scale:160,ratio:1.3},rectangularPolyconic:{n:"Rectangular Polyconic",arg:0,scale:160,ratio:1.65},robinson:{n:"Robinson",arg:null,scale:160},sinusoidal:{n:"Sinusoidal",arg:null,scale:160,ratio:2},stereographic:{n:"Stereographic",arg:null,scale:500,ratio:1,clip:!0},times:{n:"Times",arg:null,scale:210,ratio:1.4},twoPointEquidistant:{n:"Two-Point Equidistant",arg:Math.PI/2,scale:320,ratio:1.15,clip:!0},vanDerGrinten:{n:"van Der Grinten",arg:null,scale:160,ratio:1},vanDerGrinten2:{n:"van Der Grinten II",arg:null,scale:160,ratio:1},vanDerGrinten3:{n:"van Der Grinten III",arg:null,scale:160,ratio:1},vanDerGrinten4:{n:"van Der Grinten IV",arg:null,scale:160,ratio:1.6},wagner4:{n:"Wagner IV",arg:null,scale:185},wagner6:{n:"Wagner VI",arg:null,scale:160},wagner7:{n:"Wagner VII",arg:null,scale:190,ratio:1.8},wiechel:{n:"Wiechel",arg:null,scale:360,ratio:1,clip:!0},winkel3:{n:"Winkel Tripel",arg:null,scale:196,ratio:1.7}};Z.projections=function(){return bt};var wt={starnames:{iau:{designation:{desig:"Designation",bayer:"Bayer",flam:"Flamsteed",var:"Variable",gl:"Gliese",hd:"Draper",hip:"Hipparcos"},propername:{name:"IAU Name",ar:"Arabic",zh:"Chinese",en:"English",fi:"Finnish",fr:"French",de:"German",el:"Greek",he:"Hebrew",hi:"Hindi",it:"Italian",ja:"Japanese",ko:"Korean",la:"Latin",fa:"Persian",ru:"Russian",es:"Spanish",tr:"Turkish"}},cn:{propername:{name:"Proper name",en:"English",pinyin:"Pinyin"},designation:{desig:"IAU Designation"}}},constellations:{iau:{names:{desig:"Designation",name:"IAU Name",ar:"Arabic",zh:"Chinese",cz:"Czech",en:"English",ee:"Estonian",fi:"Finnish",fr:"French",de:"German",el:"Greek",he:"Hebrew",hi:"Hindi",it:"Italian",ja:"Japanese",ko:"Korean",la:"Latin",fa:"Persian",ru:"Russian",es:"Spanish",tr:"Turkish"}},cn:{names:{name:"Proper name",en:"English",pinyin:"Pinyin"}}},planets:{iau:{symbol:{symbol:"☾ Symbol",letter:"Ⅼ Letter",disk:"● Disk"},names:{desig:"Designation",ar:"Arabic",zh:"Chinese",en:"English",fr:"French",de:"German",el:"Greek",he:"Hebrew",hi:"Hindi",it:"Italian",ja:"Japanese",ko:"Korean",la:"Latin",fa:"Persian",ru:"Russian",es:"Spanish"}},cn:{symbol:{symbol:"☾ Symbol",letter:"Ⅼ Letter",disk:"● Disk"},names:{desig:"Designation",name:"Chinese",pinyin:"Pinyin",en:"English"}}},dsos:{iau:{names:{desig:"Designation",name:"Name"}},cn:{names:{desig:"Designation",name:"Chinese",pinyin:"Pinyin",en:"English"}}}},kt={iau:Object.keys(wt.constellations.iau.names).concat(Object.keys(wt.constellations.iau.names)).filter(function(t,e,a){return a.indexOf(t)===e}),cn:Object.keys(wt.constellations.cn.names).concat(Object.keys(wt.constellations.cn.names)).filter(function(t,e,a){return a.indexOf(t)===e})},xt={};xt.symbol=function(){function t(t){s[a()](t)}var e,a=d3.functor("circle"),n=d3.functor(64),r=d3.functor(Math.PI),i=(d3.functor("#fff"),d3.functor("")),s=(d3.functor([2,2]),{circle:function(t){var a=Math.sqrt(n()),r=a/2;return t.arc(e[0],e[1],r,0,2*Math.PI),t.closePath(),r},square:function(t){var a=Math.sqrt(n()),r=a/1.7;return t.moveTo(e[0]-r,e[1]-r),t.lineTo(e[0]+r,e[1]-r),t.lineTo(e[0]+r,e[1]+r),t.lineTo(e[0]-r,e[1]+r),t.closePath(),r},diamond:function(t){var a=Math.sqrt(n()),r=a/1.5;return t.moveTo(e[0],e[1]-r),t.lineTo(e[0]+r,e[1]),t.lineTo(e[0],e[1]+r),t.lineTo(e[0]-r,e[1]),t.closePath(),r},triangle:function(t){var a=Math.sqrt(n()),r=a/Math.sqrt(3);return t.moveTo(e[0],e[1]-r),t.lineTo(e[0]+r,e[1]+r),t.lineTo(e[0]-r,e[1]+r),t.closePath(),r},ellipse:function(t){var a=Math.sqrt(n()),r=a/2;return t.save(),t.translate(e[0],e[1]),t.scale(1.6,.8),t.beginPath(),t.arc(0,0,r,0,2*Math.PI),t.closePath(),t.restore(),r},marker:function(t){var a=Math.sqrt(n()),r=a/2;return t.moveTo(e[0],e[1]-r),t.lineTo(e[0],e[1]+r),t.moveTo(e[0]-r,e[1]),t.lineTo(e[0]+r,e[1]),t.closePath(),r},"cross-circle":function(t){var a=Math.sqrt(n()),r=a/2;return t.moveTo(e[0],e[1]-a),t.lineTo(e[0],e[1]+a),t.moveTo(e[0]-a,e[1]),t.lineTo(e[0]+a,e[1]),t.stroke(),t.beginPath(),t.moveTo(e[0],e[1]),t.arc(e[0],e[1],r,0,2*Math.PI),t.closePath(),r},"stroke-circle":function(t){var a=Math.sqrt(n()),r=a/2;return t.moveTo(e[0],e[1]-a),t.lineTo(e[0],e[1]+a),t.stroke(),t.beginPath(),t.moveTo(e[0],e[1]),t.arc(e[0],e[1],r,0,2*Math.PI),t.closePath(),r},crescent:function(t){var a=Math.sqrt(n()),i=a/2,s=r(),o=.5*(1-Math.cos(s)),l=1.6*Math.abs(o-.5)+.01,c=s>Math.PI,h=Math.abs(o)>.5?c:!c;return t.save(),t.fillStyle="#557",t.beginPath(),t.moveTo(e[0],e[1]),t.arc(e[0],e[1],i,0,2*Math.PI),t.closePath(),t.fill(),t.fillStyle="#eee",t.beginPath(),t.moveTo(e[0],e[1]),t.arc(e[0],e[1],i,-Math.PI/2,Math.PI/2,c),t.scale(l,1),t.arc(e[0]/l,e[1],i,Math.PI/2,-Math.PI/2,h),t.closePath(),t.fill(),t.restore(),i}});return t.type=function(e){return arguments.length?(a=d3.functor(e),t):a},t.size=function(e){return arguments.length?(n=d3.functor(e),t):n},t.age=function(e){return arguments.length?(r=d3.functor(e),t):r},t.text=function(e){return arguments.length?(i=d3.functor(e),t):i},t.position=function(a){if(arguments.length)return e=a,t},t},Z.Canvas=xt;var zt={sinh:function(t){return(Math.pow(Math.E,t)-Math.pow(Math.E,-t))/2},cosh:function(t){return(Math.pow(Math.E,t)+Math.pow(Math.E,-t))/2},tanh:function(t){return 2/(1+Math.exp(-2*t))-1},asinh:function(t){return Math.log(t+Math.sqrt(t*t+1))},acosh:function(t){return Math.log(t+Math.sqrt(t*t-1))},normalize0:function(t){return(t+3*Math.PI)%(2*Math.PI)-Math.PI},normalize:function(t){return(t+2*Math.PI)%(2*Math.PI)},cartesian:function(t){var e=t[0],a=dt-t[1],n=t[2];return{x:n*Math.sin(a)*Math.cos(e),y:n*Math.sin(a)*Math.sin(e),z:n*Math.cos(a)}},spherical:function(t){var e=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z),a=Math.atan(t.y/t.x),n=Math.acos(t.z/e);return[a/ut,n/ut,e]},distance:function(t,e){return Math.acos(Math.sin(t[1])*Math.sin(e[1])+Math.cos(t[1])*Math.cos(e[1])*Math.cos(t[0]-e[0]))}},Tt={"stars-show":["stars-limit","stars-colors","stars-style-fill","stars-designation","stars-propername","stars-size","stars-exponent"],"stars-designation":["stars-designationType","stars-designationLimit"],"stars-propername":["stars-propernameLimit","stars-propernameType"],"dsos-show":["dsos-limit","dsos-colors","dsos-style-fill","dsos-names","dsos-size","dsos-exponent"],"dsos-names":["dsos-namesType","dsos-nameLimit"],"mw-show":["mw-style-opacity","mw-style-fill"],"constellations-names":["constellations-namesType"],"planets-show":["planets-symbolType","planets-names"],"planets-names":["planets-namesType"]},St={sol:.0002959122082855911,mer:0x95955473dbc3,ven:0x89d9374048629,ter:0xa923c08a47948,lun:36599199229256,mar:319711652803400,cer:467549107200,ves:129071530155,jup:0xd20883d548bcd80,sat:0x3ee3798098fbac0,ura:0x99ad2c4e2f7f70,nep:0xb54f848fd74430,plu:7327611364884,eri:827117568e4},Pt={sol:"☉",mer:"☿",ven:"♀",ter:"⊕",lun:"●",mar:"♂",cer:"⚳",ves:"⚶",jup:"♃",sat:"♄",ura:"♅",nep:"♆",plu:"♇",eri:"⚪"},jt=23.43928*ut,It=Math.sin(jt),qt=Math.cos(jt),At=["a","e","i","w","M","L","W","N","n","ep","ref","lecl","becl","Tilt"],_t=function(){function t(e){return b(e),"sol"===u?(v.ephemeris.x=0,v.ephemeris.y=0,v.ephemeris.z=0,v.ephemeris.mag=-6,t):(w(),t)}function e(t,e){for(var a=e>1?t*t:-t*t,n=e*a*t/6,r=(1-e)*t-n,i=4;Math.abs(n)>1e-15;)n*=a/(i*(i+1)),r-=n,i+=2;return r}function a(){var t,a,n,r,i=v.ephemeris,s=i.e,o=i.M,l=1e-8,c=0,h=1.9,p=!1,d=0;if(!o)return 0;if(s<1&&((o<-Math.PI||o>Math.PI)&&(r=zt.normalize0(o),c=o-r,o=r),s<.9)){t=Math.atan2(Math.sin(o),Math.cos(o)-s);do{a=(t-s*Math.sin(t)-o)/(1-s*Math.cos(t)),t-=a}while(Math.abs(a)>l);return t}if(o<0&&(o=-o,p=!0),t=o,l*=Math.abs(1-s),l<1e-15&&(l=1e-15),(s>.8&&o<Math.PI/3||s>1)&&(n=o/Math.abs(1-s),n*n>6*Math.abs(1-s)&&(n=o<Math.PI?Math.pow(6*o,1/3):zt.asinh(o/s)),t=n),s>1&&o>4&&(t=Math.log(o)),s<1)for(;Math.abs(h)>l;)a=d++>8?e(t,s)-o:t-s*Math.sin(t)-o,h=-a/(1-s*Math.cos(t)),t+=h;else for(;Math.abs(h)>l;)a=d++>7?-e(t,s)-o:s*zt.sinh(t)-t-o,h=-a/(s*zt.cosh(t)-1),t+=h;return p?c-t:c+t}function n(){var t,e,n,r,i,s=v.ephemeris;1===s.e?(i=s.jd0-s.T,r=s.w0*i*.5,e=Math.pow(r+Math.sqrt(r*r+1),1/3),s.v=2*Math.atan(e-1/e)):(s.E=a(),s.e>1?(t=s.e-zt.cosh(s.E),e=zt.sinh(s.E)):(t=Math.cos(s.E)-s.e,e=Math.sin(s.E)),e*=Math.sqrt(Math.abs(1-s.e*s.e)),s.v=Math.atan2(e,t)),n=s.q*(1+s.e),s.r=n/(1+s.e*Math.cos(s.v))}function r(){var t=v.ephemeris;t.hasOwnProperty("w")||(t.w=t.W-t.N),t.hasOwnProperty("M")||(t.M=t.L-t.W),t.e<1&&(t.M=zt.normalize0(t.M)),t.P=pt*Math.sqrt(Math.pow(t.a,3)/g)/365.25,t.T=t.jd0-t.M/dt/t.P,1!==t.e?(t.q=t.a*(1-t.e),t.t0=t.a*Math.sqrt(Math.abs(t.a)/g)):(t.w0=3/Math.sqrt(2)/(t.q*Math.sqrt(t.q/g)),t.a=0,t.t0=0),t.am=Math.sqrt(g*t.q*(1+t.e))}function i(){var t=v.ephemeris;if(!t.ref||"ecl"===t.ref)return t.tx=t.x,t.ty=t.y,void(t.tz=t.z);var e=(t.lecl,Math.PI,t.becl,zt.cartesian([t.tl,t.tb,t.r]));t.tx=e.x,t.ty=e.y,t.tz=e.z}function s(t){var e=v.ephemeris,a=t.ephemeris;jt=(23.439292-.0130042*e.cy-1.667e-7*e.cy*e.cy+5.028e-7*e.cy*e.cy*e.cy)*ut,It=Math.sin(jt),qt=Math.cos(jt);var n="lun"===u?{x:0,y:0,z:0}:{x:a.x,y:a.y,z:a.z};e.xeq=e.x-n.x,e.yeq=(e.y-n.y)*qt-(e.z-n.z)*It,e.zeq=(e.y-n.y)*It+(e.z-n.z)*qt,e.ra=zt.normalize(Math.atan2(e.yeq,e.xeq)),e.dec=Math.atan2(e.zeq,Math.sqrt(e.xeq*e.xeq+e.yeq*e.yeq)),"lun"===u&&(e=d(e,a)),e.pos=[e.ra/ut,e.dec/ut],e.rt=Math.sqrt(e.xeq*e.xeq+e.yeq*e.yeq+e.zeq*e.zeq),"sol"!==u&&(e.mag=o())}function o(){var t=v.ephemeris,e=t.r,a=t.rt,n=Math.acos((e*e+a*a-1)/(2*e*a)),r=.666*((1-n/Math.PI)*Math.cos(n)+1/Math.PI*Math.sin(n));return 1*v.H+5*Math.log(e*a)*Math.LOG10E-2.5*Math.log(r)*Math.LOG10E}function l(){var t=v.ephemeris,e=t.v+t.w;return t.x=t.r*(Math.cos(t.N)*Math.cos(e)-Math.sin(t.N)*Math.sin(e)*Math.cos(t.i)),t.y=t.r*(Math.sin(t.N)*Math.cos(e)+Math.cos(t.N)*Math.sin(e)*Math.cos(t.i)),t.z=t.r*(Math.sin(e)*Math.sin(t.i)),v}function c(){var t=v.ephemeris,e=Math.atan2(t.y,t.x),a=Math.atan2(t.z,Math.sqrt(t.x*t.x+t.y*t.y));return t.l=zt.normalize(e),t.b=a,v}function h(t){var e=t.getUTCFullYear(),a=t.getUTCMonth()+1,n=t.getUTCDate(),r=(t.getUTCHours()-12+t.getUTCMinutes()/60+t.getUTCSeconds()/3600)/24;if(e<-4799)return-1;var i=Math.floor((14-a)/12),s=e+4800-i,o=a+12*i-3;return n+Math.floor((153*o+2)/5)+365*s+Math.floor(s/4)-Math.floor(s/100)+Math.floor(s/400)-32045+r}function p(t){if(void 0!==Lt)return Lt.elements(t)}function d(t,e){if(c(),void 0!==Lt)return Lt.corr(t,e)}var u,f,m,g=St.sol,y="sol",M={},v={},b=function(t){var e,a=v.ephemeris={};t&&(e=t instanceof Date?new Date(t.valueOf()):q(t)),e||(e=new Date),a.jd=h(e),e=q(M.ep),e||(e=q("2000-01-01")),a.jd0=h(e),a.d=a.jd-a.jd0,a.cy=a.d/36525},w=function(){var t,e=v.ephemeris;if("lun"===u){if(!(e=p(e)))return}else{for(var a=0;a<At.length;a++)t=At[a],k(M,t)&&(k(M,"d"+t)?e[t]=M[t]+M["d"+t]*e.cy:k(M,t)&&(e[t]=M[t]));k(e,"M")&&!k(e,"dM")&&k(e,"n")&&(e.M+=e.n*e.d)}r(),n(),l()};return t.cartesian=function(){return v},t.spherical=function(){return c(),v},t.equatorial=function(t){return s(t),v},t.transpose=function(){return i(),v},t.elements=function(e){var a;if(!arguments.length||void 0===arguments[0])return t;for(var n=0;n<At.length;n++)a=At[n],k(e,a)&&(M[a]=e[a],"a"===a||"e"===a?M[a]*=1:"ref"!==a&&"ep"!==a&&(M[a]*=ut),k(e,"d"+a)&&(a="d"+a,M[a]=e[a],M[a]*="da"===a||"de"===a?1:ut));return t},t.params=function(e){if(!arguments.length)return t;for(var a in e)k(e,a)&&"elements"!==e[a]&&(v[a]=e[a]);return t},t.parentBody=function(e){return arguments.length?(y=e,g=St[y],t):y},t.id=function(e){return arguments.length?(u=e,m=Pt[e],t):u},t.Name=function(e){return arguments.length?(f=e,t):f},t.symbol=function(e){return arguments.length?(m=Pt[e],t):m},t},Lt={elements:function(t){var e=(t.jd-2451545)/36525,a=e*e,n=e*a,r=e*n,i=1e-4*a,s=1e-6*n,o=1e-8*r,l=3400.4*Math.cos(ut*(235.7004+890534.223*e-32.601*i+3.664*s-1.769*o))-635.6*Math.cos(ut*(100.737+413335.3554*e-122.571*i-10.684*s+5.028*o))-235.6*Math.cos(ut*(134.9634+477198.8676*e+89.97*i+14.348*s-6.797*o))+218.1*Math.cos(ut*(238.1713+854535.1727*e-31.065*i+3.623*s-1.769*o))+181*Math.cos(ut*(10.6638+1367733.0907*e+57.37*i+18.011*s-8.566*o))-39.9*Math.cos(ut*(103.2079+377336.3051*e-121.035*i-10.724*s+5.028*o))-38.4*Math.cos(ut*(233.2295+926533.2733*e-34.136*i+3.705*s-1.769*o))+33.8*Math.cos(ut*(336.4374+1303869.5784*e-155.171*i-7.02*s+3.259*o))+28.8*Math.cos(ut*(111.4008+1781068.4461*e-65.201*i+7.328*s-3.538*o))+12.6*Math.cos(ut*(13.1347+1331734.0404*e+58.906*i+17.971*s-8.566*o))+11.4*Math.cos(ut*(186.5442+966404.0351*e-68.058*i-.567*s+.232*o))-11.1*Math.cos(ut*(222.5657-441199.8173*e-91.506*i-14.307*s+6.797*o))-10.2*Math.cos(ut*(269.9268+954397.7353*e+179.941*i+28.695*s-13.594*o))+9.7*Math.cos(ut*(145.6272+1844931.9583*e+147.34*i+32.359*s-15.363*o))+9.6*Math.cos(ut*(240.6422+818536.1225*e-29.529*i+3.582*s-1.769*o))+8*Math.cos(ut*(297.8502+445267.1115*e-16.3*i+1.832*s-.884*o))-6.2*Math.cos(ut*(132.4925+513197.9179*e+88.434*i+14.388*s-6.797*o))+6*Math.cos(ut*(173.5506+1335801.3346*e-48.901*i+5.496*s-2.653*o))+3.7*Math.cos(ut*(113.8717+1745069.3958*e-63.665*i+7.287*s-3.538*o))+3.6*Math.cos(ut*(338.9083+1267870.5281*e-153.636*i-7.061*s+3.259*o))+3.2*Math.cos(ut*(246.3642+2258267.3137*e+24.769*i+21.675*s-10.335*o))-3*Math.cos(ut*(8.1929+1403732.141*e+55.834*i+18.052*s-8.566*o))+2.3*Math.cos(ut*(98.2661+449334.4057*e-124.107*i-10.643*s+5.028*o))-2.2*Math.cos(ut*(357.5291+35999.0503*e-1.536*i+.041*s+0*o))-2*Math.cos(ut*(38.5872+858602.4669*e-138.871*i-8.852*s+4.144*o))-1.8*Math.cos(ut*(105.6788+341337.2548*e-119.499*i-10.765*s+5.028*o))-1.7*Math.cos(ut*(201.474+826670.7108*e-245.142*i-21.367*s+10.057*o))+1.6*Math.cos(ut*(184.1196+401329.0556*e+125.428*i+18.579*s-8.798*o))-1.4*Math.cos(ut*(308.4192-489205.1674*e+158.029*i+14.915*s-7.029*o))+1.3*Math.cos(ut*(325.7736-63863.5122*e-212.541*i-25.031*s+11.826*o)),c=-.55*Math.cos(ut*(238.2+854535.2*e))+.1*Math.cos(ut*(103.2+377336.3*e))+.1*Math.cos(ut*(233.2+926533.3*e)),h=383397.6+l+c*e,p=.014217*Math.cos(ut*(100.737+413335.3554*e-122.571*i-10.684*s+5.028*o))+.008551*Math.cos(ut*(325.7736-63863.5122*e-212.541*i-25.031*s+11.826*o))-.001383*Math.cos(ut*(134.9634+477198.8676*e+89.97*i+14.348*s-6.797*o))+.001353*Math.cos(ut*(10.6638+1367733.0907*e+57.37*i+18.011*s-8.566*o))-.001146*Math.cos(ut*(66.5106+349471.8432*e-335.112*i-35.715*s+16.854*o))-915e-6*Math.cos(ut*(201.474+826670.7108*e-245.142*i-21.367*s+10.057*o))+869e-6*Math.cos(ut*(103.2079+377336.3051*e-121.035*i-10.724*s+5.028*o))-628e-6*Math.cos(ut*(235.7004+890534.223*e-32.601*i+3.664*s-1.769*o))-393e-6*Math.cos(ut*(291.5472-127727.0245*e-425.082*i-50.062*s+23.651*o))+284e-6*Math.cos(ut*(328.2445-99862.5625*e-211.005*i-25.072*s+11.826*o))-278e-6*Math.cos(ut*(162.8868-31931.7561*e-106.271*i-12.516*s+5.913*o))-24e-5*Math.cos(ut*(269.9268+954397.7353*e+179.941*i+28.695*s-13.594*o))+23e-5*Math.cos(ut*(111.4008+1781068.4461*e-65.201*i+7.328*s-3.538*o))+229e-6*Math.cos(ut*(167.2476+762807.1986*e-457.683*i-46.398*s+21.882*o))-202e-6*Math.cos(ut*(83.3826-12006.2998*e+247.999*i+29.262*s-13.826*o))+19e-5*Math.cos(ut*(190.8102-541062.3799*e-302.511*i-39.379*s+18.623*o))+177e-6*Math.cos(ut*(357.5291+35999.0503*e-1.536*i+.041*s+0*o))+153e-6*Math.cos(ut*(32.2842+285608.3309*e-547.653*i-60.746*s+28.679*o))-137e-6*Math.cos(ut*(44.8902+1431596.6029*e+269.911*i+43.043*s-20.392*o))+122e-6*Math.cos(ut*(145.6272+1844931.9583*e+147.34*i+32.359*s-15.363*o))+116e-6*Math.cos(ut*(302.211+1240006.0662*e-367.713*i-32.051*s+15.085*o))-111e-6*Math.cos(ut*(203.9449+790671.6605*e-243.606*i-21.408*s+10.057*o))-108e-6*Math.cos(ut*(68.9815+313472.7929*e-333.576*i-35.756*s+16.854*o))+96e-6*Math.cos(ut*(336.4374+1303869.5784*e-155.171*i-7.02*s+3.259*o))-9e-5*Math.cos(ut*(98.2661+449334.4057*e-124.107*i-10.643*s+5.028*o))+9e-5*Math.cos(ut*(13.1347+1331734.0404*e+58.906*i+17.971*s-8.566*o))+56e-6*Math.cos(ut*(55.8468-1018261.2475*e-392.482*i-53.726*s+25.42*o))-56e-6*Math.cos(ut*(238.1713+854535.1727*e-31.065*i+3.623*s-1.769*o))+52e-6*Math.cos(ut*(308.4192-489205.1674*e+158.029*i+14.915*s-7.029*o))-5e-5*Math.cos(ut*(133.0212+698943.6863*e-670.224*i-71.429*s+33.708*o))-49e-6*Math.cos(ut*(267.9846+1176142.554*e-580.254*i-57.082*s+26.911*o))-49e-6*Math.cos(ut*(184.1196+401329.0556*e+125.428*i+18.579*s-8.798*o))-45e-6*Math.cos(ut*(49.1562-75869.812*e+35.458*i+4.231*s-2.001*o))+44e-6*Math.cos(ut*(257.3208-191590.5367*e-637.623*i-75.093*s+35.477*o))+42e-6*Math.cos(ut*(105.6788+341337.2548*e-119.499*i-10.765*s+5.028*o))+42e-6*Math.cos(ut*(160.4159+4067.2942*e-107.806*i-12.475*s+5.913*o))+4e-5*Math.cos(ut*(246.3642+2258267.3137*e+24.769*i+21.675*s-10.335*o))-4e-5*Math.cos(ut*(156.5838-604925.8921*e-515.053*i-64.41*s+30.448*o))+36e-6*Math.cos(ut*(169.7185+726808.1483*e-456.147*i-46.439*s+21.882*o))+29e-6*Math.cos(ut*(113.8717+1745069.3958*e-63.665*i+7.287*s-3.538*o))-29e-6*Math.cos(ut*(297.8502+445267.1115*e-16.3*i+1.832*s-.884*o))-28e-6*Math.cos(ut*(294.0181-163726.0747*e-423.546*i-50.103*s+23.651*o))+27e-6*Math.cos(ut*(263.6238+381403.5993*e-228.841*i-23.199*s+10.941*o))-26e-6*Math.cos(ut*(358.0578+221744.8187*e-760.194*i-85.777*s+40.505*o))-26e-6*Math.cos(ut*(8.1929+1403732.141*e+55.834*i+18.052*s-8.566*o)),d=-.0022*Math.cos(ut*(103.2+377336.3*e)),u=.055544+p+.001*e*d,f=.0011776*Math.cos(ut*(49.1562-75869.812*e+35.458*i+4.231*s-2.001*o))-971e-7*Math.cos(ut*(235.7004+890534.223*e-32.601*i+3.664*s-1.769*o))+908e-7*Math.cos(ut*(186.5442+966404.0351*e-68.058*i-.567*s+.232*o))+623e-7*Math.cos(ut*(83.3826-12006.2998*e+247.999*i+29.262*s-13.826*o))+483e-7*Math.cos(ut*(51.6271-111868.8623*e+36.994*i+4.19*s-2.001*o))+348e-7*Math.cos(ut*(100.737+413335.3554*e-122.571*i-10.684*s+5.028*o))-316e-7*Math.cos(ut*(308.4192-489205.1674*e+158.029*i+14.915*s-7.029*o))-253e-7*Math.cos(ut*(46.6853-39870.7617*e+33.922*i+4.272*s-2.001*o))-141e-7*Math.cos(ut*(274.1928-553068.6797*e-54.513*i-10.116*s+4.797*o))+127e-7*Math.cos(ut*(325.7736-63863.5122*e-212.541*i-25.031*s+11.826*o))+117e-7*Math.cos(ut*(184.1196+401329.0556*e+125.428*i+18.579*s-8.798*o))-78e-7*Math.cos(ut*(98.3124-151739.624*e+70.916*i+8.462*s-4.001*o))-63e-7*Math.cos(ut*(238.1713+854535.1727*e-31.065*i+3.623*s-1.769*o))+63e-7*Math.cos(ut*(134.9634+477198.8676*e+89.97*i+14.348*s-6.797*o))+36e-7*Math.cos(ut*(321.5076+1443602.9027*e+21.912*i+13.78*s-6.566*o))-35e-7*Math.cos(ut*(10.6638+1367733.0907*e+57.37*i+18.011*s-8.566*o))+24e-7*Math.cos(ut*(149.8932+337465.5434*e-87.113*i-6.453*s+3.028*o))+24e-7*Math.cos(ut*(170.9849-930404.9848*e+66.523*i+.608*s-.232*o)),m=-.0203*Math.cos(ut*(125-1934.1*e))+.0034*Math.cos(ut*(220.2-1935.5*e)),g=.0449858+f+.001*m,y=-15.448*Math.sin(ut*(100.737+413335.3554*e-122.571*i-10.684*s+5.028*o))-9.642*Math.sin(ut*(325.7736-63863.5122*e-212.541*i-25.031*s+11.826*o))-2.721*Math.sin(ut*(134.9634+477198.8676*e+89.97*i+14.348*s-6.797*o))+2.607*Math.sin(ut*(66.5106+349471.8432*e-335.112*i-35.715*s+16.854*o))+2.085*Math.sin(ut*(201.474+826670.7108*e-245.142*i-21.367*s+10.057*o))+1.477*Math.sin(ut*(10.6638+1367733.0907*e+57.37*i+18.011*s-8.566*o))+.968*Math.sin(ut*(291.5472-127727.0245*e-425.082*i-50.062*s+23.651*o))-.949*Math.sin(ut*(103.2079+377336.3051*e-121.035*i-10.724*s+5.028*o))-.703*Math.sin(ut*(167.2476+762807.1986*e-457.683*i-46.398*s+21.882*o))-.66*Math.sin(ut*(235.7004+890534.223*e-32.601*i+3.664*s-1.769*o))-.577*Math.sin(ut*(190.8102-541062.3799*e-302.511*i-39.379*s+18.623*o))-.524*Math.sin(ut*(269.9268+954397.7353*e+179.941*i+28.695*s-13.594*o))-.482*Math.sin(ut*(32.2842+285608.3309*e-547.653*i-60.746*s+28.679*o))+.452*Math.sin(ut*(357.5291+35999.0503*e-1.536*i+.041*s+0*o))-.381*Math.sin(ut*(302.211+1240006.0662*e-367.713*i-32.051*s+15.085*o))-.342*Math.sin(ut*(328.2445-99862.5625*e-211.005*i-25.072*s+11.826*o))-.312*Math.sin(ut*(44.8902+1431596.6029*e+269.911*i+43.043*s-20.392*o))+.282*Math.sin(ut*(162.8868-31931.7561*e-106.271*i-12.516*s+5.913*o))+.255*Math.sin(ut*(203.9449+790671.6605*e-243.606*i-21.408*s+10.057*o))+.252*Math.sin(ut*(68.9815+313472.7929*e-333.576*i-35.756*s+16.854*o))-.211*Math.sin(ut*(83.3826-12006.2998*e+247.999*i+29.262*s-13.826*o))+.193*Math.sin(ut*(267.9846+1176142.554*e-580.254*i-57.082*s+26.911*o))+.191*Math.sin(ut*(133.0212+698943.6863*e-670.224*i-71.429*s+33.708*o))-.184*Math.sin(ut*(55.8468-1018261.2475*e-392.482*i-53.726*s+25.42*o))+.182*Math.sin(ut*(145.6272+1844931.9583*e+147.34*i+32.359*s-15.363*o))-.158*Math.sin(ut*(257.3208-191590.5367*e-637.623*i-75.093*s+35.477*o))+.148*Math.sin(ut*(156.5838-604925.8921*e-515.053*i-64.41*s+30.448*o))-.111*Math.sin(ut*(169.7185+726808.1483*e-456.147*i-46.439*s+21.882*o))+.101*Math.sin(ut*(13.1347+1331734.0404*e+58.906*i+17.971*s-8.566*o))+.1*Math.sin(ut*(358.0578+221744.8187*e-760.194*i-85.777*s+40.505*o))+.087*Math.sin(ut*(98.2661+449334.4057*e-124.107*i-10.643*s+5.028*o))+.08*Math.sin(ut*(42.948+1653341.4216*e-490.283*i-42.734*s+20.113*o))+.08*Math.sin(ut*(222.5657-441199.8173*e-91.506*i-14.307*s+6.797*o))+.077*Math.sin(ut*(294.0181-163726.0747*e-423.546*i-50.103*s+23.651*o))-.073*Math.sin(ut*(280.8834-1495460.1151*e-482.452*i-68.074*s+32.217*o))-.071*Math.sin(ut*(304.6819+1204007.0159*e-366.177*i-32.092*s+15.085*o))-.069*Math.sin(ut*(233.7582+1112279.0417*e-792.795*i-82.113*s+38.736*o))-.067*Math.sin(ut*(34.7551+249609.2807*e-546.117*i-60.787*s+28.679*o))-.067*Math.sin(ut*(263.6238+381403.5993*e-228.841*i-23.199*s+10.941*o))+.055*Math.sin(ut*(21.6203-1082124.7597*e-605.023*i-78.757*s+37.246*o))+.055*Math.sin(ut*(308.4192-489205.1674*e+158.029*i+14.915*s-7.029*o))-.054*Math.sin(ut*(8.7216+1589477.9094*e-702.824*i-67.766*s+31.939*o))-.052*Math.sin(ut*(179.8536+1908795.4705*e+359.881*i+57.39*s-27.189*o))-.05*Math.sin(ut*(98.7948+635080.1741*e-882.765*i-96.461*s+45.533*o))-.049*Math.sin(ut*(128.6604-95795.2683*e-318.812*i-37.547*s+17.738*o))-.047*Math.sin(ut*(17.3544+425341.6552*e-370.57*i-39.946*s+18.854*o))-.044*Math.sin(ut*(160.4159+4067.2942*e-107.806*i-12.475*s+5.913*o))-.043*Math.sin(ut*(238.1713+854535.1727*e-31.065*i+3.623*s-1.769*o))+.042*Math.sin(ut*(270.4555+1140143.5037*e-578.718*i-57.123*s+26.911*o))-.042*Math.sin(ut*(132.4925+513197.9179*e+88.434*i+14.388*s-6.797*o))-.041*Math.sin(ut*(122.3573-668789.4043*e-727.594*i-89.441*s+42.274*o))-.04*Math.sin(ut*(105.6788+341337.2548*e-119.499*i-10.765*s+5.028*o))+.038*Math.sin(ut*(135.4921+662944.6361*e-668.688*i-71.47*s+33.708*o))-.037*Math.sin(ut*(242.391-51857.2124*e-460.54*i-54.293*s+25.652*o))+.036*Math.sin(ut*(336.4374+1303869.5784*e-155.171*i-7.02*s+3.259*o))+.035*Math.sin(ut*(223.0943-255454.0489*e-850.164*i-100.124*s+47.302*o))-.034*Math.sin(ut*(193.2811-577061.4302*e-300.976*i-39.419*s+18.623*o))+.031*Math.sin(ut*(87.6023-918398.685*e-181.476*i-28.654*s+13.594*o)),M=2.4*Math.sin(ut*(103.2+377336.3*e)),v=83.353+4069.0137*e-103.238*i-12.492*s+5.263*o+y+.001*e*M,b=-1.4979*Math.sin(ut*(49.1562-75869.812*e+35.458*i+4.231*s-2.001*o))-.15*Math.sin(ut*(357.5291+35999.0503*e-1.536*i+.041*s+0*o))-.1226*Math.sin(ut*(235.7004+890534.223*e-32.601*i+3.664*s-1.769*o))+.1176*Math.sin(ut*(186.5442+966404.0351*e-68.058*i-.567*s+.232*o))-.0801*Math.sin(ut*(83.3826-12006.2998*e+247.999*i+29.262*s-13.826*o))-.0616*Math.sin(ut*(51.6271-111868.8623*e+36.994*i+4.19*s-2.001*o))+.049*Math.sin(ut*(100.737+413335.3554*e-122.571*i-10.684*s+5.028*o))+.0409*Math.sin(ut*(308.4192-489205.1674*e+158.029*i+14.915*s-7.029*o))+.0327*Math.sin(ut*(134.9634+477198.8676*e+89.97*i+14.348*s-6.797*o))+.0324*Math.sin(ut*(46.6853-39870.7617*e+33.922*i+4.272*s-2.001*o))+.0196*Math.sin(ut*(98.3124-151739.624*e+70.916*i+8.462*s-4.001*o))+.018*Math.sin(ut*(274.1928-553068.6797*e-54.513*i-10.116*s+4.797*o))+.015*Math.sin(ut*(325.7736-63863.5122*e-212.541*i-25.031*s+11.826*o))-.015*Math.sin(ut*(184.1196+401329.0556*e+125.428*i+18.579*s-8.798*o))-.0078*Math.sin(ut*(238.1713+854535.1727*e-31.065*i+3.623*s-1.769*o))-.0045*Math.sin(ut*(10.6638+1367733.0907*e+57.37*i+18.011*s-8.566*o))+.0044*Math.sin(ut*(321.5076+1443602.9027*e+21.912*i+13.78*s-6.566*o))-.0042*Math.sin(ut*(162.8868-31931.7561*e-106.271*i-12.516*s+5.913*o))-.0031*Math.sin(ut*(170.9849-930404.9848*e+66.523*i+.608*s-.232*o))+.0031*Math.sin(ut*(103.2079+377336.3051*e-121.035*i-10.724*s+5.028*o))+.0029*Math.sin(ut*(222.612-1042273.8471*e+103.516*i+4.798*s-2.232*o))+.0028*Math.sin(ut*(184.0733+1002403.0853*e-69.594*i-.526*s+.232*o)),w=25.9*Math.sin(ut*(125-1934.1*e))-4.3*Math.sin(ut*(220.2-1935.5*e)),k=.38*Math.sin(ut*(357.5+35999.1*e)),x=125.0446-1934.13618*e+20.762*i+2.139*s-1.65*o+b+.001*(w+k*e),z=-.92581*Math.sin(ut*(235.7004+890534.223*e-32.601*i+3.664*s-1.769*o))+.33262*Math.sin(ut*(100.737+413335.3554*e-122.571*i-10.684*s+5.028*o))-.18402*Math.sin(ut*(357.5291+35999.0503*e-1.536*i+.041*s+0*o))+.11007*Math.sin(ut*(134.9634+477198.8676*e+89.97*i+14.348*s-6.797*o))-.06055*Math.sin(ut*(238.1713+854535.1727*e-31.065*i+3.623*s-1.769*o))+.04741*Math.sin(ut*(325.7736-63863.5122*e-212.541*i-25.031*s+11.826*o))-.03086*Math.sin(ut*(10.6638+1367733.0907*e+57.37*i+18.011*s-8.566*o))+.02184*Math.sin(ut*(103.2079+377336.3051*e-121.035*i-10.724*s+5.028*o))+.01645*Math.sin(ut*(49.1562-75869.812*e+35.458*i+4.231*s-2.001*o))+.01022*Math.sin(ut*(233.2295+926533.2733*e-34.136*i+3.705*s-1.769*o))-.00756*Math.sin(ut*(336.4374+1303869.5784*e-155.171*i-7.02*s+3.259*o))-.0053*Math.sin(ut*(222.5657-441199.8173*e-91.506*i-14.307*s+6.797*o))-.00496*Math.sin(ut*(162.8868-31931.7561*e-106.271*i-12.516*s+5.913*o))-.00472*Math.sin(ut*(297.8502+445267.1115*e-16.3*i+1.832*s-.884*o))-.00271*Math.sin(ut*(240.6422+818536.1225*e-29.529*i+3.582*s-1.769*o))+.00264*Math.sin(ut*(132.4925+513197.9179*e+88.434*i+14.388*s-6.797*o))-.00254*Math.sin(ut*(186.5442+966404.0351*e-68.058*i-.567*s+.232*o))+.00234*Math.sin(ut*(269.9268+954397.7353*e+179.941*i+28.695*s-13.594*o))-.0022*Math.sin(ut*(13.1347+1331734.0404*e+58.906*i+17.971*s-8.566*o))-.00202*Math.sin(ut*(355.0582+71998.1006*e-3.072*i+.082*s+0*o))+.00167*Math.sin(ut*(328.2445-99862.5625*e-211.005*i-25.072*s+11.826*o))-.00143*Math.sin(ut*(173.5506+1335801.3346*e-48.901*i+5.496*s-2.653*o))-.00121*Math.sin(ut*(98.2661+449334.4057*e-124.107*i-10.643*s+5.028*o))-.00116*Math.sin(ut*(145.6272+1844931.9583*e+147.34*i+32.359*s-15.363*o))+.00102*Math.sin(ut*(105.6788+341337.2548*e-119.499*i-10.765*s+5.028*o))-9e-4*Math.sin(ut*(184.1196+401329.0556*e+125.428*i+18.579*s-8.798*o))-86e-5*Math.sin(ut*(338.9083+1267870.5281*e-153.636*i-7.061*s+3.259*o))-78e-5*Math.sin(ut*(111.4008+1781068.4461*e-65.201*i+7.328*s-3.538*o))+69e-5*Math.sin(ut*(323.3027-27864.4619*e-214.077*i-24.99*s+11.826*o))+66e-5*Math.sin(ut*(51.6271-111868.8623*e+36.994*i+4.19*s-2.001*o))+65e-5*Math.sin(ut*(38.5872+858602.4669*e-138.871*i-8.852*s+4.144*o))-6e-4*Math.sin(ut*(83.3826-12006.2998*e+247.999*i+29.262*s-13.826*o))+54e-5*Math.sin(ut*(201.474+826670.7108*e-245.142*i-21.367*s+10.057*o))-52e-5*Math.sin(ut*(308.4192-489205.1674*e+158.029*i+14.915*s-7.029*o))+48e-5*Math.sin(ut*(8.1929+1403732.141*e+55.834*i+18.052*s-8.566*o))-41e-5*Math.sin(ut*(46.6853-39870.7617*e+33.922*i+4.272*s-2.001*o))-33e-5*Math.sin(ut*(274.1928-553068.6797*e-54.513*i-10.116*s+4.797*o))+3e-4*Math.sin(ut*(160.4159+4067.2942*e-107.806*i-12.475*s+5.913*o)),T=3.96*Math.sin(ut*(119.7+131.8*e))+1.96*Math.sin(ut*(125-1934.1*e)),S=.463*Math.sin(ut*(357.5+35999.1*e))+.152*Math.sin(ut*(238.2+854535.2*e))-.071*Math.sin(ut*(27.8+131.8*e))-.055*Math.sin(ut*(103.2+377336.3*e))-.026*Math.sin(ut*(233.2+926533.3*e)),P=14*Math.sin(ut*(357.5+35999.1*e))+5*Math.sin(ut*(238.2+854535.2*e)),j=218.31665+481267.88134*e-13.268*i+1.856*s-1.534*o+z+.001*(T+S*e+P*i);return t.a=h,t.e=u,t.i=2*Math.asin(g),t.w=zt.normalize(ut*(v-x)),t.N=zt.normalize(ut*x),t.M=zt.normalize(ut*(j-v)),t},corr:function(t,e){var a=zt.normalize(e.M+Math.PI),n=zt.normalize(e.w+Math.PI),r=t.M+t.w,i=r+t.N-a-n,s=-.022234*Math.sin(t.M-2*i)+.011494*Math.sin(2*i)+-.003246*Math.sin(a)+-.001029*Math.sin(2*t.M-2*i)+-994838e-9*Math.sin(t.M-2*i+a)+925025e-9*Math.sin(t.M+2*i)+802851e-9*Math.sin(2*i-a)+715585e-9*Math.sin(t.M-a)+-610865e-9*Math.sin(i)+-541052e-9*Math.sin(t.M+a)+-261799e-9*Math.sin(2*r-2*i)+191986e-9*Math.sin(t.M-4*i);t.ra+=s;var o=-.003019*Math.sin(r-2*i)+-959931e-9*Math.sin(t.M-r-2*i)+-802851e-9*Math.sin(t.M+r-2*i)+575958e-9*Math.sin(r+2*i)+296706e-9*Math.sin(2*t.M+r);return t.dec+=o,t.age=zt.normalize(t.l-e.l+Math.PI),t.phase=.5*(1-Math.cos(t.age)),t}},Ot=function(t,e){function a(){var t=M("mon").value,e=M("yr").value,a=new Date(e,t,1),n=d3.select("#cal"),r=new Date;e=parseInt(e),t=parseInt(t),a.setDate(a.getDate()-a.getDay());for(var i=n.node();i.firstChild;)i.removeChild(i.firstChild);for(var s=0;s<7;s++)n.append("div").classed({date:!0,weekday:!0}).html(f[s]);for(s=0;s<42;s++){var o=a.getMonth(),l=a.getDay(),c=m(a);n.append("div").classed({date:!0,grey:o!==t,weekend:o===t&&(0===l||6===l),today:0===I(a,r),selected:0===I(a,p)}).attr("id",c).on("click",h).html(a.getDate().toString()),a.setDate(a.getDate()+1)}}function n(){var t=d3.select("select#yr"),e=p.getFullYear(),a=0,n=i(p);t.selectAll("*").remove(),t.selectAll("option").data(n).enter().append("option").text(function(t,n){return t===e&&(a=n),t.toString()}),t.property("selectedIndex",a)}function r(t){y.append("div").attr("id",t).on("click",function(){var e=M("mon"),n=M("yr");"left"===t?0===e.selectedIndex?(e.selectedIndex=11,n.selectedIndex--):e.selectedIndex--:11===e.selectedIndex?(e.selectedIndex=0,n.selectedIndex++):e.selectedIndex++,a()})}function i(t){for(var e=s(t.getFullYear()),a=[],n=e[0];n<=e[1];n++)a.push(n);return a}function s(t){return!g||g.length<1?[t-10,t+10]:1===g.length&&x(g[0])?g[0]>=100?[g[0]-10,g[0]+10]:[t-g[0],t+g[0]]:2===g.length&&x(g[0])&&x(g[1])?g[1]>=100?[g[0],g[1]]:[g[0]-g[1],g[0]+g[1]]:[t-10,t+10]}function o(t,e){for(var a=M(t),n=0;n<a.childNodes.length;n++)if(a.childNodes[n].value==e){a.selectedIndex=n;break}}function l(t){t&&p.setTime(t.valueOf()),o("yr",p.getFullYear()),o("mon",p.getMonth()),a(),M("hr").value=p.getHours(),M("min").value=p.getMinutes(),M("sec").value=p.getSeconds()}function c(){d3.select("#celestial-date").style("opacity",0),d3.select("#error").style({top:"-9999px",left:"-9999px",opacity:0}),d3.select("#datepick").classed("active",!1),setTimeout(function(){M("celestial-date").style.top=v(-9999)},600)}function h(){var t=M("hr").value,a=M("min").value,r=M("sec").value,i=M("tz").value;this.id&&-1!==this.id.search(/^\d/)&&(p=m.parse(this.id)),n(),p.setHours(t,a,r),l(),e(p,i)}var p=new Date,d=(d3.time.format("%Z"),[{"−12:00":720},{"−11:00":660},{"−10:00":600},{"−09:30":570},{"−09:00":540},{"−08:00":480},{"−07:00":420},{"−06:00":360},{"−05:00":300},{"−04:30":270},{"−04:00":240},{"−03:30":210},{"−03:00":180},{"−02:00":120},{"−01:00":60},{"±00:00":0},{"+01:00":-60},{"+02:00":-120},{"+03:00":-180},{"+03:30":-210},{"+04:00":-240},{"+04:30":-270},{"+05:00":-300},{"+05:30":-330},{"+05:45":-345},{"+06:00":-360},{"+06:30":-390},{"+07:00":-420},{"+08:00":-480},{"+08:30":-510},{"+08:45":-525},{"+09:00":-540},{"+09:30":-570},{"+10:00":-600},{
"+10:30":-630},{"+11:00":-660},{"+12:00":-720},{"+12:45":-765},{"+13:00":-780},{"+14:00":-840}]),u=["January","February","March","April","May","June","July","August","September","October","November","December"],f=["Su","M","Tu","W","Th","F","Sa"],m=(i(p),d3.time.format("%Y-%m-%d")),g=t.daterange||[],y=d3.select("#celestial-form").append("div").attr("id","celestial-date");r("left"),function(){var t=y.append("select").attr("title","Month").attr("id","mon").on("change",a),e=0,n=p.getMonth();t.selectAll("option").data(u).enter().append("option").attr("value",function(t,a){return a===n&&(e=a),a}).text(function(t){return t}),t.property("selectedIndex",e)}(),function(){y.append("select").attr("title","Year").attr("id","yr").on("change",a),n()}(),r("right");y.append("div").attr("id","cal");a(),function(){y.append("input").attr("type","number").attr("id","hr").attr("title","Hours").attr("max","24").attr("min","-1").attr("step","1").attr("value",p.getHours()).on("change",function(){!0===F(this)&&h()}),y.append("input").attr("type","number").attr("id","min").attr("title","Minutes").attr("max","60").attr("min","-1").attr("step","1").attr("value",p.getMinutes()).on("change",function(){!0===F(this)&&h()}),y.append("input").attr("type","number").attr("id","sec").attr("title","Seconds").attr("max","60").attr("min","-1").attr("step","1").attr("value",p.getSeconds()).on("change",function(){!0===F(this)&&h()})}(),function(){var t=y.append("select").attr("title","Time zone offset from UTC").attr("id","tz").on("change",h),e=15,a=p.getTimezoneOffset();t.selectAll("option").data(d).enter().append("option").attr("value",function(t,n){var r=Object.keys(t)[0];return t[r]===a&&(e=n),t[r]}).text(function(t){return Object.keys(t)[0]}),t.property("selectedIndex",e)}(),this.show=function(t){var e=M("celestial-date"),a=M("datepick"),n=a.offsetLeft+a.offsetWidth-e.offsetWidth,r=a.offsetTop-e.offsetHeight-1;-9999===e.offsetTop?(p.setTime(t.valueOf()),l(),d3.select("#celestial-date").style({top:v(r),left:v(n),opacity:1}),d3.select("#datepick").classed("active",!0)):c()},this.isVisible=function(){return!!document.getElementById("datepick")&&!0===d3.select("#datepick").classed("active")},this.hide=function(){c()}};!function(){function t(t,e,a){var n=t.translate(),r=Math.atan2(e[1]-n[1],e[0]-n[0])-Math.atan2(a[1]-n[1],a[0]-n[0]);return[Math.cos(r/2),0,0,Math.sin(r/2)]}function e(t,e){var a=t.invert(e);return a&&isFinite(a[0])&&isFinite(a[1])&&o(a)}function a(t){var e=.5*t[0]*p,a=.5*t[1]*p,n=.5*t[2]*p,r=Math.sin(e),i=Math.cos(e),s=Math.sin(a),o=Math.cos(a),l=Math.sin(n),c=Math.cos(n);return[i*o*c+r*s*l,r*o*c-i*s*l,i*s*c+r*o*l,i*o*l-r*s*c]}function n(t,e){var a=t[0],n=t[1],r=t[2],i=t[3],s=e[0],o=e[1],l=e[2],c=e[3];return[a*s-n*o-r*l-i*c,a*o+n*s+r*c-i*l,a*l-n*c+r*s+i*o,a*c+n*l-r*o+i*s]}function r(t,e){if(t&&e){var a=c(t,e),n=Math.sqrt(l(a,a)),r=.5*Math.acos(Math.max(-1,Math.min(1,l(t,e)))),i=Math.sin(r)/n;return n&&[Math.cos(r),a[2]*i,-a[1]*i,a[0]*i]}}function i(t,e){var a=Math.max(-1,Math.min(1,l(t,e))),n=a<0?-1:1,r=Math.acos(n*a),i=Math.sin(r);return i?function(a){var s=n*Math.sin((1-a)*r)/i,o=Math.sin(a*r)/i;return[t[0]*s+e[0]*o,t[1]*s+e[1]*o,t[2]*s+e[2]*o,t[3]*s+e[3]*o]}:function(){return t}}function s(t){return[Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),1-2*(t[1]*t[1]+t[2]*t[2]))*d,Math.asin(Math.max(-1,Math.min(1,2*(t[0]*t[2]-t[3]*t[1]))))*d,Math.atan2(2*(t[0]*t[3]+t[1]*t[2]),1-2*(t[2]*t[2]+t[3]*t[3]))*d]}function o(t){var e=t[0]*p,a=t[1]*p,n=Math.cos(a);return[n*Math.cos(e),n*Math.sin(e),Math.sin(a)]}function l(t,e){for(var a=0,n=t.length,r=0;a<n;++a)r+=t[a]*e[a];return r}function c(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function h(t){for(var e=0,a=arguments.length,n=[];++e<a;)n.push(arguments[e]);var r=d3.dispatch.apply(null,n);return r.of=function(e,a){return function(n){try{var i=n.sourceEvent=d3.event;n.target=t,d3.event=n,r[n.type].apply(e,a)}finally{d3.event=i}}},r}var p=Math.PI/180,d=180/Math.PI;d3.geo.zoom=function(){function l(t){m++||t({type:"zoomstart"})}function c(t){t({type:"zoom"})}function p(t){--m||t({type:"zoomend"})}var d,u,f,m=0,g=h(y,"zoomstart","zoom","zoomend"),y=d3.behavior.zoom().on("zoomstart",function(){var i=d3.mouse(this),o=a(d.rotate()),h=e(d,i);h&&(f=h),M.call(y,"zoom",function(){d.scale(v.k=d3.event.scale);var a=d3.mouse(this),l=r(f,e(d,a));d.rotate(v.r=s(o=l?n(o,l):n(t(d,i,a),o))),i=a,c(g.of(this,arguments))}),l(g.of(this,arguments))}).on("zoomend",function(){M.call(y,"zoom",null),p(g.of(this,arguments))}),M=y.on,v={r:[0,0,0],k:1};return y.rotateTo=function(t){var e=r(o(t),o([-v.r[0],-v.r[1]]));return s(n(a(v.r),e))},y.projection=function(t){return arguments.length?(d=t,v={r:d.rotate(),k:d.scale()},y.scale(v.k)):d},y.duration=function(t){return arguments.length?(u=t,y):u},y.event=function(t){t.each(function(){var t=d3.select(this),e=g.of(this,arguments),n=v,r=d3.transition(t);if(r!==t){r.each("start.zoom",function(){this.__chart__&&(v=this.__chart__,v.hasOwnProperty("r")||(v.r=d.rotate())),d.rotate(v.r).scale(v.k),l(e)}).tween("zoom:zoom",function(){var t=y.size()[0],o=i(a(v.r),a(n.r)),l=d3.geo.distance(v.r,n.r),h=d3.interpolateZoom([0,0,t/v.k],[l,0,t/n.k]);return u&&r.duration(u(.001*h.duration)),function(a){var n=h(a);this.__chart__=v={r:s(o(n[0]/l)),k:t/n[2]},d.rotate(v.r).scale(v.k),y.scale(v.k),c(e)}}).each("end.zoom",function(){p(e)});try{r.each("interrupt.zoom",function(){p(e)})}catch(t){console.log(t)}}else this.__chart__=v,l(e),c(e),p(e)})},d3.rebind(y,g,"on")}}(),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.d3=t.d3||{})}(this,function(t){"use strict";function e(t){this._size=t,this._call=this._error=null,this._tasks=[],this._data=[],this._waiting=this._active=this._ended=this._start=0}function a(t){if(!t._start)try{n(t)}catch(e){if(t._tasks[t._ended+t._active-1])i(t,e);else if(!t._data)throw e}}function n(t){for(;t._start=t._waiting&&t._active<t._size;){var e=t._ended+t._active,a=t._tasks[e],n=a.length-1,i=a[n];a[n]=r(t,e),--t._waiting,++t._active,a=i.apply(null,a),t._tasks[e]&&(t._tasks[e]=a||c)}}function r(t,e){return function(n,r){t._tasks[e]&&(--t._active,++t._ended,t._tasks[e]=null,null==t._error&&(null!=n?i(t,n):(t._data[e]=r,t._waiting?a(t):s(t))))}}function i(t,e){var a,n=t._tasks.length;for(t._error=e,t._data=void 0,t._waiting=NaN;--n>=0;)if((a=t._tasks[n])&&(t._tasks[n]=null,a.abort))try{a.abort()}catch(e){}t._active=NaN,s(t)}function s(t){if(!t._active&&t._call){var e=t._data;t._data=void 0,t._call(t._error,e)}}function o(t){if(null==t)t=1/0;else if(!((t=+t)>=1))throw new Error("invalid concurrency");return new e(t)}var l=[].slice,c={};e.prototype=o.prototype={constructor:e,defer:function(t){if("function"!=typeof t)throw new Error("invalid callback");if(this._call)throw new Error("defer after await");if(null!=this._error)return this;var e=l.call(arguments,1);return e.push(t),++this._waiting,this._tasks.push(e),a(this),this},abort:function(){return null==this._error&&i(this,new Error("abort")),this},await:function(t){if("function"!=typeof t)throw new Error("invalid callback");if(this._call)throw new Error("multiple await");return this._call=function(e,a){t.apply(null,[e].concat(a))},s(this),this},awaitAll:function(t){if("function"!=typeof t)throw new Error("invalid callback");if(this._call)throw new Error("multiple await");return this._call=t,s(this),this}},t.queue=o,Object.defineProperty(t,"__esModule",{value:!0})}),this.Celestial=Z}();