// Copyright 2015-2019 Olaf Frohn https://github.com/ofrohn, see LICENSE
!function(){function t(t,e){function a(a,r){var o=t([a*=180/Math.PI,r*=180/Math.PI]),i=e([a,r]);return[(1-n)*o[0]+n*i[0],(n-1)*o[1]-n*i[1]]}var n,r=d3.geo.projection(a).scale(1),o=r.center,i=r.translate;return r.alpha=function(a){if(!arguments.length)return n;n=+a;var s=t.center(),l=e.center(),c=t.translate(),h=e.translate();return o([(1-n)*s[0]+n*l[0],(1-n)*s[1]+n*l[1]]),i([(1-n)*c[0]+n*h[0],(1-n)*c[1]+n*h[1]]),r},delete r.translate,delete r.center,r.alpha(0)}function e(t,e){return a(t.map(function(t){return t*it}),e).map(function(t){return t/it})}function a(t,e){var a,n,r,o,i,s,l,c,h,d;return e?(s=t[0],s<0&&(s+=rt),l=t[1],s-=e[0],o=e[1],i=e[2],a=Math.sin(l)*Math.sin(o)-Math.cos(l)*Math.cos(o)*Math.cos(s),Math.abs(a)<1e-5&&(a=-Math.cos(l+o)+Math.cos(l)*Math.cos(o)*(1-Math.cos(s))),n=-Math.cos(l)*Math.sin(s),c=0!==a||0!==n?Math.atan2(n,a):s-Math.PI,h=i+c,h>Math.PI&&(h-=rt),s%Math.PI==0?(d=l+Math.cos(s)*o,d>ot&&(d=Math.PI-d),d<-ot&&(d=-Math.PI-d)):(r=Math.sin(l)*Math.cos(o)+Math.cos(l)*Math.sin(o)*Math.cos(s),Math.abs(r)>.99?(d=Math.abs(Math.acos(Math.sqrt(a*a+n*n))),r<0&&(d*=-1)):d=Math.asin(r)),[h,d]):t}function n(t,e){var a=t.getUTCFullYear(),n=t.getUTCMonth()+1,r=t.getUTCDate(),o=t.getUTCHours(),i=t.getUTCMinutes(),s=t.getUTCSeconds();1!=n&&2!=n||(a-=1,n+=12);var l=Math.floor(a/100),c=2-l+Math.floor(l/4),h=Math.floor(365.25*a),d=Math.floor(30.6001*(n+1)),u=c+h+d-730550.5+r+(o+i/60+s/3600)/24,p=u/36525,f=280.46061837+360.98564736629*u+387933e-9*p*p-p*p*p/3871e4+e;if(f>0)for(;f>360;)f-=360;else for(;f<0;)f+=360;return f}function r(t,a){return e(t,st[a])}function o(t,e){if("equatorial"===e)return t;for(var a=st[e],n=t.features,r=0;r<n.length;r++)n[r].geometry.coordinates=h(n[r],a);return t}function i(t){var e=[];for(var a in t)if(b(t,a)&&-1!==U.planets.which.indexOf(a)){var n=kt().id(a);b(t[a],"parent")&&n.parentBody(t[a].parent),n.elements(t[a].elements[0]),"ter"===a?R.origin=n:e.push(n)}return e.push(kt().id("sol")),e.push(kt().id("lun")),e}function s(t,e){if(e=e||R.date(),R.origin){var a,n=R.origin(e).spherical();return R.container.selectAll(".planet").each(function(r){t===r.id()&&(a=r(e).equatorial(n))}),a}}function l(t,e){for(var a={},n=(st[e],t.features),r=0;r<n.length;r++)a[n[r].id]={name:n[r].properties.name,center:n[r].properties.display.slice(0,2),scale:n[r].properties.display[2]};return a}function c(t){var e={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"MultiPolygon",coordinates:[]}}]},a=t.features[0].geometry.coordinates[0];e.features[0].geometry.coordinates[0]=[];for(var n=0;n<a.length;n++)e.features[0].geometry.coordinates[0][n]=a[n].slice().reverse();return e}function h(t,a){var n=[];switch(t.geometry.type){case"Point":n=e(t.geometry.coordinates,a);break;case"LineString":n.push(f(t.geometry.coordinates,a));break;case"MultiLineString":n=m(t.geometry.coordinates,a);break;case"Polygon":n.push(f(t.geometry.coordinates[0],a));break;case"MultiPolygon":n.push(m(t.geometry.coordinates[0],a))}return n}function d(t,e){var a=[];if(!e)return[];k(e)||(e=[e]);for(var n=0;n<e.length;n++)switch(e[n]){case"center":a="lat"===t?a.concat(p(t,U.center[0],"N")):a.concat(p(t,U.center[1],"S"));break;case"outline":"lon"===t?(a=a.concat(p(t,U.center[1]-89.99,"S")),a=a.concat(p(t,U.center[1]+89.99),"N")):(a=a.concat(p(t,U.center[0]-179.99,"E")),a=a.concat(p(t,U.center[0]+179.99,"W")));break;default:if(w(e[n])){a="lat"===t?a.concat(p(t,e[n],"N")):a.concat(p(t,e[n],"S"));break}}return u(a)}function u(t){for(var e=[],a=0;a<t.length;a++){var n={type:"Feature",id:a,properties:{},geometry:{type:"Point"}};n.properties.value=t[a].value,n.properties.orientation=t[a].orientation,n.geometry.coordinates=t[a].coordinates,e.push(n)}return e}function p(t,e,a){var n,r,o,i,s,l=t,c=[],h=e;"equatorial"===U.transform&&"lon"===l&&(l="ra"),"ra"===l?(n=0,r=23,o=1):"lon"===l?(n=0,r=350,o=10):(n=-80,r=80,o=10);for(var d=n;d<=r;d+=o){var u=a;"lat"===l?(s=[h,d],i=d.toString()+"°",u+=d<0?"S":"N"):"ra"===l?(s=[15*d,h],i=d.toString()+"ʰ"):(s=[d,h],i=d.toString()+"°"),c.push({coordinates:s,value:i,orientation:u})}return c}function f(t,a){for(var n=[],r=0;r<t.length;r++)n.push(e(t[r],a));return n}function m(t,e){for(var a=[],n=0;n<t.length;n++)a.push(f(t[n],e));return a}function g(t){return document.getElementById(t)}function M(t){return t+"px"}function y(t,e){return Math.round(Math.pow(10,e)*t)/Math.pow(10,e)}function v(t){return t<10?"0"+t:t}function b(t,e){return null!==t&&hasOwnProperty.call(t,e)}function w(t){return!isNaN(parseFloat(t))&&isFinite(t)}function k(t){return"[object Array]"===Object.prototype.toString.call(t)}function x(t){return t instanceof Date&&!isNaN(t)}function z(t){var e=0,a=0;if(t.offsetParent)do{e+=t.offsetLeft,a+=t.offsetTop}while(null!==(t=t.offsetParent));return[e,a]}function P(t,e){for(;t.parentNode;){if(t.id===e)return!0;t=t.parentNode}return!1}function I(t,e,a){var n=e.valueOf()-t.valueOf();switch(a||"d"){case"y":case"yr":n/=31556926080;break;case"m":case"mo":n/=26298e5;break;case"d":case"dy":n/=864e5;break;case"h":case"hr":n/=36e5;break;case"n":case"mn":n/=6e4;break;case"s":case"sec":n/=1e3}return Math.floor(n)}function q(t){if(t){var e=t.split(".");if(!(e.length<1)&&(e=e[0].split("-"),e[0]=e[0].replace(/\D/g,""),e[0]))return e[1]=e[1]?e[1].replace(/\D/g,""):"1",e[2]=e[2]?e[2].replace(/\D/g,""):"1",new Date(Date.UTC(e[0],e[1]-1,e[2]))}}function S(t,e,a){return t=(t*it+rt)%rt,e=(e*it+rt)%rt,Math.abs(t-e)>Math.PI&&(t>e?t-=rt:e>t&&(e-=rt)),d3.interpolateNumber(t/it,e/it)}function T(t){function e(){var t=this,e=t.value;!1!==C(t)&&(c.width=e,R.resize({width:e}))}function a(){var t=this,e=t.value,a=E(e,c.transform);null!==a&&(c.center[0]=a),c.transform=e,R.reload(c)}function n(){var t=this;t&&(c.projection=t.value,R.reproject(c))}function r(){!1!==C(this)&&!1!==o()&&R.rotate(c)}function o(){var t=g("centerx"),e=g("centery"),a=g("centerz");if(t&&e){if("equatorial"!==c.transform)c.center[0]=parseFloat(t.value);else{var n=parseFloat(t.value);c.center[0]=n>12?15*n-360:15*n}c.center[1]=parseFloat(e.value);var r=parseFloat(a.value);return c.center[2]=isNaN(r)?0:r,""!==t.value&&""!==e.value}}function i(){var t=this.value,e=[];if(""===t)return R.constellation=null,void R.redraw();var a=R.constellations[t];c.center=a.center,O(c.center,c.transform);var n=R.zoomBy();1!==n&&e.push({param:"zoom",value:1/n,duration:0}),e.push({param:"center",value:a.center,duration:0});var r=a.scale>10?10:a.scale;e.push({param:"zoom",value:r,duration:0}),R.constellation=t,R.animate(e,!1)}function s(){var t,e=this;switch(e.type){case"checkbox":t=e.checked,j(e);break;case"number":if(!1===C(e))return;t=parseFloat(e.value);break;case"color":if(!1===F(e))return;t=e.value;break;case"text":if(-1===e.id.search(/fill$/))return;if(!1===F(e))return;t=e.value}null!==t&&(l(e.id,t),"dsos-style-fill"===e.id&&(l("dsos-style-stroke",t),l("dsos-namestyle-fill",t)),o(),R.apply(c))}function l(t,e){var a=t.split("-");switch(a.length){case 1:c[a[0]]=e;break;case 2:c[a[0]][a[1]]=e;break;case 3:c[a[0]][a[1]][a[2]]=e;break;default:return}}var c=ht.set(t),h=R.projections(),d=R.eulerAngles(),u=d3.select("#celestial-form");if(u.size()<1){var p=c.container||"celestial-map";u=d3.select("#"+p).select(function(){return this.parentNode}).append("div").attr("id","celestial-form")}var f=u.append("div").attr("class","ctrl"),m=f.append("form").attr("id","params").attr("name","params").attr("method","get").attr("action","#"),M=m.append("div").attr("class","col").attr("id","general");M.append("label").attr("title","Map width in pixel, 0 indicates full width").attr("for","width").html("Width "),M.append("input").attr("type","number").attr("maxlength","4").attr("max","20000").attr("min","0").attr("title","Map width").attr("id","width").attr("value",c.width).on("change",e),M.append("span").html("px"),M.append("label").attr("title","Map projection, (hemi) indicates hemispherical projection").attr("for","projection").html("Projection");var y=M.append("select").attr("id","projection").on("change",n),v=0,b=Object.keys(h).map(function(t,e){var a=h[t].clip&&!0===h[t].clip?h[t].n+" (hemi)":h[t].n;return t===c.projection&&(v=e),{o:t,n:a}});y.selectAll("option").data(b).enter().append("option").attr("value",function(t){return t.o}).text(function(t){return t.n}),y.property("selectedIndex",v),v=0,M.append("label").attr("title","Coordinate space in which the map is displayed").attr("for","transform").html("Coordinates"),y=M.append("select").attr("id","transform").on("change",a),b=Object.keys(d).map(function(t,e){return t===c.transform&&(v=e),{o:t,n:t.replace(/^([a-z])/,function(t,e){return e.toUpperCase()})}}),y.selectAll("option").data(b).enter().append("option").attr("value",function(t){return t.o}).text(function(t){return t.n}),y.property("selectedIndex",v),M.append("br"),M.append("label").attr("title","Center coordinates long/lat in selected coordinate space").attr("for","centerx").html("Center"),M.append("input").attr("type","number").attr("id","centerx").attr("title","Center right ascension/longitude").attr("max","24").attr("min","0").attr("step","0.1").on("change",r),M.append("span").attr("id","cxunit").html("h"),M.append("input").attr("type","number").attr("id","centery").attr("title","Center declination/latitude").attr("max","90").attr("min","-90").attr("step","0.1").on("change",r),M.append("span").html("°"),M.append("label").attr("title","Orientation").attr("for","centerz").html("Orientation"),M.append("input").attr("type","number").attr("id","centerz").attr("title","Center orientation").attr("max","180").attr("min","-180").attr("step","0.1").on("change",r),M.append("span").html("°"),M.append("label").attr("for","orientationfixed").html("Fixed"),M.append("input").attr("type","checkbox").attr("id","orientationfixed").property("checked",c.orientationfixed).on("change",s),M.append("label").attr("title","Center and zoom in on this constellation").attr("for","constellation").html("Show"),M.append("select").attr("id","constellation").on("change",i),O(c.center,c.transform),M=m.append("div").attr("class","col").attr("id","stars"),M.append("label").attr("class","header").attr("for","stars-show").html("Stars"),M.append("input").attr("type","checkbox").attr("id","stars-show").property("checked",c.stars.show).on("change",s),M.append("label").attr("for","stars-limit").html("down to magnitude"),M.append("input").attr("type","number").attr("id","stars-limit").attr("title","Star display limit (magnitude)").attr("value",c.stars.limit).attr("max","6").attr("min","-1").attr("step","0.1").on("change",s),M.append("label").attr("for","stars-colors").html("with spectral colors"),M.append("input").attr("type","checkbox").attr("id","stars-colors").property("checked",c.stars.colors).on("change",s),M.append("label").attr("for","stars-color").html("or default color "),M.append("input").attr("type","color").attr("autocomplete","off").attr("id","stars-style-fill").attr("title","Star color").property("value",c.stars.style.fill).on("change",s),M.append("br"),M.append("label").attr("for","stars-names").html("Show designations"),M.append("input").attr("type","checkbox").attr("id","stars-names").property("checked",c.stars.names).on("change",s),M.append("label").attr("for","stars-namelimit").html("down to mag"),M.append("input").attr("type","number").attr("id","stars-namelimit").attr("title","Star designaton display limit (magnitude)").attr("value",c.stars.namelimit).attr("max","6").attr("min","-1").attr("step","0.1").on("change",s),M.append("label").attr("for","stars-desig").attr("title","include HD/HIP designations").html("all"),M.append("input").attr("type","checkbox").attr("id","stars-desig").property("checked",c.stars.desig).on("change",s),M.append("label").attr("for","stars-proper").html("proper names"),M.append("input").attr("type","checkbox").attr("id","stars-proper").property("checked",c.stars.proper).on("change",s),M.append("label").attr("for","stars-propernamelimit").html("down to mag"),M.append("input").attr("type","number").attr("id","stars-propernamelimit").attr("title","Star name display limit (magnitude)").attr("value",c.stars.propernamelimit).attr("max","6").attr("min","-1").attr("step","0.1").on("change",s),M.append("br"),M.append("label").attr("for","stars-size").html("Stellar disk size: base"),M.append("input").attr("type","number").attr("id","stars-size").attr("title","Size of the displayed star disk; base").attr("value",c.stars.size).attr("max","100").attr("min","0").attr("step","0.1").on("change",s),M.append("label").attr("for","stars-exponent").html(" * e ^ (exponent"),M.append("input").attr("type","number").attr("id","stars-exponent").attr("title","Size of the displayed star disk; exponent").attr("value",c.stars.exponent).attr("max","3").attr("min","-1").attr("step","0.01").on("change",s),M.append("span").text(" * (magnitude + 2))  [* adaptation]"),j(g("stars-show")),M=m.append("div").attr("class","col").attr("id","dsos"),M.append("label").attr("class","header").attr("title","Deep Space Objects").attr("for","dsos-show").html("DSOs"),M.append("input").attr("type","checkbox").attr("id","dsos-show").property("checked",c.dsos.show).on("change",s),M.append("label").attr("for","dsos-limit").html("down to mag"),M.append("input").attr("type","number").attr("id","dsos-limit").attr("title","DSO display limit (magnitude)").attr("value",c.dsos.limit).attr("max","6").attr("min","0").attr("step","0.1").on("change",s),M.append("label").attr("for","dsos-colors").html("with symbol colors"),M.append("input").attr("type","checkbox").attr("id","dsos-colors").property("checked",c.dsos.colors).on("change",s),M.append("label").attr("for","dsos-color").html("or default color "),M.append("input").attr("type","color").attr("autocomplete","off").attr("id","dsos-style-fill").attr("title","DSO color").property("value",c.dsos.style.fill).on("change",s),M.append("br"),M.append("label").attr("for","dsos-names").html("Show names"),M.append("input").attr("type","checkbox").attr("id","dsos-names").property("checked",c.dsos.names).on("change",s),M.append("label").attr("for","dsos-desig").html("or designations"),M.append("input").attr("type","checkbox").attr("id","dsos-desig").property("checked",c.dsos.desig).on("change",s),M.append("label").attr("for","dsos-namelimit").html("down to mag"),M.append("input").attr("type","number").attr("id","dsos-namelimit").attr("title","DSO name display limit (magnitude)").attr("value",c.dsos.namelimit).attr("max","6").attr("min","0").attr("step","0.1").on("change",s),M.append("br"),M.append("label").attr("for","dsos-size").html("DSO symbol size: (base"),M.append("input").attr("type","number").attr("id","dsos-size").attr("title","Size of the displayed symbol: base").attr("value",c.dsos.size).attr("max","100").attr("min","0").attr("step","0.1").on("change",s),M.append("label").attr("for","dsos-exponent").html(" * 2 [* adaptation] - magnitude) ^ exponent"),M.append("input").attr("type","number").attr("id","dsos-exponent").attr("title","Size of the displayed symbol; exponent").attr("value",c.dsos.exponent).attr("max","3").attr("min","-1").attr("step","0.01").on("change",s),j(g("dsos-show")),M=m.append("div").attr("class","col").attr("id","constellations"),M.append("label").attr("class","header").html("Constellations"),M.append("label").attr("for","constellations-names").html("Show names"),M.append("input").attr("type","checkbox").attr("id","constellations-names").property("checked",c.constellations.names).on("change",s),M.append("label").attr("for","constellations-desig").html("abbreviated"),M.append("input").attr("type","checkbox").attr("id","constellations-desig").property("checked",c.constellations.desig).on("change",s),M.append("label").attr("for","constellations-lines").html("with lines"),M.append("input").attr("type","checkbox").attr("id","constellations-lines").property("checked",c.constellations.lines).on("change",s),M.append("label").attr("for","constellations-bounds").html("with boundaries"),M.append("input").attr("type","checkbox").attr("id","constellations-bounds").property("checked",c.constellations.bounds).on("change",s),j(g("constellations-names")),M=m.append("div").attr("class","col").attr("id","lines"),M.append("label").attr("class","header").html("Lines"),M.append("label").attr("title","Laitudet/longitude grid lines").attr("for","lines-graticule").html("Graticule"),M.append("input").attr("type","checkbox").attr("id","lines-graticule-show").property("checked",c.lines.graticule.show).on("change",s),M.append("label").attr("for","lines-equatorial").html("Equator"),M.append("input").attr("type","checkbox").attr("id","lines-equatorial-show").property("checked",c.lines.equatorial.show).on("change",s),M.append("label").attr("for","lines-ecliptic").html("Ecliptic"),M.append("input").attr("type","checkbox").attr("id","lines-ecliptic-show").property("checked",c.lines.ecliptic.show).on("change",s),M.append("label").attr("for","lines-galactic").html("Galactic plane"),M.append("input").attr("type","checkbox").attr("id","lines-galactic-show").property("checked",c.lines.galactic.show).on("change",s),M.append("label").attr("for","lines-supergalactic").html("Supergalactic plane"),M.append("input").attr("type","checkbox").attr("id","lines-supergalactic-show").property("checked",c.lines.supergalactic.show).on("change",s),M=m.append("div").attr("class","col").attr("id","other"),M.append("label").attr("class","header").html("Other"),M.append("label").attr("for","mw-show").html("Milky Way"),M.append("input").attr("type","checkbox").attr("id","mw-show").property("checked",c.mw.show).on("change",s),M.append("label").attr("for","mw-style-fill").html(" color"),M.append("input").attr("type","color").attr("id","mw-style-fill").attr("title","Milky Way color").attr("value",c.mw.style.fill).on("change",s),M.append("label").attr("for","mw-style-opacity").html(" opacity"),M.append("input").attr("type","number").attr("id","mw-style-opacity").attr("title","Transparency of each Milky Way layer").attr("value",c.mw.style.opacity).attr("max","1").attr("min","0").attr("step","0.01").on("change",s),M.append("br"),M.append("label").attr("for","background").html("Background color"),M.append("input").attr("type","color").attr("id","background-fill").attr("title","Background color").attr("value",c.background.fill).on("change",s),M.append("label").attr("title","Star/DSO sizes are increased with higher zoom-levels").attr("for","adaptable").html("Adaptable object sizes"),M.append("input").attr("type","checkbox").attr("id","adaptable").property("checked",c.adaptable).on("change",s),L(),E(c.transform),N(t)}function j(t){var e,a=t.id;switch(a){case"stars-show":e=!g(a).checked;for(var n=0;n<mt[a].length;n++)A(mt[a][n],e);case"stars-names":for(e=!g("stars-names").checked||!g("stars-show").checked,n=0;n<mt["stars-names"].length;n++)A(mt["stars-names"][n],e);case"stars-proper":for(e=!g("stars-names").checked||!g("stars-show").checked||!g("stars-proper").checked,n=0;n<mt["stars-proper"].length;n++)A(mt["stars-proper"][n],e);break;case"dsos-show":for(e=!g(a).checked,n=0;n<mt[a].length;n++)A(mt[a][n],e);case"dsos-names":for(e=!g("dsos-names").checked||!g("dsos-show").checked,n=0;n<mt["dsos-names"].length;n++)A(mt["dsos-names"][n],e);break;case"constellations-show":case"mw-show":for(e=!g(a).checked,n=0;n<mt[a].length;n++)A(mt[a][n],e)}}function A(t,e){var a=g(t);a.disabled=e,a.previousSibling.style.color=e?"#999":"#000"}function D(t,e){var a=z(t);d3.select("#error").html(e).style({top:M(a[1]+t.offsetHeight+1),left:M(a[0]),opacity:1}),t.focus()}function C(t){var e,a="hr"===t.id||"min"===t.id||"sec"===t.id?1:0;if(t.validity){if(e=t.validity,e.typeMismatch||e.badInput)return D(t,t.title+": check field value"),!1;if(e.rangeOverflow||e.rangeUnderflow)return D(t,t.title+" must be between "+(parseInt(t.min)+a)+" and "+(parseInt(t.max)-a)),!1}else{if(e=t.value,!w(e))return D(t,t.title+": check field value"),!1;if((e=parseFloat(e))<t.min||e>t.max)return D(t,t.title+" must be between "+(t.min+a)+" and "+(+t.max-a)),!1}return d3.select("#error").style({top:"-9999px",left:"-9999px",opacity:0}),!0}function F(t){var e;if(t.validity){if(e=t.validity,e.typeMismatch||e.badInput)return D(t,t.title+": check field value"),!1;if(-1===t.value.search(/^#[0-9A-F]{6}$/i))return D(t,t.title+": not a color value"),!1}else{if(""===(e=t.value))return!0;if(-1===e.search(/^#[0-9A-F]{6}$/i))return D(t,t.title+": not a color value"),!1}return d3.select("#error").style({top:"-9999px",left:"-9999px",opacity:0}),!0}function E(t,e){var a=g("centerx");return a?(e&&("equatorial"===t&&"equatorial"!==e?(a.value=(a.value/15).toFixed(1),a.value<0&&(a.value+=24)):"equatorial"!==t&&"equatorial"===e&&(a.value=(15*a.value).toFixed(1),a.value>180&&(a.value-=360))),"equatorial"===t?(a.min="0",a.max="24",g("cxunit").innerHTML="h"):(a.min="-180",a.max="180",g("cxunit").innerHTML="°"),a.value):null}function O(t,e){var a=g("centerx"),n=g("centery"),r=g("centerz");a&&n&&(null===t&&(t=[0,0,0]),t.length<=2&&(t[2]=0),a.value="equatorial"!==e?t[0].toFixed(1):t[0]<0?(t[0]/15+24).toFixed(1):(t[0]/15).toFixed(1),n.value=t[1].toFixed(1),r.value=null!==t[2]?t[2].toFixed(1):0)}function L(){var t,e,a,n=/\d+(\.\d+)?/g,r={s:6,d:6},o=R.settings();return a=o.dsos.data,t=a.match(n),null!==t&&(r.d=parseFloat(t[t.length-1])),6!=r.d&&(g("dsos-limit").max=r.d,g("dsos-namelimit").max=r.d),e=o.stars.data,t=e.match(n),null!==t&&(r.s=parseFloat(t[t.length-1])),6!=r.s&&(g("stars-limit").max=r.s,g("stars-namelimit").max=r.s),r}function N(t,e){var a;if(b(t,"formFields")){if(e&&b(t.formFields,e))return void d3.select("#"+e).style({display:"none"});for(var n in t.formFields)b(t.formFields,n)&&"location"!==n&&(a=!1===t.formFields[n]?"none":"inline-block",d3.select("#"+n).style({display:a}))}}function H(t){function e(){d.setTime(Date.now()),g("datetime").value=r(d,u),i()}function a(){navigator.geolocation.getCurrentPosition(function(t){h=[y(t.coords.latitude,4),y(t.coords.longitude,4)],g("lat").value=h[0],g("lon").value=h[1],i()})}function n(){p.show(d)}function r(t,e){var a;if(e&&"0"!==e){var n=Math.floor(Math.abs(e)/60),r=Math.abs(e)-60*n;a=(e<0?" +":" −")+v(n)+v(r)}else a=" ±0000";return l(t)+a}function o(t){return!(!t||!k(t)||t.length<2)&&(!(!w(t[0])||t[0]<-90||t[0]>90)&&!(!w(t[1])||t[1]<-180||t[1]>180))}function i(){var e=g("lon").value,a=g("lat").value;d=l.parse(g("datetime").value.slice(0,-6));var n=d.getTimezoneOffset(),r=new Date(d.valueOf()+6e4*(u-n));t.horizon.show=!!g("horizon-show").checked,t.daylight.show=!!g("daylight-show").checked,t.planets.show=!!g("planets-show").checked,""!==e&&""!==a&&(h=[parseFloat(a),parseFloat(e)],c=R.getPoint(lt.inverse(r,[90,0],h),t.transform),c[2]=0,"zenith"===t.follow?R.rotate({center:c,horizon:t.horizon}):R.apply({horizon:t.horizon}))}var s=d3.select("#celestial-form form").insert("div","div#general").attr("id","loc"),l=d3.time.format("%Y-%m-%d %H:%M:%S"),c=[0,0],h=[0,0],d=new Date,u=d.getTimezoneOffset(),p=new zt(t,function(t,e){g("datetime").value=r(t,e),u=e,i()});b(t,"geopos")&&null!==t.geopos&&2===t.geopos.length&&(h=t.geopos);var f=s.append("div").attr("class","col").attr("id","location").style("display","none");f.append("label").attr("title","Location coordinates long/lat").attr("for","lat").html("Location"),f.append("input").attr("type","number").attr("id","lat").attr("title","Latitude").attr("placeholder","Latitude").attr("max","90").attr("min","-90").attr("step","0.0001").attr("value",h[0]).on("change",function(){!0===C(this)&&i()}),f.append("span").html("°"),f.append("input").attr("type","number").attr("id","lon").attr("title","Longitude").attr("placeholder","Longitude").attr("max","180").attr("min","-180").attr("step","0.0001").attr("value",h[1]).on("change",function(){!0===C(this)&&i()}),f.append("span").html("°"),"geolocation"in navigator&&f.append("input").attr("type","button").attr("value","Here").attr("id","here").on("click",a),f.append("label").attr("title","Local date/time").attr("for","datetime").html(" Date/time"),f.append("input").attr("type","button").attr("id","day-left").attr("title","One day back").on("click",function(){d.setDate(d.getDate()-1),g("datetime").value=r(d,u),i()}),f.append("input").attr("type","text").attr("id","datetime").attr("title","Date and time").attr("value",r(d,u)).on("click",n,!0).on("input",function(){this.value=r(d,u),p.isVisible()||n()}),f.append("div").attr("id","datepick").on("click",n),f.append("input").attr("type","button").attr("id","day-right").attr("title","One day forward").on("click",function(){d.setDate(d.getDate()+1),g("datetime").value=r(d,u),i()}),f.append("input").attr("type","button").attr("value","Now").attr("id","now").on("click",e),f.append("br"),f.append("label").attr("title","Show horizon marker").attr("for","horizon-show").html(" Horizon marker"),f.append("input").attr("type","checkbox").attr("id","horizon-show").property("checked",t.horizon.show).on("change",i),f.append("label").attr("title","Show daylight").attr("for","daylight-show").html("Daylight sky"),f.append("input").attr("type","checkbox").attr("id","daylight-show").property("checked",t.daylight.show).on("change",i),f.append("label").attr("title","Show solar system objects").attr("for","planets-show").html(" Planets, Sun & Moon"),f.append("input").attr("type","checkbox").attr("id","planets-show").property("checked",t.planets.show).on("change",i),d3.select(document).on("mousedown",function(){!P(d3.event.target,"celestial-date")&&p.isVisible()&&p.hide()}),R.getPosition=function(t){},R.date=function(t,e){if(!t)return d;u=e||u,p.isVisible()&&p.hide(),d.setTime(t.valueOf()),g("datetime").value=r(t,u),R.redraw()},R.position=function(){return h},R.location=function(e){if(!e||e.length<2)return h;o(t.location)&&(h=t.location.slice(),g("lat").value=h[0],g("lon").value=h[1],i())},R.skyview=function(t){var e=!1;if(p.isVisible()&&p.hide(),x(t.date)&&(d.setTime(t.date.valueOf()),g("datetime").value=r(t.date,u),e=!0),u=t.timezone||u,o(t.location)&&(h=t.location.slice(),g("lat").value=h[0],g("lon").value=h[1],e=!0),!0!==e)return{date:d,location:h};i()},R.dtLoc=R.skyview,R.zenith=function(){return c},R.nadir=function(){var t=-c[1],e=c[0]+180;return e>180&&(e-=360),[e,t-.001]},b(t,"formFields")&&d3.select("location").style({display:!1===t.location||!1===t.formFields.location?"none":"inline-block"}),!0===t.location&&!0===t.formFields.location&&setTimeout(i,1e3)}var U,_,W,G,V,B,R={version:"0.6.20",container:null,data:[]},Y=.035,$=1.4,J=2e3,Q=2500,Z=1500,K=10,X=1;if(R.display=function(a){function n(){for(var t in U.lines)b(U.lines,t)&&("graticule"===t?(xt.append("path").datum(Rt).attr("class","graticule"),b(U.lines.graticule,"lon")&&U.lines.graticule.lon.pos.length>0&&xt.selectAll(".gridvalues_lon").data(d("lon",U.lines.graticule.lon.pos)).enter().append("path").attr("class","graticule_lon"),b(U.lines.graticule,"lat")&&U.lines.graticule.lat.pos.length>0&&xt.selectAll(".gridvalues_lat").data(d("lat",U.lines.graticule.lat.pos)).enter().append("path").attr("class","graticule_lat")):xt.append("path").datum(d3.geo.circle().angle([90]).origin(e(nt[t],st[Ct]))).attr("class",t));d3.json(Gt+"mw.json",function(t,e){if(t)return window.alert("Your Browser doesn't support local file loading or the file doesn't exist. See readme.md"),console.warn(t);var a=o(e,Ct),n=c(a);xt.selectAll(".mway").data(a.features).enter().append("path").attr("class","mw"),xt.selectAll(".mwaybg").data(n.features).enter().append("path").attr("class","mwbg")}),d3.json(Gt+"constellations.json",function(t,e){if(t)return console.warn(t);var n=o(e,Ct);xt.selectAll(".constnames").data(n.features).enter().append("text").attr("class","constname");var r=l(e,Ct);if(g("constellation")){var i=d3.select("#constellation"),s=0,c=Object.keys(r).map(function(t,e){return t===a.constellation&&(s=e),{o:t,n:r[t].name}});c=[{o:"",n:"(Select constellation)"}].concat(c),i.selectAll("option").data(c).enter().append("option").attr("value",function(t){return t.o}).text(function(t){return t.n}),i.property("selectedIndex",s)}R.constellations=r}),d3.json(Gt+"constellations.bounds.json",function(t,e){if(t)return console.warn(t);var a=o(e,Ct);xt.selectAll(".bounds").data(a.features).enter().append("path").attr("class","boundaryline")}),d3.json(Gt+"constellations.lines.json",function(t,e){if(t)return console.warn(t);var a=o(e,Ct);xt.selectAll(".lines").data(a.features).enter().append("path").attr("class","constline")}),d3.json(Gt+U.stars.data,function(t,e){if(t)return console.warn(t);var a=o(e,Ct);xt.selectAll(".stars").data(a.features).enter().append("path").attr("class","star")}),d3.json(Gt+U.dsos.data,function(t,e){if(t)return console.warn(t);var a=o(e,Ct);xt.selectAll(".dsos").data(a.features).enter().append("path").attr("class","dso")}),d3.json(Gt+"planets.json",function(t,e){if(t)return console.warn(t);var a=i(e);xt.selectAll(".planets").data(a).enter().append("path").attr("class","planet")}),R.data.length>0&&R.data.forEach(function(t){b(t,"file")?d3.json(t.file,t.callback):setTimeout(t.callback,0)},this),m()}function r(t){if(t&&1!==t){var e=_.scale(),a=e*t,n=W.scaleExtent(),r=Z*Math.sqrt(Math.abs(1-t));a<n[0]&&(a=n[0]),a>n[1]&&(a=n[1]);var o=d3.interpolateNumber(e,a);return d3.select({}).transition().duration(r).tween("scale",function(){return function(t){var e=o(t);_.scale(e),m()}}).transition().duration(0).tween("scale",function(){W.scale(a),m()}),r}}function h(t){U=U.set(t),m()}function u(t){var e,a,n,r=U.center,o=_.rotate(),i=_.scale(),s=J,l=!1,c=U.orientationfixed;y(o[1],1)===-y(t.center[1],1)&&(l=!0),U=U.set(t);var h=y(d3.geo.distance(r,U.center),2),d=d3.geo.distance([r[2],0],[U.center[2],0]);return h<Y&&d<Y?(Wt=yt(U.center),_.rotate(Wt),m()):(a=i>Ot*$?d3.interpolateNumber(i,Ot):function(){return i},n=0===d?function(){return o[2]}:S(r[2],U.center[2]),h>3.14&&(U.center[0]-=.01),U.orientationfixed=!1,e=0===h?function(){return U.center}:d3.geo.interpolate(r,U.center),s=0!==h?s*h:s*d,d3.select({}).transition().duration(s).tween("center",function(){return function(t){var r=yt(e(t));r[2]=n(t);var i=a(t<.5?t:1-t);l&&(r[1]=o[1]),_.scale(i),_.rotate(r),m()}}).transition().duration(0).tween("center",function(){U.orientationfixed=c,Wt=yt(U.center),_.rotate(Wt),m()})),s}function p(t){jt=gt(),(U.width!==jt||t)&&(Et=jt/Ft,Ot=Dt.scale*jt/1024,Vt.style("width",M(jt)).style("height",M(Et)).attr("width",jt*At).attr("height",Et*At),W.scaleExtent([Ot,Ot*K]).scale(Ot*X),_.translate([jt/2,Et/2]).scale(Ot*X),qt&&(qt.style.height=M(Et)),Ot*=X,m())}function f(e){var a=Mt(e.projection);if(a){var n=_.rotate(),o=_.center(),i=_.scale(),s=W.scaleExtent(),l=R.projection(U.projection).center(o).translate([jt/2,Et/2]).scale([s[0]]),c=Q,h=0,d=d3.interpolateNumber(Ft,a.ratio);Dt.clip!=a.clip&&(c=0);var u=R.projection(e.projection).center(o).translate([jt/2,jt/a.ratio/2]).scale([a.scale*jt/1024]),p=U.adaptable;return i>s[0]?(h=r(.1),setTimeout(f,h,e),h+c):(U.location&&(A("horizon-show",a.clip),A("daylight-show",!a.clip)),_=t(l,u),U.adaptable=!1,d3.select({}).transition().duration(c).tween("projection",function(){return function(t){_.alpha(t).rotate(n),G.projection(_),D(a.clip),Ft=d(t),Et=jt/Ft,Vt.style("width",M(jt)).style("height",M(Et)).attr("width",jt*At).attr("height",Et*At),qt&&(qt.style.height=M(Et)),m()}}).transition().duration(0).tween("projection",function(){Dt=a,Ft=Dt.ratio,Et=jt/Dt.ratio,Ot=Dt.scale*jt/1024,Vt.style("width",M(jt)).style("height",M(Et)).attr("width",jt*At).attr("height",Et*At),qt&&(qt.style.height=M(Et)),U.projection=e.projection,_=R.projection(e.projection).rotate(n).translate([jt/2,Et/2]).scale(Ot*X),G.projection(_),D(Dt.clip),W.projection(_).scaleExtent([Ot,Ot*K]).scale(Ot*X),U.adaptable=p,Ot*=X,m()}),c)}}function m(){var t=_.rotate();Bt.setTransform(At,0,0,At,0,0),U.adaptable&&(_t=Math.sqrt(_.scale()/Ot)),_t||(_t=1),Lt=U.stars.size,Ht=U.stars.exponent,Nt=U.dsos.size||Lt,Ut=U.dsos.exponent,U.orientationfixed&&(t[2]=U.center[2],_.rotate(t)),U.center=[-t[0],-t[1],t[2]],O(U.center,U.transform),mt(),v(),U.mw.show&&(xt.selectAll(".mw").each(function(t){z(U.mw.style),G(t),Bt.fill()}),
"supergalactic"!==U.transform&&xt.selectAll(".mwbg").each(function(t){z(U.background),G(t),Bt.fill()}));for(var e in U.lines)b(U.lines,e)&&!0===U.lines[e].show&&(z(U.lines[e]),xt.selectAll("."+e).attr("d",G),Bt.stroke());if(b(U.lines.graticule,"lon")&&(P(U.lines.graticule.lon),xt.selectAll(".graticule_lon").each(function(t,e){if(x(t.geometry.coordinates)){var a=_(t.geometry.coordinates);ft(a,t.properties.orientation),Bt.fillText(t.properties.value,a[0],a[1])}})),b(U.lines.graticule,"lat")&&(P(U.lines.graticule.lat),xt.selectAll(".graticule_lat").each(function(t,e){if(x(t.geometry.coordinates)){var a=_(t.geometry.coordinates);ft(a,t.properties.orientation),Bt.fillText(t.properties.value,a[0],a[1])}})),v(!0),U.constellations.show&&(U.constellations.bounds&&(xt.selectAll(".boundaryline").each(function(t){z(U.constellations.boundstyle),R.constellation&&R.constellation===t.id&&(Bt.lineWidth*=1.5,Bt.setLineDash([])),G(t),Bt.stroke()}),v(!0)),U.constellations.names&&(P(U.constellations.namestyle),xt.selectAll(".constname").each(function(t){if(x(t.geometry.coordinates)){I(t.properties.rank,U.constellations.namestyle.font);var e=_(t.geometry.coordinates);Bt.fillText(lt(t),e[0],e[1])}})),U.constellations.lines&&xt.selectAll(".constline").each(function(t){z(U.constellations.linestyle),G(t),Bt.stroke()})),U.stars.show&&(z(U.stars.style),xt.selectAll(".star").each(function(t){if(x(t.geometry.coordinates)&&t.properties.mag<=U.stars.limit){var e=_(t.geometry.coordinates),a=rt(t);Bt.fillStyle=it(t),Bt.beginPath(),Bt.arc(e[0],e[1],a,0,2*Math.PI),Bt.closePath(),Bt.fill(),U.stars.names&&t.properties.mag<=U.stars.namelimit*_t&&(P(U.stars.namestyle),Bt.fillText(tt(t),e[0]+a,e[1])),U.stars.proper&&t.properties.mag<=U.stars.propernamelimit*_t&&(P(U.stars.propernamestyle),Bt.fillText(et(t),e[0]-a,e[1]))}})),U.dsos.show&&xt.selectAll(".dso").each(function(t){if(x(t.geometry.coordinates)&&C(t.properties,U.dsos.limit)){var e=_(t.geometry.coordinates),a=t.properties.type;z(!0===U.dsos.colors?U.dsos.symbols[a]:U.dsos.style);var n=F(t,e);b(U.dsos.symbols[a],"stroke")?Bt.stroke():Bt.fill(),U.dsos.names&&C(t.properties,U.dsos.namelimit)&&(P(U.dsos.namestyle),!0===U.dsos.colors&&(Bt.fillStyle=U.dsos.symbols[a].fill),Bt.fillText(N(t),e[0]+n,e[1]-n))}}),U.location&&"equatorial"===U.transform&&U.planets.show&&R.origin){var a=R.date(),n=R.origin(a).spherical();xt.selectAll(".planet").each(function(t){var e=t.id(),r=t(a).equatorial(n);if(x(r.pos)){var o=_(r.pos),i=U.planets.symbols[e];"lun"!==e?(P(U.planets.style),Bt.fillStyle=i.fill,Bt.fillText(i.symbol,o[0],o[1])):pt.symbol().type("crescent").size(144).age(r.age).position(o)(Bt)}})}if(R.data.length>0&&R.data.forEach(function(t){t.redraw()}),U.location&&U.daylight.show&&Dt.clip){var r=s("sol");if(r){var o=R.zenith(),i=d3.geo.distance(o,r.pos),l=_(r.pos);B.origin(r.pos),q(i,l),xt.selectAll(".daylight").datum(B).attr("d",G),Bt.fill(),Bt.fillStyle="#fff",x(r.pos)&&(Bt.beginPath(),Bt.arc(l[0],l[1],6,0,2*Math.PI),Bt.closePath(),Bt.fill())}}U.location&&U.horizon.show&&!Dt.clip&&(V.origin(R.nadir()),z(U.horizon),xt.selectAll(".horizon").datum(V).attr("d",G),Bt.fill(),U.horizon.stroke&&Bt.stroke()),U.controls&&j(_.scale()),ct&&R.runCallback()}function v(t){var e=_.rotate();_.rotate([0,0]),z(U.background),xt.selectAll(".outline").attr("d",G),!0===t?Bt.stroke():Bt.fill(),_.rotate(e)}function x(t){return Dt.clip&&d3.geo.distance(U.center,t)>ot?0:1}function z(t){Bt.fillStyle=t.fill||null,Bt.strokeStyle=t.stroke||null,Bt.lineWidth=t.width||null,Bt.globalAlpha=t.opacity||1,Bt.font=t.font||null,b(t,"dash")?Bt.setLineDash(t.dash):Bt.setLineDash([]),Bt.beginPath()}function P(t){Bt.fillStyle=t.fill,Bt.textAlign=t.align||"left",Bt.textBaseline=t.baseline||"bottom",Bt.globalAlpha=t.opacity||1,Bt.font=t.font}function I(t,e){k(e)?1===e.length?Bt.font=e[0]:t>e.length?Bt.font=e[e.length-1]:Bt.font=e[t-1]:Bt.font=e}function q(t,e){var a,n,r,o;if(t>1.885)return Bt.fillStyle="transparent",void(Bt.globalAlpha=0);t<=1.36?(n="#daf1fa",r="#93d7f0",o="#57c0e8",a=-(1.36-t)/10):(a=(t-1.36)/(1.885-1.36),n=d3.interpolateLab("#daf1fa","#e8c866")(a),r=d3.interpolateLab("#93d7f0","#ff854a")(a),o=d3.interpolateLab("#57c0e8","#6caae2")(a));var i=Bt.createRadialGradient(e[0],e[1],0,e[0],e[1],300);i.addColorStop(0,n),i.addColorStop(.2+.4*a,r),i.addColorStop(1,o),Bt.fillStyle=i,Bt.globalAlpha=.9*(1-Math.pow(a,4))}function j(t){var e=g("celestial-zoomin"),a=g("celestial-zoomout"),n=Dt.scale*jt/1024;e&&a&&(e.disabled=t>=n*K*.99,a.disabled=t<=n)}function D(t){t?(_.clipAngle(90),xt.selectAll(".outline").remove(),xt.append("path").datum(d3.geo.circle().angle([90])).attr("class","outline")):(_.clipAngle(null),xt.selectAll(".outline").remove(),xt.append("path").datum(Rt.outline).attr("class","outline"))}function C(t,e){return 999===t.mag&&Math.sqrt(parseInt(t.dim))>e||999!==t.mag&&t.mag<=e}function F(t,e){var a=t.properties,n=L(a)||9,r=E(a.type);return pt.symbol().type(r).size(n).position(e)(Bt),Math.sqrt(n)/2}function E(t){return t&&b(U.dsos.symbols,t)?U.dsos.symbols[t].shape:"circle"}function L(t){return t.mag&&999!==t.mag?Math.pow(2*Nt*_t-t.mag,Ut):Math.pow(parseInt(t.dim)*Nt*_t/7,.5)}function N(t){var e=t.properties;if(""!==e.name)return U.dsos.desig&&e.desig?e.desig:e.name}function tt(t){var e=t.properties.desig;return U.stars.desig?e:e.replace(/^(HD|HIP|V\d{3}).+/,"")}function et(t){return t.properties.name}function rt(t){var e=t.properties.mag;if(null===e)return.1;var a=Lt*_t*Math.exp(Ht*(e+2));return Math.max(a,.1)}function it(t){var e=t.properties.bv;return!U.stars.colors||isNaN(e)?U.stars.style.fill:dt(e)}function lt(t){return U.constellations.desig?t.properties.desig:t.properties[U.lang]}function ft(t,e){for(var a=e.split(""),n="center",r="middle",o=a.length-1;o>=0;o--)switch(a[o]){case"N":r="bottom";break;case"S":r="top";break;case"E":n="left",t[0]+=2;break;case"W":n="right",t[0]-=2}return Bt.textAlign=n,Bt.textBaseline=r,t}function mt(){Bt.clearRect(0,0,jt+Tt[0],Et+Tt[1])}function gt(){return U.width&&U.width>0?U.width:qt?qt.getBoundingClientRect().width-Tt[0]:window.getBoundingClientRect().width-2*Tt[0]}function Mt(t){if(b(ut,t)){var e=ut[t];return b(e,"ratio")||(e.ratio=2),e}}function yt(t){if(null===t)return[0,0,0];var e=at.equatorial;return t[2]||(t[2]=0),[e[0]-t[0],e[1]-t[1],e[2]+t[2]]}function vt(){if(zt&&!(zt.length<1)){var t,e=zt[Pt];switch(e.param){case"projection":t=f({projection:e.value});break;case"center":t=u({center:e.value});break;case"zoom":t=r(e.value)}e.callback&&setTimeout(e.callback,t),Pt++,!0===It&&Pt===zt.length&&(Pt=0),t=0===e.duration||e.duration<t?t:e.duration,Pt<zt.length&&(kt=setTimeout(vt,t))}}function bt(){clearTimeout(kt)}var wt,kt,xt=R.container,zt=[],Pt=0,It=!1;U=ht.set(a),U.stars.size=U.stars.size||7,U.stars.exponent=U.stars.exponent||-.28,U.center=U.center||[0,0],U.lang&&-1!==U.lang.search(/^de|es$/)||(U.lang="name"),w(U.zoomextend)&&(K=U.zoomextend),w(U.zoomlevel)&&(X=U.zoomlevel);var qt=g(U.container);if(qt){wt="#"+U.container;var St=window.getComputedStyle(qt,null);parseInt(St.width)||U.width||(qt.style.width=M(qt.parentNode.clientWidth))}else wt="body",qt=null;var Tt=[16,16],jt=gt(),At=window.devicePixelRatio||1,Dt=Mt(U.projection);if(U.lines.graticule.lat&&"outline"===U.lines.graticule.lat.pos[0]&&(Dt.scale-=2),Dt){var Ct=U.transform||"equatorial",Ft=Dt.ratio,Et=jt/Ft,Ot=Dt.scale*jt/1024,Lt=U.stars.size,Nt=U.dsos.size||Lt,Ht=U.stars.exponent,Ut=U.dsos.exponent||Ht,_t=1,Wt=yt(U.center),Gt=U.datapath||"";Gt=Gt.replace(/([^\/]$)/,"$1/"),"body"!=wt&&(g(U.container).style.height=M(Et)),_=R.projection(U.projection).rotate(Wt).translate([jt/2,Et/2]).scale(Ot*X),W=d3.geo.zoom().projection(_).center([jt/2,Et/2]).scaleExtent([Ot,Ot*K]).on("zoom.redraw",m),Ot*=X;var Vt=d3.select(wt).selectAll("canvas");0===Vt[0].length&&(Vt=d3.select(wt).append("canvas")),Vt.style("width",M(jt)).style("height",M(Et)).attr("width",jt*At).attr("height",Et*At);var Bt=Vt.node().getContext("2d");Bt.setTransform(At,0,0,At,0,0);var Rt=d3.geo.graticule().minorStep([15,10]);G=d3.geo.path().projection(_).context(Bt),xt?xt.selectAll("*").remove():xt=d3.select(wt).append("container"),U.interactive?(Vt.call(W),d3.select(wt).on("dblclick",function(){return r(1.5625),!1})):Vt.attr("style","cursor: default!important"),D(Dt.clip),d3.select(window).on("resize",p),!0===U.controls&&null===g("celestial-zoomin")&&(d3.select(wt).append("input").attr("type","button").attr("id","celestial-zoomin").attr("value","+").on("click",function(){return r(1.25),!1}),d3.select(wt).append("input").attr("type","button").attr("id","celestial-zoomout").attr("value","−").on("click",function(){return r(.8),!1})),V=d3.geo.circle().angle([90]),xt.append("path").datum(V).attr("class","horizon"),B=d3.geo.circle().angle([179.9]),xt.append("path").datum(B).attr("class","daylight"),T(U),!1===U.form&&d3.select("#celestial-form").style("display","none"),null===g("error")&&d3.select("body").append("div").attr("id","error"),null===g("loc")?H(U):!0===U.location&&"zenith"===U.follow&&u({center:R.zenith()}),!0===U.location&&(d3.select("#location").style("display","inline-block"),A("horizon-show",Dt.clip),A("daylight-show",!Dt.clip)),this.container=xt,this.clip=x,this.map=G,this.mapProjection=_,this.context=Bt,this.metrics=function(){return{width:jt,height:Et,margin:Tt}},this.setStyle=z,this.setTextStyle=P,this.setConstStyle=I,this.dsoSymbol=F,this.redraw=m,this.resize=function(t){t&&b(t,"width")&&(U.width=t.width),p(!0)},this.reload=function(t){t&&b(t,"transform")&&(Ct=U.transform=t.transform,"equatorial"===Ct?Rt.minorStep([15,10]):Rt.minorStep([10,10]),xt.selectAll("*").remove(),D(),xt.append("path").datum(V).attr("class","horizon"),n())},this.apply=function(t){h(t)},this.reproject=function(t){return f(t)},this.rotate=function(t){return t?u(t):U.center},this.zoomBy=function(t){return t?r(t):_.scale()/Ot},this.color=function(t){return t&&b(U.dsos.symbols,t)?U.dsos.symbols[t].fill:"#000"},this.animate=function(t,e){t&&(zt=t,Pt=0,It=!!e,vt())},this.stop=function(t){bt(),!0===t&&(zt=[])},this.go=function(t){zt.length<1||(t&&t<zt.length&&(Pt=t),vt())},n()}},"object"==typeof module&&module.exports){var tt=require("./lib/d3.js"),et=require("./lib/d3.geo.projection.js");module.exports={Celestial:function(){return R},d3:function(){return tt},"d3.geo.projection":function(){return et}}}R.projection=function(t){var e,a,n;if(!b(ut,t))throw new Error("Projection not supported: "+t);return e=ut[t],a=null!==e.arg?d3.geo[t].raw(e.arg):d3.geo[t].raw,n=function(t,e){return a(-t,e)},n.invert=function(t,e){try{var n=a.invert(t,e);return n[0]=n&&-n[0],n}catch(t){console.log(t)}},d3.geo.projection(n)};var at={equatorial:[0,0,0],ecliptic:[0,0,23.4393],galactic:[93.5949,28.9362,-58.5988],supergalactic:[137.31,59.5283,57.7303]},nt={equatorial:[0,90],ecliptic:[-90,66.5607],galactic:[-167.1405,27.1283],supergalactic:[-76.2458,15.7089]};R.eulerAngles=function(){return at},R.poles=function(){return nt};var rt=2*Math.PI,ot=Math.PI/2,it=Math.PI/180,st={ecliptic:[-90,23.4393,90],"inverse ecliptic":[90,23.4393,-90],galactic:[-167.1405,62.8717,122.9319],"inverse galactic":[122.9319,62.8717,-167.1405],supergalactic:[283.7542,74.2911,26.4504],"inverse supergalactic":[26.4504,74.2911,283.7542],init:function(){for(var t in this)this[t].constructor==Array&&(this[t]=this[t].map(function(t){return t*it}))},add:function(t,e){if(e&&t&&3===e.length&&!this.hasOwnProperty(t))return this[t]=e.map(function(t){return t*it}),this[t]}};st.init(),R.euler=function(){return st};var lt=function(t,e,a){var r=n(t,a[1])-e[0];r<0&&(r+=360),r*=it;var o=e[1]*it,i=a[0]*it,s=Math.asin(Math.sin(o)*Math.sin(i)+Math.cos(o)*Math.cos(i)*Math.cos(r)),l=Math.acos((Math.sin(o)-Math.sin(s)*Math.sin(i))/(Math.cos(s)*Math.cos(i)));return Math.sin(r)>0&&(l=2*Math.PI-l),[s/it,l/it,0]};lt.inverse=function(t,e,a){var r=e[0]*it,o=e[1]*it,i=a[0]*it,s=Math.asin(Math.sin(r)*Math.sin(i)+Math.cos(r)*Math.cos(i)*Math.cos(o)),l=((Math.sin(r)-Math.sin(s)*Math.sin(i))/(Math.cos(s)*Math.cos(i))).toFixed(6);return l=Math.acos(l),l/=it,[n(t,a[1])-l,s/it,0]},R.horizontal=lt;var ct=!1;R.add=function(t){var e={};return b(t,"type")?"dso"!==t.type&&"json"!==t.type||b(t,"file")&&b(t,"callback")?"line"!==t.type&&"raw"!==t.type||b(t,"callback")?(b(t,"file")&&(e.file=t.file),e.type=t.type,b(t,"callback")&&(e.callback=t.callback),b(t,"redraw")&&(e.redraw=t.redraw),void R.data.push(e)):console.log("Can't add data"):console.log("Can't add data file"):console.log("Missing type")},R.remove=function(t){if(null!==t&&t<R.data.length)return R.data.splice(t,1)},R.clear=function(){R.data=[]},R.addCallback=function(t){R.callback=t,ct=null!==t},R.runCallback=function(t){ct=!1,R.callback(),ct=!0},R.getData=o,R.getPoint=r,R.getPlanet=s;var ht={width:0,projection:"aitoff",transform:"equatorial",center:null,geopos:null,follow:"zenith",orientationfixed:!0,zoomlevel:null,zoomextend:10,adaptable:!0,interactive:!0,form:!1,location:!0,formFields:{location:!1,general:!0,stars:!0,dsos:!0,constellations:!0,lines:!0,other:!0},daterange:[],controls:!0,lang:"",container:"celestial-map",datapath:"data/",stars:{show:!0,limit:6,colors:!0,style:{fill:"#ffffff",opacity:1},names:!0,proper:!1,desig:!1,namestyle:{fill:"#ddddbb",font:"11px 'Palatino Linotype', Georgia, Times, 'Times Roman', serif",align:"left",baseline:"top"},namelimit:2.5,propernamestyle:{fill:"#ddddbb",font:"13px 'Palatino Linotype', Georgia, Times, 'Times Roman', serif",align:"right",baseline:"bottom"},propernamelimit:1.5,size:7,exponent:-.28,data:"stars.6.json"},dsos:{show:!0,limit:6,colors:!0,style:{fill:"#cccccc",stroke:"#cccccc",width:2,opacity:1},names:!0,desig:!0,namestyle:{fill:"#cccccc",font:"11px 'Lucida Sans Unicode', Helvetica, Arial, serif",align:"left",baseline:"top"},namelimit:4,size:null,exponent:1.4,data:"dsos.bright.json",symbols:{gg:{shape:"circle",fill:"#ff0000"},g:{shape:"ellipse",fill:"#ff0000"},s:{shape:"ellipse",fill:"#ff0000"},s0:{shape:"ellipse",fill:"#ff0000"},sd:{shape:"ellipse",fill:"#ff0000"},e:{shape:"ellipse",fill:"#ff0000"},i:{shape:"ellipse",fill:"#ff0000"},oc:{shape:"circle",fill:"#ff9900",stroke:"#ff9900",width:2},gc:{shape:"circle",fill:"#ff9900"},en:{shape:"square",fill:"#ff00cc"},bn:{shape:"square",fill:"#ff00cc"},sfr:{shape:"square",fill:"#cc00ff"},rn:{shape:"square",fill:"#0000ff"},pn:{shape:"diamond",fill:"#00cccc"},snr:{shape:"diamond",fill:"#ff00cc"},dn:{shape:"square",fill:"#999999",stroke:"#999999",width:2},pos:{shape:"marker",fill:"#cccccc",stroke:"#cccccc",width:1.5}}},constellations:{show:!0,names:!0,desig:!0,namestyle:{fill:"#cccc99",align:"center",baseline:"middle",opacity:.8,font:["14px 'Lucida Sans Unicode', Helvetica, Arial, sans-serif","12px 'Lucida Sans Unicode', Helvetica, Arial, sans-serif","11px 'Lucida Sans Unicode', Helvetica, Arial, sans-serif"]},lines:!0,linestyle:{stroke:"#cccccc",width:1.5,opacity:.6},bounds:!1,boundstyle:{stroke:"#ccff00",width:1,opacity:.8,dash:[2,4]}},mw:{show:!0,style:{fill:"#ffffff",opacity:"0.15"}},lines:{graticule:{show:!0,stroke:"#cccccc",width:.6,opacity:.8,lon:{pos:[""],fill:"#eee",font:"10px 'Lucida Sans Unicode', Helvetica, Arial, sans-serif"},lat:{pos:[""],fill:"#eee",font:"10px 'Lucida Sans Unicode', Helvetica, Arial, sans-serif"}},equatorial:{show:!0,stroke:"#aaaaaa",width:1.3,opacity:.7},ecliptic:{show:!0,stroke:"#66cc66",width:1.3,opacity:.7},galactic:{show:!1,stroke:"#cc6666",width:1.3,opacity:.7},supergalactic:{show:!1,stroke:"#cc66cc",width:1.3,opacity:.7}},background:{fill:"#000000",opacity:1,stroke:"#000000",width:1.5},horizon:{show:!1,stroke:"#cccccc",width:1,fill:"#000000",opacity:.5},daylight:{show:!1},planets:{show:!1,which:["sol","mer","ven","ter","lun","mar","jup","sat","ura","nep"],style:{fill:"#00ccff",font:"bold 17px 'Lucida Sans Unicode', Consolas, sans-serif",align:"center",baseline:"middle"},symbols:{sol:{symbol:"☉",fill:"#ffff00"},mer:{symbol:"☿",fill:"#cccccc"},ven:{symbol:"♀",fill:"#eeeecc"},ter:{symbol:"⊕",fill:"#00ffff"},lun:{symbol:"●",fill:"#ffffff"},mar:{symbol:"♂",fill:"#ff9999"},cer:{symbol:"⚳",fill:"#cccccc"},ves:{symbol:"⚶",fill:"#cccccc"},jup:{symbol:"♃",fill:"#ff9966"},sat:{symbol:"♄",fill:"#ffcc66"},ura:{symbol:"♅",fill:"#66ccff"},nep:{symbol:"♆",fill:"#6666ff"},plu:{symbol:"♇",fill:"#aaaaaa"},eri:{symbol:"⚪",fill:"#eeeeee"}}},set:function(t){var e,a,n={};if(!t)return this;for(e in this)if(b(this,e))if(b(t,e)&&null!==t[e])if(null===this[e]||this[e].constructor!=Object)n[e]=t[e];else{n[e]={};for(a in this[e])b(t[e],a)?n[e][a]=t[e][a]:n[e][a]=this[e][a]}else n[e]=this[e];return n}};R.settings=function(){return ht};var dt=d3.scale.quantize().domain([3.347,-.335]).range(["#ff4700","#ff4b00","#ff4f00","#ff5300","#ff5600","#ff5900","#ff5b00","#ff5d00","#ff6000","#ff6300","#ff6500","#ff6700","#ff6900","#ff6b00","#ff6d00","#ff7000","#ff7300","#ff7500","#ff7800","#ff7a00","#ff7c00","#ff7e00","#ff8100","#ff8300","#ff8506","#ff870a","#ff8912","#ff8b1a","#ff8e21","#ff9127","#ff932c","#ff9631","#ff9836","#ff9a3c","#ff9d3f","#ffa148","#ffa34b","#ffa54f","#ffa753","#ffa957","#ffab5a","#ffad5e","#ffb165","#ffb269","#ffb46b","#ffb872","#ffb975","#ffbb78","#ffbe7e","#ffc184","#ffc489","#ffc78f","#ffc892","#ffc994","#ffcc99","#ffce9f","#ffd1a3","#ffd3a8","#ffd5ad","#ffd7b1","#ffd9b6","#ffdbba","#ffddbe","#ffdfc2","#ffe1c6","#ffe3ca","#ffe4ce","#ffe8d5","#ffe9d9","#ffebdc","#ffece0","#ffefe6","#fff0e9","#fff2ec","#fff4f2","#fff5f5","#fff6f8","#fff9fd","#fef9ff","#f9f6ff","#f6f4ff","#f3f2ff","#eff0ff","#ebeeff","#e9edff","#e6ebff","#e3e9ff","#e0e7ff","#dee6ff","#dce5ff","#d9e3ff","#d7e2ff","#d3e0ff","#c9d9ff","#bfd3ff","#b7ceff","#afc9ff","#a9c5ff","#a4c2ff","#9fbfff","#9bbcff"]),ut={airy:{n:"Airy’s Minimum Error",arg:Math.PI/2,scale:360,ratio:1,clip:!0},aitoff:{n:"Aitoff",arg:null,scale:162},armadillo:{n:"Armadillo",arg:0,scale:250},august:{n:"August",arg:null,scale:94,ratio:1.4},azimuthalEqualArea:{n:"Azimuthal Equal Area",arg:null,scale:340,ratio:1,clip:!0},azimuthalEquidistant:{n:"Azimuthal Equidistant",arg:null,scale:320,ratio:1,clip:!0},baker:{n:"Baker Dinomic",arg:null,scale:160,ratio:1.4},berghaus:{n:"Berghaus Star",arg:0,scale:320,ratio:1,clip:!0},boggs:{n:"Boggs Eumorphic",arg:null,scale:170},bonne:{n:"Bonne",arg:Math.PI/2.5,scale:225,ratio:.88},bromley:{n:"Bromley",arg:null,scale:162},cassini:{n:"Cassini",arg:null,scale:325,ratio:1,clip:!0},collignon:{n:"Collignon",arg:null,scale:100,ratio:2.6},craig:{n:"Craig Retroazimuthal",arg:0,scale:310,ratio:1.5,clip:!0},craster:{n:"Craster Parabolic",arg:null,scale:160},cylindricalEqualArea:{n:"Cylindrical Equal Area",arg:Math.PI/6,scale:190,ratio:2.3},cylindricalStereographic:{n:"Cylindrical Stereographic",arg:Math.PI/4,scale:230,ratio:1.3},eckert1:{n:"Eckert I",arg:null,scale:175},eckert2:{n:"Eckert II",arg:null,scale:175},eckert3:{n:"Eckert III",arg:null,scale:190},eckert4:{n:"Eckert IV",arg:null,scale:190},eckert5:{n:"Eckert V",arg:null,scale:182},eckert6:{n:"Eckert VI",arg:null,scale:182},eisenlohr:{n:"Eisenlohr",arg:null,scale:102},equirectangular:{n:"Equirectangular",arg:null,scale:165},fahey:{n:"Fahey",arg:null,scale:196,ratio:1.4},mtFlatPolarParabolic:{n:"Flat Polar Parabolic",arg:null,scale:175},mtFlatPolarQuartic:{n:"Flat Polar Quartic",arg:null,scale:230,ratio:1.65},mtFlatPolarSinusoidal:{n:"Flat Polar Sinusoidal",arg:null,scale:175,ratio:1.9},foucaut:{n:"Foucaut",arg:null,scale:142},ginzburg4:{n:"Ginzburg IV",arg:null,scale:180,ratio:1.7},ginzburg5:{n:"Ginzburg V",arg:null,scale:196,ratio:1.55},ginzburg6:{n:"Ginzburg VI",arg:null,scale:190,ratio:1.4},ginzburg8:{n:"Ginzburg VIII",arg:null,scale:205,ratio:1.3},ginzburg9:{n:"Ginzburg IX",arg:null,scale:190,ratio:1.4},homolosine:{n:"Goode Homolosine",arg:null,scale:160,ratio:2.2},hammer:{n:"Hammer",arg:2,scale:180},hatano:{n:"Hatano",arg:null,scale:186},healpix:{n:"HEALPix",arg:1,scale:320,ratio:1.2},hill:{n:"Hill Eucyclic",arg:2,scale:190,ratio:1.1},kavrayskiy7:{n:"Kavrayskiy VII",arg:null,scale:185,ratio:1.75},lagrange:{n:"Lagrange",arg:Math.PI/4,scale:88,ratio:1.6,clip:!1},larrivee:{n:"l'Arrivée",arg:null,scale:160,ratio:1.25},laskowski:{n:"Laskowski Tri-Optimal",arg:null,scale:165,ratio:1.7},loximuthal:{n:"Loximuthal",arg:Math.PI/4,scale:175,ratio:1.8},mercator:{n:"Mercator",arg:null,scale:160,ratio:1.3},miller:{n:"Miller",arg:null,scale:160,ratio:1.5},mollweide:{n:"Mollweide",arg:null,scale:180},naturalEarth:{n:"Natural Earth",arg:null,scale:185,ratio:1.85},nellHammer:{n:"Nell Hammer",arg:null,scale:160,ratio:2.6},orthographic:{n:"Orthographic",arg:null,scale:480,ratio:1,clip:!0},patterson:{n:"Patterson Cylindrical",arg:null,scale:160,ratio:1.75},polyconic:{n:"Polyconic",arg:null,scale:160,ratio:1.3},quincuncial:{n:"Quincuncial",arg:null,scale:160,ratio:1.3},rectangularPolyconic:{n:"Rectangular Polyconic",arg:0,scale:160,ratio:1.65},robinson:{n:"Robinson",arg:null,scale:160},sinusoidal:{n:"Sinusoidal",arg:null,scale:160,ratio:2},stereographic:{n:"Stereographic",arg:null,scale:500,ratio:1,clip:!0},times:{n:"Times",arg:null,scale:210,ratio:1.4},twoPointEquidistant:{n:"Two-Point Equidistant",arg:Math.PI/2,scale:320,ratio:1.15,clip:!0},vanDerGrinten:{n:"van Der Grinten",arg:null,scale:160,ratio:1},vanDerGrinten2:{n:"van Der Grinten II",arg:null,scale:160,ratio:1},vanDerGrinten3:{n:"van Der Grinten III",arg:null,scale:160,ratio:1},vanDerGrinten4:{n:"van Der Grinten IV",arg:null,scale:160,ratio:1.6},wagner4:{n:"Wagner IV",arg:null,scale:185},wagner6:{n:"Wagner VI",arg:null,scale:160},wagner7:{n:"Wagner VII",arg:null,scale:190,ratio:1.8},wiechel:{n:"Wiechel",arg:null,scale:360,ratio:1,clip:!0},winkel3:{n:"Winkel Tripel",arg:null,scale:196,ratio:1.7}};R.projections=function(){return ut};var pt={};pt.symbol=function(){function t(t){i[a()](t)}var e,a=d3.functor("circle"),n=d3.functor(64),r=d3.functor(Math.PI),o=(d3.functor("#fff"),d3.functor("")),i=(d3.functor([2,2]),{circle:function(t){var a=Math.sqrt(n()),r=a/2;return t.arc(e[0],e[1],r,0,2*Math.PI),r},square:function(t){var a=Math.sqrt(n()),r=a/1.7;return t.moveTo(e[0]-r,e[1]-r),t.lineTo(e[0]+r,e[1]-r),t.lineTo(e[0]+r,e[1]+r),t.lineTo(e[0]-r,e[1]+r),t.closePath(),r},diamond:function(t){var a=Math.sqrt(n()),r=a/1.5;return t.moveTo(e[0],e[1]-r),t.lineTo(e[0]+r,e[1]),t.lineTo(e[0],e[1]+r),t.lineTo(e[0]-r,e[1]),t.closePath(),r},triangle:function(t){var a=Math.sqrt(n()),r=a/Math.sqrt(3);return t.moveTo(e[0],e[1]-r),t.lineTo(e[0]+r,e[1]+r),t.lineTo(e[0]-r,e[1]+r),t.closePath(),r},ellipse:function(t){var a=Math.sqrt(n()),r=a/2;return t.save(),t.translate(e[0],e[1]),t.scale(1.6,.8),t.beginPath(),t.arc(0,0,r,0,2*Math.PI),t.closePath(),t.restore(),r},marker:function(t){var a=Math.sqrt(n()),r=a/2;return t.moveTo(e[0],e[1]-r),t.lineTo(e[0],e[1]+r),t.moveTo(e[0]-r,e[1]),t.lineTo(e[0]+r,e[1]),t.closePath(),r},"cross-circle":function(t){var a=Math.sqrt(n()),r=a/2;return t.moveTo(e[0],e[1]-a),t.lineTo(e[0],e[1]+a),t.moveTo(e[0]-a,e[1]),t.lineTo(e[0]+a,e[1]),t.stroke(),t.beginPath(),t.moveTo(e[0],e[1]),t.arc(e[0],e[1],r,0,2*Math.PI),t.closePath(),r},"stroke-circle":function(t){var a=Math.sqrt(n()),r=a/2;return t.moveTo(e[0],e[1]-a),t.lineTo(e[0],e[1]+a),t.stroke(),t.beginPath(),t.moveTo(e[0],e[1]),t.arc(e[0],e[1],r,0,2*Math.PI),t.closePath(),r},crescent:function(t){var a=Math.sqrt(n()),o=a/2,i=r(),s=.5*(1-Math.cos(i)),l=1.6*Math.abs(s-.5)+.01,c=i>Math.PI,h=Math.abs(s)>.5?c:!c;return t.save(),t.fillStyle="#557",t.moveTo(e[0],e[1]),t.arc(e[0],e[1],o,0,2*Math.PI),t.closePath(),t.fill(),t.fillStyle="#eee",t.beginPath(),t.moveTo(e[0],e[1]),t.arc(e[0],e[1],o,-Math.PI/2,Math.PI/2,c),t.scale(l,1),t.arc(e[0]/l,e[1],o,Math.PI/2,-Math.PI/2,h),t.closePath(),t.fill(),t.restore(),o}});return t.type=function(e){return arguments.length?(a=d3.functor(e),t):a},t.size=function(e){return arguments.length?(n=d3.functor(e),t):n},t.age=function(e){return arguments.length?(r=d3.functor(e),t):r},t.text=function(e){return arguments.length?(o=d3.functor(e),t):o},t.position=function(a){if(arguments.length)return e=a,t},t},R.Canvas=pt;var ft={sinh:function(t){return(Math.pow(Math.E,t)-Math.pow(Math.E,-t))/2},cosh:function(t){return(Math.pow(Math.E,t)+Math.pow(Math.E,-t))/2},tanh:function(t){return 2/(1+Math.exp(-2*t))-1},asinh:function(t){return Math.log(t+Math.sqrt(t*t+1))},acosh:function(t){return Math.log(t+Math.sqrt(t*t-1))},normalize0:function(t){return(t+3*Math.PI)%(2*Math.PI)-Math.PI},normalize:function(t){return(t+2*Math.PI)%(2*Math.PI)},cartesian:function(t){var e=t[0],a=ot-t[1],n=t[2];return{x:n*Math.sin(a)*Math.cos(e),y:n*Math.sin(a)*Math.sin(e),z:n*Math.cos(a)}},spherical:function(t){var e=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z),a=Math.atan(t.y/t.x),n=Math.acos(t.z/e);return[a/it,n/it,e]},distance:function(t,e){return Math.acos(Math.sin(t[1])*Math.sin(e[1])+Math.cos(t[1])*Math.cos(e[1])*Math.cos(t[0]-e[0]))}},mt={"stars-show":["stars-limit","stars-colors","stars-style-fill","stars-names","stars-size","stars-exponent"],"stars-names":["stars-proper","stars-desig","stars-namelimit"],"stars-proper":["stars-propernamelimit"],"dsos-show":["dsos-limit","dsos-colors","dsos-style-fill","dsos-names","dsos-size","dsos-exponent"],"dsos-names":["dsos-desig","dsos-namelimit"],"mw-show":["mw-style-opacity","mw-style-fill"],"constellations-names":["constellations-desig"]},gt={sol:.0002959122082855911,mer:0x95955473dbc3,ven:0x89d9374048629,ter:0xa923c08a47948,lun:36599199229256,mar:319711652803400,cer:467549107200,ves:129071530155,jup:0xd2088431b2a1400,sat:0x3ee37dea29c61e0,ura:0x99ad2c257ccb88,nep:0xb54f909dc5b7b8,plu:7327611364884,eri:827117568e4},Mt={sol:"☉",mer:"☿",ven:"♀",ter:"⊕",lun:"●",mar:"♂",cer:"⚳",ves:"⚶",jup:"♃",sat:"♄",ura:"♅",nep:"♆",plu:"♇",eri:"⚪"},yt=23.43928*it,vt=Math.sin(yt),bt=Math.cos(yt),wt=["a","e","i","w","M","L","W","N","n","ep","ref","lecl","becl","Tilt"],kt=function(){function t(e){return w(e),"sol"===p?(v.x=0,v.y=0,v.z=0,t):(k(),t)}function e(t,e){for(var a=e>1?t*t:-t*t,n=e*a*t/6,r=(1-e)*t-n,o=4;Math.abs(n)>1e-15;)n*=a/(o*(o+1)),r-=n,o+=2;return r}function n(){var t,a,n,r,o=v.e,i=v.M,s=1e-8,l=0,c=1.9,h=!1,d=0;if(!i)return 0;if(o<1&&((i<-Math.PI||i>Math.PI)&&(r=ft.normalize0(i),l=i-r,i=r),o<.9)){t=Math.atan2(Math.sin(i),Math.cos(i)-o);do{a=(t-o*Math.sin(t)-i)/(1-o*Math.cos(t)),t-=a}while(Math.abs(a)>s);return t}if(i<0&&(i=-i,h=!0),t=i,s*=Math.abs(1-o),s<1e-15&&(s=1e-15),(o>.8&&i<Math.PI/3||o>1)&&(n=i/Math.abs(1-o),n*n>6*Math.abs(1-o)&&(n=i<Math.PI?Math.pow(6*i,1/3):ft.asinh(i/o)),t=n),o>1&&i>4&&(t=Math.log(i)),o<1)for(;Math.abs(c)>s;)a=d++>8?e(t,o)-i:t-o*Math.sin(t)-i,c=-a/(1-o*Math.cos(t)),t+=c;else for(;Math.abs(c)>s;)a=d++>7?-e(t,o)-i:o*ft.sinh(t)-t-i,c=-a/(o*ft.cosh(t)-1),t+=c;return h?l-t:l+t}function r(){var t,e,a,r,o;1===v.e?(o=v.jd0-v.T,r=v.w0*o*.5,e=Math.pow(r+Math.sqrt(r*r+1),1/3),v.v=2*Math.atan(e-1/e)):(v.E=n(),v.e>1?(t=v.e-ft.cosh(v.E),e=ft.sinh(v.E)):(t=Math.cos(v.E)-v.e,e=Math.sin(v.E)),e*=Math.sqrt(Math.abs(1-v.e*v.e)),v.v=Math.atan2(e,t)),a=v.q*(1+v.e),v.r=a/(1+v.e*Math.cos(v.v))}function o(){v.hasOwnProperty("w")||(v.w=v.W-v.N),v.hasOwnProperty("M")||(v.M=v.L-v.W),v.e<1&&(v.M=ft.normalize0(v.M)),v.P=rt*Math.sqrt(Math.pow(v.a,3)/g)/365.25,v.T=v.jd0-v.M/ot/v.P,1!==v.e?(v.q=v.a*(1-v.e),v.t0=v.a*Math.sqrt(Math.abs(v.a)/g)):(v.w0=3/Math.sqrt(2)/(v.q*Math.sqrt(v.q/g)),v.a=0,v.t0=0),v.am=Math.sqrt(g*v.q*(1+v.e))}function i(){if(!v.ref||"ecl"===v.ref)return v.tx=v.x,v.ty=v.y,void(v.tz=v.z);var t=v.lecl,e=Math.PI/2-v.becl;a(v,[0,e,-t]);var n=ft.cartesian([v.tl,v.tb,v.r]);v.tx=n.x,v.ty=n.y,v.tz=n.z}function s(t){yt=(23.439292-.0130042*v.cy-1.667e-7*v.cy*v.cy+5.028e-7*v.cy*v.cy*v.cy)*it,vt=Math.sin(yt),bt=Math.cos(yt);var e="lun"===p?{x:0,y:0,z:0}:{x:t.x,y:t.y,z:t.z};v.xeq=v.x-e.x,v.yeq=(v.y-e.y)*bt-(v.z-e.z)*vt,v.zeq=(v.y-e.y)*vt+(v.z-e.z)*bt,v.ra=ft.normalize(Math.atan2(v.yeq,v.xeq)),v.dec=Math.atan2(v.zeq,Math.sqrt(v.xeq*v.xeq+v.yeq*v.yeq)),"lun"===p&&(v=u(v,t)),v.pos=[v.ra/it,v.dec/it],v.rt=Math.sqrt(v.xeq*v.xeq+v.yeq*v.yeq+v.zeq*v.zeq)}function l(){var t=v.v+v.w;return v.x=v.r*(Math.cos(v.N)*Math.cos(t)-Math.sin(v.N)*Math.sin(t)*Math.cos(v.i)),v.y=v.r*(Math.sin(v.N)*Math.cos(t)+Math.cos(v.N)*Math.sin(t)*Math.cos(v.i)),v.z=v.r*(Math.sin(t)*Math.sin(v.i)),v}function c(){var t=Math.atan2(v.y,v.x),e=Math.atan2(v.z,Math.sqrt(v.x*v.x+v.y*v.y));return v.l=ft.normalize(t),v.b=e,v}function h(t){var e=t.getUTCFullYear(),a=t.getUTCMonth()+1,n=t.getUTCDate(),r=(t.getUTCHours()-12+t.getUTCMinutes()/60+t.getUTCSeconds()/3600)/24;if(e<-4799)return-1;var o=Math.floor((14-a)/12),i=e+4800-o,s=a+12*o-3;return n+Math.floor((153*s+2)/5)+365*i+Math.floor(i/4)-Math.floor(i/100)+Math.floor(i/400)-32045+r}function d(t){if(void 0!==xt)return xt.elements(t)}function u(t,e){if(c(),void 0!==xt)return xt.corr(t,e)}var p,f,m,g=gt.sol,M="sol",y={},v={},w=function(t){var e;v=[],t&&(e=t instanceof Date?new Date(t.valueOf()):q(t)),e||(e=new Date),v.jd=h(e),e=q(y.ep),e||(e=q("2000-01-01")),v.jd0=h(e),v.d=v.jd-v.jd0,v.cy=v.d/36525},k=function(){var t;if("lun"===p){if(!(v=d(v)))return}else{for(var e=0;e<wt.length;e++)t=wt[e],b(y,t)&&(b(y,"d"+t)?v[t]=y[t]+y["d"+t]*v.cy:b(y,t)&&(v[t]=y[t]));b(v,"M")&&!b(v,"dM")&&b(v,"n")&&(v.M+=v.n*v.d)}o(),r(),l()};return t.cartesian=function(){return v},t.spherical=function(){return c(),v},t.equatorial=function(t){return s(t),v},t.transpose=function(){return i(),v},t.elements=function(e){var a;if(!arguments.length)return y;for(var n=0;n<wt.length;n++)a=wt[n],b(e,a)&&(y[a]=e[a],"a"===a||"e"===a?y[a]*=1:"ref"!==a&&"ep"!==a&&(y[a]*=it),b(e,"d"+a)&&(a="d"+a,y[a]=e[a],y[a]*="da"===a||"de"===a?1:it));return t},t.parentBody=function(e){return arguments.length?(M=e,g=gt[M],t):M},t.id=function(e){return arguments.length?(p=e,m=Mt[e],t):p},t.Name=function(e){return arguments.length?(f=e,t):f},t.symbol=function(e){return arguments.length?(m=Mt[e],t):m},t},xt={elements:function(t){
var e=(t.jd-2451545)/36525,a=e*e,n=e*a,r=e*n,o=1e-4*a,i=1e-6*n,s=1e-8*r,l=3400.4*Math.cos(it*(235.7004+890534.223*e-32.601*o+3.664*i-1.769*s))-635.6*Math.cos(it*(100.737+413335.3554*e-122.571*o-10.684*i+5.028*s))-235.6*Math.cos(it*(134.9634+477198.8676*e+89.97*o+14.348*i-6.797*s))+218.1*Math.cos(it*(238.1713+854535.1727*e-31.065*o+3.623*i-1.769*s))+181*Math.cos(it*(10.6638+1367733.0907*e+57.37*o+18.011*i-8.566*s))-39.9*Math.cos(it*(103.2079+377336.3051*e-121.035*o-10.724*i+5.028*s))-38.4*Math.cos(it*(233.2295+926533.2733*e-34.136*o+3.705*i-1.769*s))+33.8*Math.cos(it*(336.4374+1303869.5784*e-155.171*o-7.02*i+3.259*s))+28.8*Math.cos(it*(111.4008+1781068.4461*e-65.201*o+7.328*i-3.538*s))+12.6*Math.cos(it*(13.1347+1331734.0404*e+58.906*o+17.971*i-8.566*s))+11.4*Math.cos(it*(186.5442+966404.0351*e-68.058*o-.567*i+.232*s))-11.1*Math.cos(it*(222.5657-441199.8173*e-91.506*o-14.307*i+6.797*s))-10.2*Math.cos(it*(269.9268+954397.7353*e+179.941*o+28.695*i-13.594*s))+9.7*Math.cos(it*(145.6272+1844931.9583*e+147.34*o+32.359*i-15.363*s))+9.6*Math.cos(it*(240.6422+818536.1225*e-29.529*o+3.582*i-1.769*s))+8*Math.cos(it*(297.8502+445267.1115*e-16.3*o+1.832*i-.884*s))-6.2*Math.cos(it*(132.4925+513197.9179*e+88.434*o+14.388*i-6.797*s))+6*Math.cos(it*(173.5506+1335801.3346*e-48.901*o+5.496*i-2.653*s))+3.7*Math.cos(it*(113.8717+1745069.3958*e-63.665*o+7.287*i-3.538*s))+3.6*Math.cos(it*(338.9083+1267870.5281*e-153.636*o-7.061*i+3.259*s))+3.2*Math.cos(it*(246.3642+2258267.3137*e+24.769*o+21.675*i-10.335*s))-3*Math.cos(it*(8.1929+1403732.141*e+55.834*o+18.052*i-8.566*s))+2.3*Math.cos(it*(98.2661+449334.4057*e-124.107*o-10.643*i+5.028*s))-2.2*Math.cos(it*(357.5291+35999.0503*e-1.536*o+.041*i+0*s))-2*Math.cos(it*(38.5872+858602.4669*e-138.871*o-8.852*i+4.144*s))-1.8*Math.cos(it*(105.6788+341337.2548*e-119.499*o-10.765*i+5.028*s))-1.7*Math.cos(it*(201.474+826670.7108*e-245.142*o-21.367*i+10.057*s))+1.6*Math.cos(it*(184.1196+401329.0556*e+125.428*o+18.579*i-8.798*s))-1.4*Math.cos(it*(308.4192-489205.1674*e+158.029*o+14.915*i-7.029*s))+1.3*Math.cos(it*(325.7736-63863.5122*e-212.541*o-25.031*i+11.826*s)),c=-.55*Math.cos(it*(238.2+854535.2*e))+.1*Math.cos(it*(103.2+377336.3*e))+.1*Math.cos(it*(233.2+926533.3*e)),h=383397.6+l+c*e,d=.014217*Math.cos(it*(100.737+413335.3554*e-122.571*o-10.684*i+5.028*s))+.008551*Math.cos(it*(325.7736-63863.5122*e-212.541*o-25.031*i+11.826*s))-.001383*Math.cos(it*(134.9634+477198.8676*e+89.97*o+14.348*i-6.797*s))+.001353*Math.cos(it*(10.6638+1367733.0907*e+57.37*o+18.011*i-8.566*s))-.001146*Math.cos(it*(66.5106+349471.8432*e-335.112*o-35.715*i+16.854*s))-915e-6*Math.cos(it*(201.474+826670.7108*e-245.142*o-21.367*i+10.057*s))+869e-6*Math.cos(it*(103.2079+377336.3051*e-121.035*o-10.724*i+5.028*s))-628e-6*Math.cos(it*(235.7004+890534.223*e-32.601*o+3.664*i-1.769*s))-393e-6*Math.cos(it*(291.5472-127727.0245*e-425.082*o-50.062*i+23.651*s))+284e-6*Math.cos(it*(328.2445-99862.5625*e-211.005*o-25.072*i+11.826*s))-278e-6*Math.cos(it*(162.8868-31931.7561*e-106.271*o-12.516*i+5.913*s))-24e-5*Math.cos(it*(269.9268+954397.7353*e+179.941*o+28.695*i-13.594*s))+23e-5*Math.cos(it*(111.4008+1781068.4461*e-65.201*o+7.328*i-3.538*s))+229e-6*Math.cos(it*(167.2476+762807.1986*e-457.683*o-46.398*i+21.882*s))-202e-6*Math.cos(it*(83.3826-12006.2998*e+247.999*o+29.262*i-13.826*s))+19e-5*Math.cos(it*(190.8102-541062.3799*e-302.511*o-39.379*i+18.623*s))+177e-6*Math.cos(it*(357.5291+35999.0503*e-1.536*o+.041*i+0*s))+153e-6*Math.cos(it*(32.2842+285608.3309*e-547.653*o-60.746*i+28.679*s))-137e-6*Math.cos(it*(44.8902+1431596.6029*e+269.911*o+43.043*i-20.392*s))+122e-6*Math.cos(it*(145.6272+1844931.9583*e+147.34*o+32.359*i-15.363*s))+116e-6*Math.cos(it*(302.211+1240006.0662*e-367.713*o-32.051*i+15.085*s))-111e-6*Math.cos(it*(203.9449+790671.6605*e-243.606*o-21.408*i+10.057*s))-108e-6*Math.cos(it*(68.9815+313472.7929*e-333.576*o-35.756*i+16.854*s))+96e-6*Math.cos(it*(336.4374+1303869.5784*e-155.171*o-7.02*i+3.259*s))-9e-5*Math.cos(it*(98.2661+449334.4057*e-124.107*o-10.643*i+5.028*s))+9e-5*Math.cos(it*(13.1347+1331734.0404*e+58.906*o+17.971*i-8.566*s))+56e-6*Math.cos(it*(55.8468-1018261.2475*e-392.482*o-53.726*i+25.42*s))-56e-6*Math.cos(it*(238.1713+854535.1727*e-31.065*o+3.623*i-1.769*s))+52e-6*Math.cos(it*(308.4192-489205.1674*e+158.029*o+14.915*i-7.029*s))-5e-5*Math.cos(it*(133.0212+698943.6863*e-670.224*o-71.429*i+33.708*s))-49e-6*Math.cos(it*(267.9846+1176142.554*e-580.254*o-57.082*i+26.911*s))-49e-6*Math.cos(it*(184.1196+401329.0556*e+125.428*o+18.579*i-8.798*s))-45e-6*Math.cos(it*(49.1562-75869.812*e+35.458*o+4.231*i-2.001*s))+44e-6*Math.cos(it*(257.3208-191590.5367*e-637.623*o-75.093*i+35.477*s))+42e-6*Math.cos(it*(105.6788+341337.2548*e-119.499*o-10.765*i+5.028*s))+42e-6*Math.cos(it*(160.4159+4067.2942*e-107.806*o-12.475*i+5.913*s))+4e-5*Math.cos(it*(246.3642+2258267.3137*e+24.769*o+21.675*i-10.335*s))-4e-5*Math.cos(it*(156.5838-604925.8921*e-515.053*o-64.41*i+30.448*s))+36e-6*Math.cos(it*(169.7185+726808.1483*e-456.147*o-46.439*i+21.882*s))+29e-6*Math.cos(it*(113.8717+1745069.3958*e-63.665*o+7.287*i-3.538*s))-29e-6*Math.cos(it*(297.8502+445267.1115*e-16.3*o+1.832*i-.884*s))-28e-6*Math.cos(it*(294.0181-163726.0747*e-423.546*o-50.103*i+23.651*s))+27e-6*Math.cos(it*(263.6238+381403.5993*e-228.841*o-23.199*i+10.941*s))-26e-6*Math.cos(it*(358.0578+221744.8187*e-760.194*o-85.777*i+40.505*s))-26e-6*Math.cos(it*(8.1929+1403732.141*e+55.834*o+18.052*i-8.566*s)),u=-.0022*Math.cos(it*(103.2+377336.3*e)),p=.055544+d+.001*e*u,f=.0011776*Math.cos(it*(49.1562-75869.812*e+35.458*o+4.231*i-2.001*s))-971e-7*Math.cos(it*(235.7004+890534.223*e-32.601*o+3.664*i-1.769*s))+908e-7*Math.cos(it*(186.5442+966404.0351*e-68.058*o-.567*i+.232*s))+623e-7*Math.cos(it*(83.3826-12006.2998*e+247.999*o+29.262*i-13.826*s))+483e-7*Math.cos(it*(51.6271-111868.8623*e+36.994*o+4.19*i-2.001*s))+348e-7*Math.cos(it*(100.737+413335.3554*e-122.571*o-10.684*i+5.028*s))-316e-7*Math.cos(it*(308.4192-489205.1674*e+158.029*o+14.915*i-7.029*s))-253e-7*Math.cos(it*(46.6853-39870.7617*e+33.922*o+4.272*i-2.001*s))-141e-7*Math.cos(it*(274.1928-553068.6797*e-54.513*o-10.116*i+4.797*s))+127e-7*Math.cos(it*(325.7736-63863.5122*e-212.541*o-25.031*i+11.826*s))+117e-7*Math.cos(it*(184.1196+401329.0556*e+125.428*o+18.579*i-8.798*s))-78e-7*Math.cos(it*(98.3124-151739.624*e+70.916*o+8.462*i-4.001*s))-63e-7*Math.cos(it*(238.1713+854535.1727*e-31.065*o+3.623*i-1.769*s))+63e-7*Math.cos(it*(134.9634+477198.8676*e+89.97*o+14.348*i-6.797*s))+36e-7*Math.cos(it*(321.5076+1443602.9027*e+21.912*o+13.78*i-6.566*s))-35e-7*Math.cos(it*(10.6638+1367733.0907*e+57.37*o+18.011*i-8.566*s))+24e-7*Math.cos(it*(149.8932+337465.5434*e-87.113*o-6.453*i+3.028*s))+24e-7*Math.cos(it*(170.9849-930404.9848*e+66.523*o+.608*i-.232*s)),m=-.0203*Math.cos(it*(125-1934.1*e))+.0034*Math.cos(it*(220.2-1935.5*e)),g=.0449858+f+.001*m,M=-15.448*Math.sin(it*(100.737+413335.3554*e-122.571*o-10.684*i+5.028*s))-9.642*Math.sin(it*(325.7736-63863.5122*e-212.541*o-25.031*i+11.826*s))-2.721*Math.sin(it*(134.9634+477198.8676*e+89.97*o+14.348*i-6.797*s))+2.607*Math.sin(it*(66.5106+349471.8432*e-335.112*o-35.715*i+16.854*s))+2.085*Math.sin(it*(201.474+826670.7108*e-245.142*o-21.367*i+10.057*s))+1.477*Math.sin(it*(10.6638+1367733.0907*e+57.37*o+18.011*i-8.566*s))+.968*Math.sin(it*(291.5472-127727.0245*e-425.082*o-50.062*i+23.651*s))-.949*Math.sin(it*(103.2079+377336.3051*e-121.035*o-10.724*i+5.028*s))-.703*Math.sin(it*(167.2476+762807.1986*e-457.683*o-46.398*i+21.882*s))-.66*Math.sin(it*(235.7004+890534.223*e-32.601*o+3.664*i-1.769*s))-.577*Math.sin(it*(190.8102-541062.3799*e-302.511*o-39.379*i+18.623*s))-.524*Math.sin(it*(269.9268+954397.7353*e+179.941*o+28.695*i-13.594*s))-.482*Math.sin(it*(32.2842+285608.3309*e-547.653*o-60.746*i+28.679*s))+.452*Math.sin(it*(357.5291+35999.0503*e-1.536*o+.041*i+0*s))-.381*Math.sin(it*(302.211+1240006.0662*e-367.713*o-32.051*i+15.085*s))-.342*Math.sin(it*(328.2445-99862.5625*e-211.005*o-25.072*i+11.826*s))-.312*Math.sin(it*(44.8902+1431596.6029*e+269.911*o+43.043*i-20.392*s))+.282*Math.sin(it*(162.8868-31931.7561*e-106.271*o-12.516*i+5.913*s))+.255*Math.sin(it*(203.9449+790671.6605*e-243.606*o-21.408*i+10.057*s))+.252*Math.sin(it*(68.9815+313472.7929*e-333.576*o-35.756*i+16.854*s))-.211*Math.sin(it*(83.3826-12006.2998*e+247.999*o+29.262*i-13.826*s))+.193*Math.sin(it*(267.9846+1176142.554*e-580.254*o-57.082*i+26.911*s))+.191*Math.sin(it*(133.0212+698943.6863*e-670.224*o-71.429*i+33.708*s))-.184*Math.sin(it*(55.8468-1018261.2475*e-392.482*o-53.726*i+25.42*s))+.182*Math.sin(it*(145.6272+1844931.9583*e+147.34*o+32.359*i-15.363*s))-.158*Math.sin(it*(257.3208-191590.5367*e-637.623*o-75.093*i+35.477*s))+.148*Math.sin(it*(156.5838-604925.8921*e-515.053*o-64.41*i+30.448*s))-.111*Math.sin(it*(169.7185+726808.1483*e-456.147*o-46.439*i+21.882*s))+.101*Math.sin(it*(13.1347+1331734.0404*e+58.906*o+17.971*i-8.566*s))+.1*Math.sin(it*(358.0578+221744.8187*e-760.194*o-85.777*i+40.505*s))+.087*Math.sin(it*(98.2661+449334.4057*e-124.107*o-10.643*i+5.028*s))+.08*Math.sin(it*(42.948+1653341.4216*e-490.283*o-42.734*i+20.113*s))+.08*Math.sin(it*(222.5657-441199.8173*e-91.506*o-14.307*i+6.797*s))+.077*Math.sin(it*(294.0181-163726.0747*e-423.546*o-50.103*i+23.651*s))-.073*Math.sin(it*(280.8834-1495460.1151*e-482.452*o-68.074*i+32.217*s))-.071*Math.sin(it*(304.6819+1204007.0159*e-366.177*o-32.092*i+15.085*s))-.069*Math.sin(it*(233.7582+1112279.0417*e-792.795*o-82.113*i+38.736*s))-.067*Math.sin(it*(34.7551+249609.2807*e-546.117*o-60.787*i+28.679*s))-.067*Math.sin(it*(263.6238+381403.5993*e-228.841*o-23.199*i+10.941*s))+.055*Math.sin(it*(21.6203-1082124.7597*e-605.023*o-78.757*i+37.246*s))+.055*Math.sin(it*(308.4192-489205.1674*e+158.029*o+14.915*i-7.029*s))-.054*Math.sin(it*(8.7216+1589477.9094*e-702.824*o-67.766*i+31.939*s))-.052*Math.sin(it*(179.8536+1908795.4705*e+359.881*o+57.39*i-27.189*s))-.05*Math.sin(it*(98.7948+635080.1741*e-882.765*o-96.461*i+45.533*s))-.049*Math.sin(it*(128.6604-95795.2683*e-318.812*o-37.547*i+17.738*s))-.047*Math.sin(it*(17.3544+425341.6552*e-370.57*o-39.946*i+18.854*s))-.044*Math.sin(it*(160.4159+4067.2942*e-107.806*o-12.475*i+5.913*s))-.043*Math.sin(it*(238.1713+854535.1727*e-31.065*o+3.623*i-1.769*s))+.042*Math.sin(it*(270.4555+1140143.5037*e-578.718*o-57.123*i+26.911*s))-.042*Math.sin(it*(132.4925+513197.9179*e+88.434*o+14.388*i-6.797*s))-.041*Math.sin(it*(122.3573-668789.4043*e-727.594*o-89.441*i+42.274*s))-.04*Math.sin(it*(105.6788+341337.2548*e-119.499*o-10.765*i+5.028*s))+.038*Math.sin(it*(135.4921+662944.6361*e-668.688*o-71.47*i+33.708*s))-.037*Math.sin(it*(242.391-51857.2124*e-460.54*o-54.293*i+25.652*s))+.036*Math.sin(it*(336.4374+1303869.5784*e-155.171*o-7.02*i+3.259*s))+.035*Math.sin(it*(223.0943-255454.0489*e-850.164*o-100.124*i+47.302*s))-.034*Math.sin(it*(193.2811-577061.4302*e-300.976*o-39.419*i+18.623*s))+.031*Math.sin(it*(87.6023-918398.685*e-181.476*o-28.654*i+13.594*s)),y=2.4*Math.sin(it*(103.2+377336.3*e)),v=83.353+4069.0137*e-103.238*o-12.492*i+5.263*s+M+.001*e*y,b=-1.4979*Math.sin(it*(49.1562-75869.812*e+35.458*o+4.231*i-2.001*s))-.15*Math.sin(it*(357.5291+35999.0503*e-1.536*o+.041*i+0*s))-.1226*Math.sin(it*(235.7004+890534.223*e-32.601*o+3.664*i-1.769*s))+.1176*Math.sin(it*(186.5442+966404.0351*e-68.058*o-.567*i+.232*s))-.0801*Math.sin(it*(83.3826-12006.2998*e+247.999*o+29.262*i-13.826*s))-.0616*Math.sin(it*(51.6271-111868.8623*e+36.994*o+4.19*i-2.001*s))+.049*Math.sin(it*(100.737+413335.3554*e-122.571*o-10.684*i+5.028*s))+.0409*Math.sin(it*(308.4192-489205.1674*e+158.029*o+14.915*i-7.029*s))+.0327*Math.sin(it*(134.9634+477198.8676*e+89.97*o+14.348*i-6.797*s))+.0324*Math.sin(it*(46.6853-39870.7617*e+33.922*o+4.272*i-2.001*s))+.0196*Math.sin(it*(98.3124-151739.624*e+70.916*o+8.462*i-4.001*s))+.018*Math.sin(it*(274.1928-553068.6797*e-54.513*o-10.116*i+4.797*s))+.015*Math.sin(it*(325.7736-63863.5122*e-212.541*o-25.031*i+11.826*s))-.015*Math.sin(it*(184.1196+401329.0556*e+125.428*o+18.579*i-8.798*s))-.0078*Math.sin(it*(238.1713+854535.1727*e-31.065*o+3.623*i-1.769*s))-.0045*Math.sin(it*(10.6638+1367733.0907*e+57.37*o+18.011*i-8.566*s))+.0044*Math.sin(it*(321.5076+1443602.9027*e+21.912*o+13.78*i-6.566*s))-.0042*Math.sin(it*(162.8868-31931.7561*e-106.271*o-12.516*i+5.913*s))-.0031*Math.sin(it*(170.9849-930404.9848*e+66.523*o+.608*i-.232*s))+.0031*Math.sin(it*(103.2079+377336.3051*e-121.035*o-10.724*i+5.028*s))+.0029*Math.sin(it*(222.612-1042273.8471*e+103.516*o+4.798*i-2.232*s))+.0028*Math.sin(it*(184.0733+1002403.0853*e-69.594*o-.526*i+.232*s)),w=25.9*Math.sin(it*(125-1934.1*e))-4.3*Math.sin(it*(220.2-1935.5*e)),k=.38*Math.sin(it*(357.5+35999.1*e)),x=125.0446-1934.13618*e+20.762*o+2.139*i-1.65*s+b+.001*(w+k*e),z=-.92581*Math.sin(it*(235.7004+890534.223*e-32.601*o+3.664*i-1.769*s))+.33262*Math.sin(it*(100.737+413335.3554*e-122.571*o-10.684*i+5.028*s))-.18402*Math.sin(it*(357.5291+35999.0503*e-1.536*o+.041*i+0*s))+.11007*Math.sin(it*(134.9634+477198.8676*e+89.97*o+14.348*i-6.797*s))-.06055*Math.sin(it*(238.1713+854535.1727*e-31.065*o+3.623*i-1.769*s))+.04741*Math.sin(it*(325.7736-63863.5122*e-212.541*o-25.031*i+11.826*s))-.03086*Math.sin(it*(10.6638+1367733.0907*e+57.37*o+18.011*i-8.566*s))+.02184*Math.sin(it*(103.2079+377336.3051*e-121.035*o-10.724*i+5.028*s))+.01645*Math.sin(it*(49.1562-75869.812*e+35.458*o+4.231*i-2.001*s))+.01022*Math.sin(it*(233.2295+926533.2733*e-34.136*o+3.705*i-1.769*s))-.00756*Math.sin(it*(336.4374+1303869.5784*e-155.171*o-7.02*i+3.259*s))-.0053*Math.sin(it*(222.5657-441199.8173*e-91.506*o-14.307*i+6.797*s))-.00496*Math.sin(it*(162.8868-31931.7561*e-106.271*o-12.516*i+5.913*s))-.00472*Math.sin(it*(297.8502+445267.1115*e-16.3*o+1.832*i-.884*s))-.00271*Math.sin(it*(240.6422+818536.1225*e-29.529*o+3.582*i-1.769*s))+.00264*Math.sin(it*(132.4925+513197.9179*e+88.434*o+14.388*i-6.797*s))-.00254*Math.sin(it*(186.5442+966404.0351*e-68.058*o-.567*i+.232*s))+.00234*Math.sin(it*(269.9268+954397.7353*e+179.941*o+28.695*i-13.594*s))-.0022*Math.sin(it*(13.1347+1331734.0404*e+58.906*o+17.971*i-8.566*s))-.00202*Math.sin(it*(355.0582+71998.1006*e-3.072*o+.082*i+0*s))+.00167*Math.sin(it*(328.2445-99862.5625*e-211.005*o-25.072*i+11.826*s))-.00143*Math.sin(it*(173.5506+1335801.3346*e-48.901*o+5.496*i-2.653*s))-.00121*Math.sin(it*(98.2661+449334.4057*e-124.107*o-10.643*i+5.028*s))-.00116*Math.sin(it*(145.6272+1844931.9583*e+147.34*o+32.359*i-15.363*s))+.00102*Math.sin(it*(105.6788+341337.2548*e-119.499*o-10.765*i+5.028*s))-9e-4*Math.sin(it*(184.1196+401329.0556*e+125.428*o+18.579*i-8.798*s))-86e-5*Math.sin(it*(338.9083+1267870.5281*e-153.636*o-7.061*i+3.259*s))-78e-5*Math.sin(it*(111.4008+1781068.4461*e-65.201*o+7.328*i-3.538*s))+69e-5*Math.sin(it*(323.3027-27864.4619*e-214.077*o-24.99*i+11.826*s))+66e-5*Math.sin(it*(51.6271-111868.8623*e+36.994*o+4.19*i-2.001*s))+65e-5*Math.sin(it*(38.5872+858602.4669*e-138.871*o-8.852*i+4.144*s))-6e-4*Math.sin(it*(83.3826-12006.2998*e+247.999*o+29.262*i-13.826*s))+54e-5*Math.sin(it*(201.474+826670.7108*e-245.142*o-21.367*i+10.057*s))-52e-5*Math.sin(it*(308.4192-489205.1674*e+158.029*o+14.915*i-7.029*s))+48e-5*Math.sin(it*(8.1929+1403732.141*e+55.834*o+18.052*i-8.566*s))-41e-5*Math.sin(it*(46.6853-39870.7617*e+33.922*o+4.272*i-2.001*s))-33e-5*Math.sin(it*(274.1928-553068.6797*e-54.513*o-10.116*i+4.797*s))+3e-4*Math.sin(it*(160.4159+4067.2942*e-107.806*o-12.475*i+5.913*s)),P=3.96*Math.sin(it*(119.7+131.8*e))+1.96*Math.sin(it*(125-1934.1*e)),I=.463*Math.sin(it*(357.5+35999.1*e))+.152*Math.sin(it*(238.2+854535.2*e))-.071*Math.sin(it*(27.8+131.8*e))-.055*Math.sin(it*(103.2+377336.3*e))-.026*Math.sin(it*(233.2+926533.3*e)),q=14*Math.sin(it*(357.5+35999.1*e))+5*Math.sin(it*(238.2+854535.2*e)),S=218.31665+481267.88134*e-13.268*o+1.856*i-1.534*s+z+.001*(P+I*e+q*o);return t.a=h,t.e=p,t.i=2*Math.asin(g),t.w=ft.normalize(it*(v-x)),t.N=ft.normalize(it*x),t.M=ft.normalize(it*(S-v)),t},corr:function(t,e){var a=ft.normalize(e.M+Math.PI),n=ft.normalize(e.w+Math.PI),r=t.M+t.w,o=r+t.N-a-n,i=-.022234*Math.sin(t.M-2*o)+.011494*Math.sin(2*o)+-.003246*Math.sin(a)+-.001029*Math.sin(2*t.M-2*o)+-994838e-9*Math.sin(t.M-2*o+a)+925025e-9*Math.sin(t.M+2*o)+802851e-9*Math.sin(2*o-a)+715585e-9*Math.sin(t.M-a)+-610865e-9*Math.sin(o)+-541052e-9*Math.sin(t.M+a)+-261799e-9*Math.sin(2*r-2*o)+191986e-9*Math.sin(t.M-4*o);t.ra+=i;var s=-.003019*Math.sin(r-2*o)+-959931e-9*Math.sin(t.M-r-2*o)+-802851e-9*Math.sin(t.M+r-2*o)+575958e-9*Math.sin(r+2*o)+296706e-9*Math.sin(2*t.M+r);return t.dec+=s,t.age=ft.normalize(t.l-e.l+Math.PI),t.phase=.5*(1-Math.cos(t.age)),t}},zt=function(t,e){function a(){var t=g("mon").value,e=g("yr").value,a=new Date(e,t,1),n=d3.select("#cal"),r=new Date;e=parseInt(e),t=parseInt(t),a.setDate(a.getDate()-a.getDay());for(var o=n.node();o.firstChild;)o.removeChild(o.firstChild);for(var i=0;i<7;i++)n.append("div").classed({date:!0,weekday:!0}).html(f[i]);for(i=0;i<42;i++){var s=a.getMonth(),l=a.getDay(),c=m(a);n.append("div").classed({date:!0,grey:s!==t,weekend:s===t&&(0===l||6===l),today:0===I(a,r),selected:0===I(a,d)}).attr("id",c).on("click",h).html(a.getDate().toString()),a.setDate(a.getDate()+1)}}function n(){var t=d3.select("select#yr"),e=d.getFullYear(),a=0,n=o(d);t.selectAll("*").remove(),t.selectAll("option").data(n).enter().append("option").text(function(t,n){return t===e&&(a=n),t.toString()}),t.property("selectedIndex",a)}function r(t){v.append("div").attr("id",t).on("click",function(){var e=g("mon"),n=g("yr");"left"===t?0===e.selectedIndex?(e.selectedIndex=11,n.selectedIndex--):e.selectedIndex--:11===e.selectedIndex?(e.selectedIndex=0,n.selectedIndex++):e.selectedIndex++,a()})}function o(t){for(var e=i(t.getFullYear()),a=[],n=e[0];n<=e[1];n++)a.push(n);return a}function i(t){return!y||y.length<1?[t-10,t+10]:1===y.length&&w(y[0])?y[0]>=100?[y[0]-10,y[0]+10]:[t-y[0],t+y[0]]:2===y.length&&w(y[0])&&w(y[1])?y[1]>=100?[y[0],y[1]]:[y[0]-y[1],y[0]+y[1]]:[t-10,t+10]}function s(t,e){for(var a=g(t),n=0;n<a.childNodes.length;n++)if(a.childNodes[n].value==e){a.selectedIndex=n;break}}function l(t){t&&d.setTime(t.valueOf()),s("yr",d.getFullYear()),s("mon",d.getMonth()),a(),g("hr").value=d.getHours(),g("min").value=d.getMinutes(),g("sec").value=d.getSeconds()}function c(){d3.select("#celestial-date").style("opacity",0),d3.select("#error").style({top:"-9999px",left:"-9999px",opacity:0}),d3.select("#datepick").classed("active",!1),setTimeout(function(){g("celestial-date").style.top=M(-9999)},600)}function h(){var t=g("hr").value,a=g("min").value,r=g("sec").value,o=g("tz").value;this.id&&-1!==this.id.search(/^\d/)&&(d=m.parse(this.id)),n(),d.setHours(t,a,r),l(),e(d,o)}var d=new Date,u=(d3.time.format("%Z"),[{"−12:00":720},{"−11:00":660},{"−10:00":600},{"−09:30":570},{"−09:00":540},{"−08:00":480},{"−07:00":420},{"−06:00":360},{"−05:00":300},{"−04:30":270},{"−04:00":240},{"−03:30":210},{"−03:00":180},{"−02:00":120},{"−01:00":60},{"±00:00":0},{"+01:00":-60},{"+02:00":-120},{"+03:00":-180},{"+03:30":-210},{"+04:00":-240},{"+04:30":-270},{"+05:00":-300},{"+05:30":-330},{"+05:45":-345},{"+06:00":-360},{"+06:30":-390},{"+07:00":-420},{"+08:00":-480},{"+08:30":-510},{"+08:45":-525},{"+09:00":-540},{"+09:30":-570},{"+10:00":-600},{"+10:30":-630},{"+11:00":-660},{"+12:00":-720},{"+12:45":-765},{"+13:00":-780},{"+14:00":-840}]),p=["January","February","March","April","May","June","July","August","September","October","November","December"],f=["Su","M","Tu","W","Th","F","Sa"],m=(o(d),d3.time.format("%Y-%m-%d")),y=t.daterange||[],v=d3.select("#celestial-form").append("div").attr("id","celestial-date");r("left"),function(){var t=v.append("select").attr("title","Month").attr("id","mon").on("change",a),e=0,n=d.getMonth();t.selectAll("option").data(p).enter().append("option").attr("value",function(t,a){return a===n&&(e=a),a}).text(function(t){return t}),t.property("selectedIndex",e)}(),function(){v.append("select").attr("title","Year").attr("id","yr").on("change",a),n()}(),r("right");v.append("div").attr("id","cal");a(),function(){v.append("input").attr("type","number").attr("id","hr").attr("title","Hours").attr("max","24").attr("min","-1").attr("step","1").attr("value",d.getHours()).on("change",function(){!0===C(this)&&h()}),v.append("input").attr("type","number").attr("id","min").attr("title","Minutes").attr("max","60").attr("min","-1").attr("step","1").attr("value",d.getMinutes()).on("change",function(){!0===C(this)&&h()}),v.append("input").attr("type","number").attr("id","sec").attr("title","Seconds").attr("max","60").attr("min","-1").attr("step","1").attr("value",d.getSeconds()).on("change",function(){!0===C(this)&&h()})}(),function(){var t=v.append("select").attr("title","Time zone offset from UTC").attr("id","tz").on("change",h),e=15,a=d.getTimezoneOffset();t.selectAll("option").data(u).enter().append("option").attr("value",function(t,n){var r=Object.keys(t)[0];return t[r]===a&&(e=n),t[r]}).text(function(t){return Object.keys(t)[0]}),t.property("selectedIndex",e)}(),this.show=function(t){var e=g("celestial-date"),a=g("datepick"),n=a.offsetLeft+a.offsetWidth-e.offsetWidth,r=a.offsetTop-e.offsetHeight-1;-9999===e.offsetTop?(d.setTime(t.valueOf()),l(),d3.select("#celestial-date").style({top:M(r),left:M(n),opacity:1}),d3.select("#datepick").classed("active",!0)):c()},this.isVisible=function(){return!0===d3.select("#datepick").classed("active")},this.hide=function(){c()}};!function(){function t(t,e,a){var n=t.translate(),r=Math.atan2(e[1]-n[1],e[0]-n[0])-Math.atan2(a[1]-n[1],a[0]-n[0]);return[Math.cos(r/2),0,0,Math.sin(r/2)]}function e(t,e){var a=t.invert(e);return a&&isFinite(a[0])&&isFinite(a[1])&&s(a)}function a(t){var e=.5*t[0]*d,a=.5*t[1]*d,n=.5*t[2]*d,r=Math.sin(e),o=Math.cos(e),i=Math.sin(a),s=Math.cos(a),l=Math.sin(n),c=Math.cos(n);return[o*s*c+r*i*l,r*s*c-o*i*l,o*i*c+r*s*l,o*s*l-r*i*c]}function n(t,e){var a=t[0],n=t[1],r=t[2],o=t[3],i=e[0],s=e[1],l=e[2],c=e[3];return[a*i-n*s-r*l-o*c,a*s+n*i+r*c-o*l,a*l-n*c+r*i+o*s,a*c+n*l-r*s+o*i]}function r(t,e){if(t&&e){var a=c(t,e),n=Math.sqrt(l(a,a)),r=.5*Math.acos(Math.max(-1,Math.min(1,l(t,e)))),o=Math.sin(r)/n;return n&&[Math.cos(r),a[2]*o,-a[1]*o,a[0]*o]}}function o(t,e){var a=Math.max(-1,Math.min(1,l(t,e))),n=a<0?-1:1,r=Math.acos(n*a),o=Math.sin(r);return o?function(a){var i=n*Math.sin((1-a)*r)/o,s=Math.sin(a*r)/o;return[t[0]*i+e[0]*s,t[1]*i+e[1]*s,t[2]*i+e[2]*s,t[3]*i+e[3]*s]}:function(){return t}}function i(t){return[Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),1-2*(t[1]*t[1]+t[2]*t[2]))*u,Math.asin(Math.max(-1,Math.min(1,2*(t[0]*t[2]-t[3]*t[1]))))*u,Math.atan2(2*(t[0]*t[3]+t[1]*t[2]),1-2*(t[2]*t[2]+t[3]*t[3]))*u]}function s(t){var e=t[0]*d,a=t[1]*d,n=Math.cos(a);return[n*Math.cos(e),n*Math.sin(e),Math.sin(a)]}function l(t,e){for(var a=0,n=t.length,r=0;a<n;++a)r+=t[a]*e[a];return r}function c(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function h(t){for(var e=0,a=arguments.length,n=[];++e<a;)n.push(arguments[e]);var r=d3.dispatch.apply(null,n);return r.of=function(e,a){return function(n){try{var o=n.sourceEvent=d3.event;n.target=t,d3.event=n,r[n.type].apply(e,a)}finally{d3.event=o}}},r}var d=Math.PI/180,u=180/Math.PI;d3.geo.zoom=function(){function l(t){m++||t({type:"zoomstart"})}function c(t){t({type:"zoom"})}function d(t){--m||t({type:"zoomend"})}var u,p,f,m=0,g=h(M,"zoomstart","zoom","zoomend"),M=d3.behavior.zoom().on("zoomstart",function(){var o=d3.mouse(this),s=a(u.rotate()),h=e(u,o);h&&(f=h),y.call(M,"zoom",function(){u.scale(v.k=d3.event.scale);var a=d3.mouse(this),l=r(f,e(u,a));u.rotate(v.r=i(s=l?n(s,l):n(t(u,o,a),s))),o=a,c(g.of(this,arguments))}),l(g.of(this,arguments))}).on("zoomend",function(){y.call(M,"zoom",null),d(g.of(this,arguments))}),y=M.on,v={r:[0,0,0],k:1};return M.rotateTo=function(t){var e=r(s(t),s([-v.r[0],-v.r[1]]));return i(n(a(v.r),e))},M.projection=function(t){return arguments.length?(u=t,v={r:u.rotate(),k:u.scale()},M.scale(v.k)):u},M.duration=function(t){return arguments.length?(p=t,M):p},M.event=function(t){t.each(function(){var t=d3.select(this),e=g.of(this,arguments),n=v,r=d3.transition(t);if(r!==t){r.each("start.zoom",function(){this.__chart__&&(v=this.__chart__,v.hasOwnProperty("r")||(v.r=u.rotate())),u.rotate(v.r).scale(v.k),l(e)}).tween("zoom:zoom",function(){var t=M.size()[0],s=o(a(v.r),a(n.r)),l=d3.geo.distance(v.r,n.r),h=d3.interpolateZoom([0,0,t/v.k],[l,0,t/n.k]);return p&&r.duration(p(.001*h.duration)),function(a){var n=h(a);this.__chart__=v={r:i(s(n[0]/l)),k:t/n[2]},u.rotate(v.r).scale(v.k),M.scale(v.k),c(e)}}).each("end.zoom",function(){d(e)});try{r.each("interrupt.zoom",function(){d(e)})}catch(t){console.log(t)}}else this.__chart__=v,l(e),c(e),d(e)})},d3.rebind(M,g,"on")}}(),this.Celestial=R}();